

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../../../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>AWS EKS networking &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/algolia.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/starburst.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/search.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/main.js"></script>
    <script src="../../../_static/heap_analytics.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Configure IAM in EKS clusters" href="iam.html" />
    <link rel="prev" title="Amazon EKS overview" href="index.html" />

  
   

<link href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">


<!-- Always link to the latest version, as canonical -->
<link rel="canonical" href="https://docs.starburst.io/latest/ecosystems/aws/eks/networking.html">

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#ecosystems/aws/eks/networking" tabindex="1" class="md-skip"> Skip to content </a>
  
<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://www.starburst.io" title="Starburst Enterprise"
           class="md-header-nav__button md-logo">
          
              <img src="../../../_static/starburst_KO-T.png"
                   alt="Starburst Enterprise 433-e STS logo">
          
        </a>
      </div>
      <span class="header-divider"></span>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <a href="/starburst-enterprise/index.html"
          class="md-header-nav__topic">
          Documentation: Starburst Enterprise 433-e STS</a>
          <span class="md-header-nav__topic"> AWS EKS networking </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        <div id="algolia-search">
  <div id="searchbox"></div>
  <div id="product-list">
    <h6 class="filter-label">Product:</h6>
  </div>
  <div id="versionsRefinementList" id="version-list" style="display:none"></div>
  <div id="hits"></div>
  <div id="stats"></div>
</div>
      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (429-e)" href="/429-e/">Latest LTS (429-e)</a>
      
          <a title="423-e LTS" href="/423-e/">423-e LTS</a>
      
          <a title="413-e LTS" href="/413-e/">413-e LTS</a>
      
          <a title="407-e LTS" href="/407-e/">407-e LTS</a>
      
          <a title="Latest STS (433-e)" href="/433-e/">Latest STS (433-e)</a>
      
          <a title="427-e STS" href="/427-e/">427-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>


  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/introduction/index.html" class="md-tabs__link">Introduction</a></li>
            
            <li class="md-tabs__item"><a href="/clients/index.html" class="md-tabs__link">Clients</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-galaxy/index.html" class="md-tabs__link">Starburst Galaxy</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-enterprise/index.html" class="md-tabs__link">Starburst Enterprise</a></li>
            
            <li class="md-tabs__item"><a href="/resources.html" class="md-tabs__link">Resources</a></li>
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Amazon AWS</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Amazon EKS overview</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../../../_static/starburst_KO-T.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../../index.html"
       title="Starburst Enterprise">Starburst Enterprise 433-e STS</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Overview</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../overview.html" class="md-nav__link">Features, use cases, and support</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../try-sep.html" class="md-nav__link">Try Starburst Enterprise</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">For all users</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../overview/sep-ui.html" class="md-nav__link">Starburst Enterprise web UI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../data-products.html" class="md-nav__link">Data products</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../insights.html" class="md-nav__link">Insights</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Use SQL</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../routines.html" class="md-nav__link">SQL routines</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">For data engineers</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../catalogs.html" class="md-nav__link">Define catalogs</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../data-engineering/materialized-views.html" class="md-nav__link">Materialized views</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Connect to data sources</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../connector.html" class="md-nav__link">Connector overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../object-storage.html" class="md-nav__link">Object storage connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../non-object-storage.html" class="md-nav__link">Non-object storage connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../utilities.html" class="md-nav__link">Utilities</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../connector/starburst-connectors.html" class="md-nav__link">Starburst connectors feature matrix</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">For platform administrators</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../admin-topics.html" class="md-nav__link">Administration topics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../admin.html" class="md-nav__link">Performance, logging, and governance features</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../starburst-rest-api.html" class="md-nav__link">Starburst Enterprise REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Deploy in cloud ecosystems</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../index.html" class="md-nav__link">AWS ecosystem</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../index.html#starburst-enterprise" class="md-nav__link">Starburst Enterprise</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../marketplace/index.html" class="md-nav__link">AWS Marketplace for CFT and EKS users</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cft/index.html" class="md-nav__link">AWS CFT</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="index.html" class="md-nav__link">AWS EKS</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> EKS networking </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">EKS networking</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#ecosystems-aws-eks-networking--page-root" class="md-nav__link">AWS EKS networking</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#best-practice-use-a-single-availability-zone-inside-your-existing-vpc" class="md-nav__link">Best practice: Use a single availability zone inside your existing VPC</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#ip-address-requirements" class="md-nav__link">IP address requirements</a>
        </li>
        <li class="md-nav__item"><a href="#using-subnets" class="md-nav__link">Using subnets</a>
        </li>
        <li class="md-nav__item"><a href="#considerations-if-you-must-use-vpc-peering" class="md-nav__link">Considerations if you must use VPC peering</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#configure-dns" class="md-nav__link">Configure DNS</a>
        </li>
        <li class="md-nav__item"><a href="#best-practice-configure-ingress-access-for-sep-and-services-through-a-controller" class="md-nav__link">Best practice: Configure ingress access for SEP and services through a controller</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#configure-ingress-yaml" class="md-nav__link">Configure <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#using-an-aws-classic-load-balancer" class="md-nav__link">Using an AWS classic load balancer</a>
        </li>
        <li class="md-nav__item"><a href="#using-nginx" class="md-nav__link">Using Nginx</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#advanced-networking-using-albs-with-sep" class="md-nav__link">Advanced networking: Using ALBs with SEP</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iam.html" class="md-nav__link">Configuring IAM in EKS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cluster-creation.html" class="md-nav__link">Cluster creation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sep.html" class="md-nav__link">Intalling EKS</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../index.html#sep-on-amazon-eks" class="md-nav__link">SEP on Amazon EKS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../index.html#sep-on-amazon-ec2" class="md-nav__link">SEP on Amazon EC2</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../index.html#support-for-sep" class="md-nav__link">Support for SEP</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../google/index.html" class="md-nav__link">Google Cloud</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../microsoft/index.html" class="md-nav__link">Microsoft Azure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../redhat/index.html" class="md-nav__link">Red Hat OpenShift</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">SEP deployment mechanisms</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../license-requirements.html" class="md-nav__link">Starburst Enterprise license</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../k8s.html" class="md-nav__link">Deploy with Kubernetes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../starburst-admin.html" class="md-nav__link">Deploy with Starburst Admin</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../aws.html" class="md-nav__link">Deploy with CFT on AWS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../installation.html" class="md-nav__link">Local installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../versions.html" class="md-nav__link">433-e STS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Appendix</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../appendix.html" class="md-nav__link">Version-specific notices and information</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#ecosystems-aws-eks-networking--page-root" class="md-nav__link">AWS EKS networking</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#best-practice-use-a-single-availability-zone-inside-your-existing-vpc" class="md-nav__link">Best practice: Use a single availability zone inside your existing VPC</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#ip-address-requirements" class="md-nav__link">IP address requirements</a>
        </li>
        <li class="md-nav__item"><a href="#using-subnets" class="md-nav__link">Using subnets</a>
        </li>
        <li class="md-nav__item"><a href="#considerations-if-you-must-use-vpc-peering" class="md-nav__link">Considerations if you must use VPC peering</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#configure-dns" class="md-nav__link">Configure DNS</a>
        </li>
        <li class="md-nav__item"><a href="#best-practice-configure-ingress-access-for-sep-and-services-through-a-controller" class="md-nav__link">Best practice: Configure ingress access for SEP and services through a controller</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#configure-ingress-yaml" class="md-nav__link">Configure <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#using-an-aws-classic-load-balancer" class="md-nav__link">Using an AWS classic load balancer</a>
        </li>
        <li class="md-nav__item"><a href="#using-nginx" class="md-nav__link">Using Nginx</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#advanced-networking-using-albs-with-sep" class="md-nav__link">Advanced networking: Using ALBs with SEP</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="aws-eks-networking">
<h1 id="ecosystems-aws-eks-networking--page-root">AWS EKS networking<a class="headerlink" href="#ecosystems-aws-eks-networking--page-root" title="Permalink to this heading">#</a></h1>
<p>This document helps you to understand networking requirements and configuration
for Starburst Enterprise platform (SEP) on AWS EKS.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We <strong>very strongly suggest</strong> using Amazon’s Classic Load Balancer with SEP. The
configuration of Application Load Balancers (ALB) is a very complex, advanced
configuration and is highly dependent upon the particulars of your environment.</p>
</div>
<section id="best-practice-use-a-single-availability-zone-inside-your-existing-vpc">
<h2 id="best-practice-use-a-single-availability-zone-inside-your-existing-vpc">Best practice: Use a single availability zone inside your existing VPC<a class="headerlink" href="#best-practice-use-a-single-availability-zone-inside-your-existing-vpc" title="Permalink to this heading">#</a></h2>
<p>When deploying SEP into an AWS EKS cluster, it is important
to ensure that your cluster resources are located with the following in mind:</p>
<ul class="simple">
<li><p>cluster communications latency</p></li>
<li><p>data ingress/egress costs</p></li>
<li><p>IP address availability</p></li>
</ul>
<p>Using your existing VPC is a key cost control measure. It ensures that costs
associated with data ingress and egress are kept to a minimum. Every new VPC
comes with a NAT gateway. And, while NAT gateways are inexpensive, costs for
data transferred through that gateway add up very quickly. As a best practice,
placing your SEP inside of your existing VPC, co-resident with as many of
your data sources as possible not only keeps costs down, it also greatly
simplify networking and security.</p>
<p>Equally as important is performance. No matter if you use an existing or new
VPC, SEP must run in a single availability zone (AZ) to ensure the best
performance possible. To accomplish this, use node groups. The node groups are
then tied to a single AZ using affinity or node selection rules.</p>
<p>For SEP, two <a class="reference internal" href="cluster-creation.html"><span class="doc">managed node groups</span></a> are
required. The SEP coordinator and workers are deployed to one group while
support services, such as HMS, Ranger and nginx, are deployed to the second node
group.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You must use an existing VPC in order to enforce the use of a single AZ. Do not
use eksctl to create a new VPC at cluster creation time.</p>
</div>
<section id="ip-address-requirements">
<h3 id="ip-address-requirements">IP address requirements<a class="headerlink" href="#ip-address-requirements" title="Permalink to this heading">#</a></h3>
<p>An important consideration in using an existing VPC is IP address availability.
As part of standing up your SEP cluster, you must ensure that sufficient IP
addresses are reliably available for use by your SEP instances.</p>
<p>In EKS clusters, AWS creates one subnet per availability zone. Usually, these
are configured as /20 Classless Inter-Domain Routings (CIDR) with 4,091 IP
addresses available for use (an additional 5 are reserved by the cluster
itself). SEP requires that all hosts, both workers and coordinators, are
sized identically. Each of these instances has a maximum number of IP addresses
that can be assigned to it, and EKS reserves twice that number of addresses for
it.</p>
<p>For purposes of this discussion, we assume an SEP deployment involving six
m5.xlarge workers and one m5.xlarge coordinator. Each of this instances can have
a maximum of 15 IP addresses in use. An additional 15 are reserved, for a total
of 30 IP addresses needed per instance. Those seven instances together then
require 210 IP addresses:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>  <span class="o">(</span> <span class="m">7</span> m5.xlarge instances<span class="o">)</span>
x <span class="o">(</span> <span class="m">15</span> IPs per interface <span class="o">)</span>
x <span class="o">(</span> <span class="m">2</span> interfaces per instance <span class="o">)</span>
<span class="o">=</span> <span class="m">210</span> IP addresses needed
</pre></div>
</div>
<p>In this example, you must ensure that a minimum of 210 IP addresses are reliably
available for use by your SEP instances at all times.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are taking advantage of AWS EKS
autoscaling, you must calculate the number of addresses needed on the maximum
allowable number of workers.</p>
</div>
</section>
<section id="using-subnets">
<h3 id="using-subnets">Using subnets<a class="headerlink" href="#using-subnets" title="Permalink to this heading">#</a></h3>
<p>You can use an existing subnet or create a new one. It must be configured with a
route out to the Internet either via a NAT gateway or an IGW to allow your EKS
cluster to communicate with the AWS EKS management backplane. Cost
considerations for these communications are minimal.</p>
</section>
<section id="considerations-if-you-must-use-vpc-peering">
<h3 id="considerations-if-you-must-use-vpc-peering">Considerations if you must use VPC peering<a class="headerlink" href="#considerations-if-you-must-use-vpc-peering" title="Permalink to this heading">#</a></h3>
<p>If you cannot place SEP within your current VPC because of a scarcity of IP
addresses, as an alternative you can create a peering connection with the new
EKS cluster’s VPC to avoid the often cost-prohibitive operation of all data
passing through the NAT gateway. VPC peering requires additional setup, and
comes with potential downsides:</p>
<ul class="simple">
<li><p>Does not scale well.</p></li>
<li><p>Transitive routing is not available.</p></li>
<li><p>Peering connections are a resource that must be managed.</p></li>
<li><p>Firewall rules must be carefully managed.</p></li>
</ul>
<p>Additionally, you must ensure that the CIDR you set for the new SEP VPC does
not match or overlap with your existing VPC’s CIDR. VPCs with overlapping CIDRs
cannot create peering connections.</p>
<p>The following are required when using internet-facing load balancers:</p>
<ul class="simple">
<li><p>Subnets tagged with kubernetes.io/cluster/cluster-name → shared</p></li>
<li><p>Subnets tagged with kubernetes.io/role/elb → 1</p></li>
</ul>
<p>The following is required when using load balancers that are not
internet-facing:</p>
<ul class="simple">
<li><p>kubernetes.io/role/internal-elb → 1</p></li>
</ul>
</section>
</section>
<section id="configure-dns">
<h2 id="configure-dns">Configure DNS<a class="headerlink" href="#configure-dns" title="Permalink to this heading">#</a></h2>
<p>Install the
<a class="external reference" href="https://artifacthub.io/packages/helm/bitnami/external-dns#parameters">ExternalDNS</a>
add-on to automatically add DNS entries to <a class="external reference" href="https://aws.amazon.com/route53/">Amazon Route
53</a> once ingress resources are
created, as shown in the following example <code class="docutils literal notranslate"><span class="pre">external-dns.yaml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws</span>
<span class="nt">aws</span><span class="p">:</span>
  <span class="nt">zoneType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">public</span>
  <span class="nt">region</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">us-east-2</span>
<span class="nt">txtOwnerId</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;txtOwnerId&gt;</span>   <span class="c1"># Identify this</span>
<span class="nt">txtPrefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;txtPrefix&gt;</span>     <span class="c1"># external DNS instance</span>
<span class="nt">zoneIdFilters</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;HostedZoneID&gt;</span> <span class="c1"># ID of AWS R53 Hosted Zone</span>

<span class="c1"># This allows external-dns to delete entries as well</span>
<span class="nt">policy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sync</span>
</pre></div>
</div>
<p>Run the following commands to complete the install. Be sure to use the latest
artifact of
<a class="external reference" href="https://artifacthub.io/packages/helm/bitnami/external-dns">external-dns</a>
and specify its version in the command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm repo add bitnami https://charts.bitnami.com/bitnami
$ helm repo update
$ helm upgrade external-dns bitnami/external-dns --namespace kube-system --install --version &lt;X.Y.Z&gt; <span class="se">\</span>
  --values external-dns.yaml
</pre></div>
</div>
</section>
<section id="best-practice-configure-ingress-access-for-sep-and-services-through-a-controller">
<h2 id="best-practice-configure-ingress-access-for-sep-and-services-through-a-controller">Best practice: Configure ingress access for SEP and services through a controller<a class="headerlink" href="#best-practice-configure-ingress-access-for-sep-and-services-through-a-controller" title="Permalink to this heading">#</a></h2>
<p>Accessing your SEP cluster from external clients requires access to the
coordinator and Ranger pods within the K8s cluster. This can be handled either
through an <a class="external reference" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/elb-security-groups.html">AWS classic load
balancer</a>,
or by deploying an Nginx ingress controller behind a classic layer 4 load
balancer.</p>
<p>There are technical considerations for either approach:</p>
<ul class="simple">
<li><p>Using an AWS classic load balancer</p>
<ul>
<li><p>TLS termination is taken care of externally from the load balancer.</p></li>
<li><p>A separate load balancer resource is be created for each service
(Starburst, Ranger, etc.)</p></li>
</ul>
</li>
<li><p>Using an Nginx ingress controller</p>
<ul>
<li><p>Nginx can route traffic to different services using a single load balancer.</p></li>
<li><p>Internal or alternate CA issue certificates, as it is not possible to use
Amazon Certificate Manager with an Nginx pod.</p></li>
</ul>
</li>
</ul>
<p>For either approach, you must first configure and apply changes to your
cluster’s <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code> file. When you have verified that the ingress for the
cluster is working properly, proceed with configuring and deploying your ingress
controller of choice.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>While it is possible to set up ingress directly in Starburst Helm charts, it is
not recommended. Using standard K8s controllers as outlined here avoids complex
networking and certificate issues inherent in connecting directly through
application-specific ingress configurations.</p>
</div>
<section id="configure-ingress-yaml">
<h3 id="configure-ingress-yaml">Configure <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code><a class="headerlink" href="#configure-ingress-yaml" title="Permalink to this heading">#</a></h3>
<p>The following <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code> file provides the necessary networking
configuration for both SEP and Ranger. You can safely ignore the
Ranger configuration if your organization does not use it:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">starburst</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">elb</span>
    <span class="nt">alb.ingress.kubernetes.io/group.name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sep</span>
    <span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internet-facing</span>
    <span class="nt">alb.ingress.kubernetes.io/listen-ports</span><span class="p">:</span> <span class="s">'[{"HTTP":</span><span class="nv"> </span><span class="s">80},{"HTTPS":</span><span class="nv"> </span><span class="s">443}]'</span>
    <span class="nt">alb.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span> <span class="s">'443'</span>
    <span class="nt">alb.ingress.kubernetes.io/success-codes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200,303</span>
    <span class="nt">alb.ingress.kubernetes.io/tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">key1=value1, key2=value2</span>
    <span class="nt">alb.ingress.kubernetes.io/certificate-arn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;cert-??&gt;</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">tls</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;starburst-hostname&gt;</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;starburst-hostname&gt;</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
            <span class="nt">pathType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Prefix</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">service</span><span class="p">:</span>
                <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">starburst</span>
                <span class="nt">port</span><span class="p">:</span>
                  <span class="nt">number</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ranger</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">elb</span>
    <span class="nt">alb.ingress.kubernetes.io/group.name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sep</span>
    <span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internet-facing</span>
    <span class="nt">alb.ingress.kubernetes.io/listen-ports</span><span class="p">:</span> <span class="s">'[{"HTTP":</span><span class="nv"> </span><span class="s">80},{"HTTPS":</span><span class="nv"> </span><span class="s">443}]'</span>
    <span class="nt">alb.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span> <span class="s">'443'</span>
    <span class="nt">alb.ingress.kubernetes.io/success-codes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200,302</span>
    <span class="nt">alb.ingress.kubernetes.io/tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">key1=value1, key2=value2</span>
    <span class="nt">alb.ingress.kubernetes.io/certificate-arn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;cert-??&gt;</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">tls</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;ranger-hostname&gt;</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;ranger-hostname&gt;</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
            <span class="nt">pathType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Prefix</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">service</span><span class="p">:</span>
                <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ranger</span>
                <span class="nt">port</span><span class="p">:</span>
                  <span class="nt">number</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6080</span>
</pre></div>
</div>
<p>Once all changes to <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code> are made, apply the customizations using the
following command in the namespace that contains SEP:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f ingress.yaml
</pre></div>
</div>
</section>
<section id="using-an-aws-classic-load-balancer">
<h3 id="using-an-aws-classic-load-balancer">Using an AWS classic load balancer<a class="headerlink" href="#using-an-aws-classic-load-balancer" title="Permalink to this heading">#</a></h3>
<p>The <a class="external reference" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-standard-load-balancer.html">AWS
documentation</a>
provides complete instructions for creating a classic load balancer on your EKS
cluster’s VPC.</p>
<p>Once your load balancer is created, you must define it in your
SEP chart as shown below, with TLS enabled:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">expose</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="s">"loadBalancer"</span>
  <span class="nt">loadBalancer</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">"starburst"</span>
    <span class="nt">IP</span><span class="p">:</span> <span class="s">""</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="nt">https</span><span class="p">:</span>
        <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8443</span>
      <span class="nt">http</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="nt">annotations</span><span class="p">:</span>
      <span class="nt">service.beta.kubernetes.io/aws-load-balancer-internal</span><span class="p">:</span> <span class="s">"true"</span>
    <span class="nt">sourceRanges</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
</pre></div>
</div>
</section>
<section id="using-nginx">
<h3 id="using-nginx">Using Nginx<a class="headerlink" href="#using-nginx" title="Permalink to this heading">#</a></h3>
<p>The <a class="external reference" href="https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-helm/">Nginx
controller</a>
is deployed as an additional pod in the EKS cluster. Certificate management for
HTTPS connections is implemented using one of the following Helm-managed
certificates:</p>
<ul class="simple">
<li><p>A self-signed certificate</p></li>
<li><p>A internal CA-signed certificate</p></li>
<li><p>A Let’s Encrypt-issued certificate using <a class="external reference" href="https://cert-manager.io/docs/tutorials/acme/nginx-ingress/">cert-manager.io</a></p></li>
</ul>
<p>The following is an example of Nginx chart to control access to an SEP
cluster:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-ingress</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">service.beta.kubernetes.io/aws-load-balancer-internal</span><span class="p">:</span> <span class="s">"true"</span>
    <span class="nt">service.beta.kubernetes.io/aws-load-balancer-type</span><span class="p">:</span> <span class="s">"nlb"</span>
<span class="nt">spec</span><span class="p">:</span> <span class="nt">tls</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">starburst.example.com</span>
    <span class="nt">secretName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
  <span class="nt">rules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">starburst.example.com</span>
<span class="nt">http</span><span class="p">:</span> <span class="nt">paths</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">backend</span><span class="p">:</span>
          <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">trino</span>
          <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="-Error"> </span><span class="nt">controller</span><span class="p">:</span>
  <span class="nt">extraArgs</span><span class="p">:</span>
    <span class="c1">##   default-ssl-certificate: "&lt;namespace&gt;/&lt;secret_name&gt;"</span>
    <span class="nt">default-ssl-certificate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default/cert-example.com</span>
</pre></div>
</div>
<p>In this case, the default certificate is a Kubernetes secret specified by
applying the following YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cert-example.com</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="c1">## Both tls.crt and tls.key are base64-encoded PEM files on a single line</span>
  <span class="nt">tls.crt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;self-signed certificate&gt;</span>
  <span class="nt">tls.key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;self-signed private key&gt;</span>
</pre></div>
</div>
<p>In the SEP <code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> file, ingress is exposed via the following YAML
block:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">expose</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="s">"ingress"</span>
  <span class="nt">ingress</span><span class="p">:</span>
    <span class="nt">ingressName</span><span class="p">:</span> <span class="s">"nginx"</span>
    <span class="nt">serviceName</span><span class="p">:</span> <span class="s">"trino"</span>
    <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
    <span class="nt">ingressClassName</span><span class="p">:</span>
    <span class="nt">tls</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">host</span><span class="p">:</span> <span class="s">"starburst.example.com"</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">"/"</span>
    <span class="nt">pathType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Prefix</span>
    <span class="nt">annotations</span><span class="p">:</span>
      <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="s">"nginx"</span>
</pre></div>
</div>
<p>All inbound HTTPS traffic to <code class="docutils literal notranslate"><span class="pre">starburst.example.com</span></code> is now directed to the
SEP coordinator. A similar configuration is applied in the Starburst Ranger
Helm with <code class="docutils literal notranslate"><span class="pre">ranger.example.com</span></code> as the host.</p>
</section>
</section>
<section id="advanced-networking-using-albs-with-sep">
<h2 id="advanced-networking-using-albs-with-sep">Advanced networking: Using ALBs with SEP<a class="headerlink" href="#advanced-networking-using-albs-with-sep" title="Permalink to this heading">#</a></h2>
<p>After you have your cluster up and running, you may wish to switch to using an
AWS Application Load Balancer (ALB). ALBs are inherently complicated and
configuration is very dependent upon the particulars of your environment. When
using an ALB ingress controller:</p>
<ul class="simple">
<li><p>TLS termination is taken care of in the load balancer.</p></li>
<li><p>Easy to integrate AWS Certificate Manager for publicly-signed
certificates.</p></li>
<li><p>A separate load balancer resource must be created for each service
(Starburst, Ranger, etc.)</p></li>
</ul>
<p>In addition to setting <code class="docutils literal notranslate"><span class="pre">kubernetes.io/ingress.class:</span> <span class="pre">alb</span></code>, the following are
important considerations to remember as you modify cluster’s <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code>
file:</p>
<ul class="simple">
<li><p><strong>alb.ingress.kubernetes.io/certificate-arn</strong> - If AWS ACM contains multiple
certificates matching the hostname, specify certificate ARN explicitly,
otherwise you can remove this annotation.</p></li>
<li><p><strong>alb.ingress.kubernetes.io/group.name</strong> - SEP forces the ALB
controller to combine multiple Kubernetes ingress resources into a single ALB
on AWS, reducing costs.</p></li>
<li><p><strong>alb.ingress.kubernetes.io/success-code</strong> - Contains HTTP response codes of
the root (/) resource that are used by target group health checks. By default
they accept only 200, but SEP responds with 303, and Ranger with 302.</p></li>
<li><p><strong>alb.ingress.kubernetes.io/listen-ports</strong> - Ensures that ALB listens on both
HTTP and HTTPS ports</p></li>
<li><p><strong>alb.ingress.kubernetes.io/ssl-redirect</strong> - Redirects from HTTP to HTTPS</p></li>
</ul>
<p>Once all changes to <code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code> are made, apply the customizations using the
following command in the namespace that contains SEP:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f ingress.yaml
</pre></div>
</div>
<p>You must wait until the ALB status changes from <code class="docutils literal notranslate"><span class="pre">Provisioning</span></code> to <code class="docutils literal notranslate"><span class="pre">Ready</span></code> before
the networking behaves as expected with the configuration changes.</p>
<p>The <a class="external reference" href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html">AWS
documentation</a>
provides complete instructions for installing the ALB ingress controller on your
EKS cluster. The following example commands provide an overview of the process
to install ALB controller that automatically discovers ingress resources and
propagates them to AWS ALB and target groups.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm repo add eks https://aws.github.io/eks-charts
$ helm repo update
<span class="nv">$helm</span> upgrade -i aws-load-balancer-controller eks/aws-load-balancer-controller -n kube-system <span class="se">\</span>
  --set <span class="nv">clusterName</span><span class="o">=</span>&lt;cluster-name&gt;
</pre></div>
</div>
<p>Once the ALB controller is installed, you must define ingress in your SEP
chart:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">expose</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="s">"ingress"</span>
  <span class="nt">ingress</span><span class="p">:</span>
    <span class="nt">ingressName</span><span class="p">:</span> <span class="s">"starburst-ingress"</span>
    <span class="nt">serviceName</span><span class="p">:</span> <span class="s">"starburst"</span>
    <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
    <span class="nt">tls</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">host</span><span class="p">:</span> <span class="s">"starburst.example.com"</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">"/*"</span>
    <span class="nt">annotations</span><span class="p">:</span>
      <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alb</span>
      <span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">interal</span>
      <span class="nt">alb.ingress.kubernetes.io/target-type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ip</span>
</pre></div>
</div>
<p>With the defined host, the ingress controller automatically associates
certificates in ACM with a matching Subject Alternative Name or with a wildcard
such as “*.example.com” with this load balancer.</p>
<p>By default, the controller creates an ALB, configures it with TLS certificate
stored in the AWS Certificate Manager (private key is not exposed to
Kubernetes), and terminate TLS at ALB.</p>
<p>Target groups are configured to send traffic to ports on Kubernetes worker
nodes. A NodePort service type must be configured in Kubernetes to expose
specific ports across all nodes.</p>
<p>The following traffic flows apply when using “ingress” as the <code class="docutils literal notranslate"><span class="pre">expose:</span></code> type:</p>
<ul class="simple">
<li><p>Kubernetes pod: Runs the workload and listens on a port</p></li>
<li><p>kube-proxy: Listens on NodePort, proxies traffic to the pods in cluster</p></li>
<li><p>Target Groups: Discover EKS worker nodes, run health checks</p></li>
<li><p>ALB: Terminates TLS, performs HTTP routing</p></li>
<li><p>Route 53 A record: Points to ALB endpoints in public subnets</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>When using ingress, you must specify the TLS
certificate as a Kubernetes secret if TLS is enabled.</p>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-grid md-main__inner" style="height: auto;">
  <div class="md-content">
    <div class="feedback-container md-content__inner md-typeset">
      <div class="feedback-thumbs">
        <p>Is the information on this page helpful?</p>
        <p class="feedback-option" title="yes">Yes</p>
        <p class="feedback-option" title="no">No</p>
      </div>
      <div class="feedback-message">
        <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
        <button type="button" onclick="sendMessage()" class="feedback-button">Submit</button>
        <a onclick="skip()" class="feedback-skip">Skip</a>
      </div>
    </div>
  </div>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '');
</script>
<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="index.html" title="Amazon EKS overview"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Amazon EKS overview </span>
              </div>
            </a>
          
          
            <a href="iam.html" title="Configure IAM in EKS clusters"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Configure IAM in EKS clusters </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
<!-- custom footer should go here in time -->
<div class="page-footer">
  <div class="container md-grid">
    <div class="row">
      <div class="col-md-3">
        <p style="font-weight:900">Resources</p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">

        <a href="https://www.starburst.io/" target="_blank">
          
            <img src="../../../_static/starburst_KO-T.png" height="26"
                  alt="Starburst Enterprise 433-e STS logo">
        
        </a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright © 2017-2023<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
  </div>
</div>
<script src="https://docs.starburst.io/433-e/_static/algolia.js"></script>
<script src="https://docs.starburst.io/433-e/_static/searchbox.js" data-versions="{'Latest LTS (429-e)': '/429-e/', '423-e LTS': '/423-e/', '413-e LTS': '/413-e/', '407-e LTS': '/407-e/', 'Latest STS (433-e)': '/433-e/', '427-e STS': '/427-e/'}"></script>
<script src="https://docs.starburst.io/433-e/_static/searchresults.js" data-versions="{'Latest LTS (429-e)': '/429-e/', '423-e LTS': '/423-e/', '413-e LTS': '/413-e/', '407-e LTS': '/407-e/', 'Latest STS (433-e)': '/433-e/', '427-e STS': '/427-e/'}"></script>
  </body>
</html>