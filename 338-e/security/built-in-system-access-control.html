

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.7. Built-in System Access Control &mdash; Starburst Enterprise Presto</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="7. Security" href="../security.html"/>
        <link rel="next" title="7.8. LDAP group provider" href="ldap-group-provider.html"/>
        <link rel="prev" title="7.6. Java Keystores and Truststores" href="tls.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client.html">3. Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">4. Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s.html">5. Kubernetes with Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes.html">6. Kubernetes operator</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../security.html">7. Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="server.html">7.1. Coordinator Kerberos Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">7.2. CLI Kerberos Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldap.html">7.3. LDAP Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="password-file.html">7.4. Password File Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-mapping.html">7.5. User Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="tls.html">7.6. Java Keystores and Truststores</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.7. Built-in System Access Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-system-access-control">Default System Access Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#allow-all-system-access-control">Allow All System Access Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-only-system-access-control">Read Only System Access Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-based-system-access-control">File Based System Access Control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#refresh">Refresh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#catalog-rules">Catalog Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-rules">Query Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#impersonation-rules">Impersonation Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#principal-rules">Principal Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-information-rules">System Information Rules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ldap-group-provider.html">7.8. LDAP group provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="secrets.html">7.9. Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="internal-communication.html">7.10. Secure Internal Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="audit.html">7.11. Query audit</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-logger.html">7.12. Event Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbac.html">7.13. Role Based Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="system-ranger.html">7.14. System level security with Apache Ranger</a></li>
<li class="toctree-l2"><a class="reference internal" href="hive-ranger.html">7.15. Hive level security with Apache Ranger</a></li>
<li class="toctree-l2"><a class="reference internal" href="hive-sentry.html">7.16. Hive level security with Apache Sentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="impersonation.html">7.17. User Impersonation</a></li>
<li class="toctree-l2"><a class="reference internal" href="credential-passthrough.html">7.18. Kerberos Credential Passthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="okta-authentication.html">7.19. Okta authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">8. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">9. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">10. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">11. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">12. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">13. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">14. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">15. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">16. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">17. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          

        </div>
        <div style="margin-top: 1em; margin-left: 2em;">
          Version <a href="../versions.html">338-e LTS and others</a>
          <br><br>
        <span>
  <select name="versions" id="versions" onChange="window.location.href=this.value">
    <option value="./">Choose another version</option>
    <option value="/356-e/">Latest LTS (356-e)</option>
    <option value="/350-e/">350-e LTS</option>
    <option value="/345-e/">345-e LTS</option>
    <option value="/338-e/">338-e LTS</option>
    <option value="/358-e/">Latest STS (358-e)</option>
    <option value="/357-e/">357-e STS</option>
  </select>
</span>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://www.starburstdata.com/">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/starburst-darkbg.png"/></a>
        <span class="optional">
          <a href="../index.html">Starburst Enterprise Presto</a>
          <a href="../versions.html" style="font-size: small;margin-left: 0.5em;">338-e LTS and others</a>
          <a href="https://www.starburstdata.com/oreilly-presto-guide-download/?utm_campaign=O%27Reilly%20Presto%20Book&utm_source=starburst&utm_medium=docs">
            <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px; margin-left: 0.5em;"
          src="../_static/img/ptdg-banner.png"/></a>
          </span>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../security.html"><span class="section-number">7. </span>Security</a> &raquo;</li>
      
    <li><span class="section-number">7.7. </span>Built-in System Access Control</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="built-in-system-access-control">
<h1><span class="section-number">7.7. </span>Built-in System Access Control<a class="headerlink" href="#built-in-system-access-control" title="Permalink to this headline">#</a></h1>
<p>A system access control plugin enforces authorization at a global level,
before any connector level authorization. You can use one of the built-in
plugins in Presto, or provide your own by following the guidelines in
<a class="reference internal" href="../develop/system-access-control.html"><span class="doc">System Access Control</span></a>.</p>
<p>Multiple system access control implementations may be configured at once
using the <code class="docutils literal notranslate"><span class="pre">access-control.config-files</span></code> configuration property. It should
contain a comma separated list of the access control property files to use
(rather than the default <code class="docutils literal notranslate"><span class="pre">etc/access-control.properties</span></code>).</p>
<p>Presto offers three built-in plugins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Plugin Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">default</span></code> (default value)</p></td>
<td><p>All operations are permitted, except for user impersonation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">allow-all</span></code></p></td>
<td><p>All operations are permitted.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">read-only</span></code></p></td>
<td><p>Operations that read data or metadata are permitted, but
none of the operations that write data or metadata are
allowed. See <a class="reference internal" href="#read-only-system-access-control"><span class="std std-ref">Read Only System Access Control</span></a> for
details.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">file</span></code></p></td>
<td><p>Authorization checks are enforced using a config file
specified by the configuration property <code class="docutils literal notranslate"><span class="pre">security.config-file</span></code>.
See <a class="reference internal" href="#file-based-system-access-control"><span class="std std-ref">File Based System Access Control</span></a> for details.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="default-system-access-control">
<h2>Default System Access Control<a class="headerlink" href="#default-system-access-control" title="Permalink to this headline">#</a></h2>
<p>All operations are permitted, except for user impersonation. This plugin is enabled by default.</p>
</div>
<div class="section" id="allow-all-system-access-control">
<h2>Allow All System Access Control<a class="headerlink" href="#allow-all-system-access-control" title="Permalink to this headline">#</a></h2>
<p>All operations are permitted under this plugin.</p>
</div>
<div class="section" id="read-only-system-access-control">
<span id="id1"></span><h2>Read Only System Access Control<a class="headerlink" href="#read-only-system-access-control" title="Permalink to this headline">#</a></h2>
<p>Under this plugin, you are allowed to execute any operation that reads data or
metadata, such as <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> or <code class="docutils literal notranslate"><span class="pre">SHOW</span></code>. Setting system level or catalog level
session properties is also permitted. However, any operation that writes data or
metadata, such as <code class="docutils literal notranslate"><span class="pre">CREATE</span></code>, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> or <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, is prohibited.
To use this plugin, add an <code class="docutils literal notranslate"><span class="pre">etc/access-control.properties</span></code>
file with the following contents:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>access-control.name=read-only
</pre></div>
</div>
</div>
<div class="section" id="file-based-system-access-control">
<span id="id2"></span><h2>File Based System Access Control<a class="headerlink" href="#file-based-system-access-control" title="Permalink to this headline">#</a></h2>
<p>This plugin allows you to specify access control rules in a file. To use this
plugin, add an <code class="docutils literal notranslate"><span class="pre">etc/access-control.properties</span></code> file containing two required
properties: <code class="docutils literal notranslate"><span class="pre">access-control.name</span></code>, which must be equal to <code class="docutils literal notranslate"><span class="pre">file</span></code>, and
<code class="docutils literal notranslate"><span class="pre">security.config-file</span></code>, which must be equal to the location of the config file.
For example, if a config file named <code class="docutils literal notranslate"><span class="pre">rules.json</span></code>
resides in <code class="docutils literal notranslate"><span class="pre">etc</span></code>, add an <code class="docutils literal notranslate"><span class="pre">etc/access-control.properties</span></code> with the following
contents:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>access-control.name=file
security.config-file=etc/rules.json
</pre></div>
</div>
<p>The config file is specified in JSON format.</p>
<ul class="simple">
<li><p>It contains the rules defining which catalog can be accessed by which user (see Catalog Rules below).</p></li>
<li><p>The query rules specifying which queries can be managed by which user (see Query Rules below).</p></li>
<li><p>The impersonation rules specify which user impersonations are allowed (see Impersonation Rules below).</p></li>
<li><p>The principal rules specifying what principals can identify as what users (see Principal Rules below).</p></li>
<li><p>The system information rules specifying what users can access system management information (see System Information Rules below).</p></li>
</ul>
<p>This plugin currently supports catalog access, query, impersonation, principal, and system information
rules. If you want to limit access on a system level in any other way, you
must implement a custom SystemAccessControl plugin
(see <a class="reference internal" href="../develop/system-access-control.html"><span class="doc">System Access Control</span></a>).</p>
<div class="section" id="refresh">
<h3>Refresh<a class="headerlink" href="#refresh" title="Permalink to this headline">#</a></h3>
<p>By default, when a change is made to the <code class="docutils literal notranslate"><span class="pre">security.config-file</span></code>, Presto must be restarted
to load the changes. There is an optional property to refresh the properties without requiring a
Presto restart. The refresh period is specified in the <code class="docutils literal notranslate"><span class="pre">etc/access-control.properties</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>security.refresh-period=1s
</pre></div>
</div>
</div>
<div class="section" id="catalog-rules">
<h3>Catalog Rules<a class="headerlink" href="#catalog-rules" title="Permalink to this headline">#</a></h3>
<p>These rules govern the catalogs particular users can access. The user is
granted access to a catalog, based on the first matching rule read from top to
bottom. If no rule matches, access is denied. Each rule is composed of the
following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code> (optional): regex to match against user name. Defaults to <code class="docutils literal notranslate"><span class="pre">.*</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group</span></code> (optional): regex to match against group names. Defaults to <code class="docutils literal notranslate"><span class="pre">.*</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">catalog</span></code> (optional): regex to match against catalog name. Defaults to <code class="docutils literal notranslate"><span class="pre">.*</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow</span></code> (required): string indicating whether a user has access to the catalog.
This value can be <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">read-only</span></code> or <code class="docutils literal notranslate"><span class="pre">none</span></code>, and defaults to <code class="docutils literal notranslate"><span class="pre">none</span></code>.
Setting this value to <code class="docutils literal notranslate"><span class="pre">read-only</span></code> has the same behavior as the <code class="docutils literal notranslate"><span class="pre">read-only</span></code>
system access control plugin.</p></li>
</ul>
<p>In order for a rule to apply the user name must match the regular expression
specified in <code class="docutils literal notranslate"><span class="pre">user</span></code> attribute.</p>
<p>For group names, a rule can be applied if at least one group name of this user
matches the <code class="docutils literal notranslate"><span class="pre">group</span></code> regular expression.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, all users have access to the <code class="docutils literal notranslate"><span class="pre">system</span></code> catalog. You can
override this behavior by adding a rule.</p>
<p>Boolean <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code> are also supported as legacy values for <code class="docutils literal notranslate"><span class="pre">allow</span></code>,
to support backwards compatibility.  <code class="docutils literal notranslate"><span class="pre">true</span></code> maps to <code class="docutils literal notranslate"><span class="pre">all</span></code>, and <code class="docutils literal notranslate"><span class="pre">false</span></code> maps to <code class="docutils literal notranslate"><span class="pre">none</span></code>.</p>
</div>
<p>For example, if you want to allow only the user <code class="docutils literal notranslate"><span class="pre">admin</span></code> to access the
<code class="docutils literal notranslate"><span class="pre">mysql</span></code> and the <code class="docutils literal notranslate"><span class="pre">system</span></code> catalog, allow users from the <code class="docutils literal notranslate"><span class="pre">finance</span></code>
and <code class="docutils literal notranslate"><span class="pre">admin</span></code> groups access to <code class="docutils literal notranslate"><span class="pre">postgres</span></code> catalog, allow all users to
access the <code class="docutils literal notranslate"><span class="pre">hive</span></code> catalog, and deny all other access, you can use the
following rules:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;catalogs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
      <span class="nt">&quot;catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;(mysql|system)&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;finance|human_resources&quot;</span><span class="p">,</span>
      <span class="nt">&quot;catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;hive&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span>
      <span class="nt">&quot;catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;postgresql&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="s2">&quot;read-only&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;catalog&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For group-based rules to match, users need to be assigned to groups by a
<a class="reference internal" href="../develop/group-provider.html"><span class="doc">Group Provider</span></a>.</p>
</div>
<div class="section" id="query-rules">
<span id="id3"></span><h3>Query Rules<a class="headerlink" href="#query-rules" title="Permalink to this headline">#</a></h3>
<p>These rules control the ability of a user to execute, view, or kill a query. The user is
granted or denied access, based on the first matching rule read from top to bottom. If no
rules are specified, all users are allowed to execute queries, and to view or kill queries
owned by any user. If no rule matches, query management is denied. Each rule is composed
of the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code> (optional): regex to match against user name. Defaults to <code class="docutils literal notranslate"><span class="pre">.*</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">owner</span></code> (optional): regex to match against the query owner name. Defaults to <code class="docutils literal notranslate"><span class="pre">.*</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow</span></code> (required): set of query permissions granted to user. Values: <code class="docutils literal notranslate"><span class="pre">execute</span></code>, <code class="docutils literal notranslate"><span class="pre">view</span></code>, <code class="docutils literal notranslate"><span class="pre">kill</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users always have permission to view or kill their own queries.</p>
</div>
<p>For example, if you want to allow the user <code class="docutils literal notranslate"><span class="pre">admin</span></code> full query access, allow the user <code class="docutils literal notranslate"><span class="pre">alice</span></code>
to execute and kill queries, any user to execute queries, and deny all other access, you can use
the following rules:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;catalogs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;queries&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="s2">&quot;kill&quot;</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="s2">&quot;kill&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;execute&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="impersonation-rules">
<span id="id4"></span><h3>Impersonation Rules<a class="headerlink" href="#impersonation-rules" title="Permalink to this headline">#</a></h3>
<p>These rules control the ability of a user to impersonate another user.  In
some environments it is desirable for an administrator (or managed system) to
run queries on behalf of other users.  In these cases, the administrator
authenticates using their credentials, and then submits a query as a different
user.  When the user context is changed, Presto will verify the administrator
is authorized to run queries as the target user.</p>
<p>When these rules are present, the authorization is based on the first matching rule,
processed from top to bottom. If no rules match, the authorization is denied.
If impersonation rules are not present but the legacy principal rules are specified,
it is assumed impersonation access control is being handled by the principal rules,
so impersonation is allowed.  If neither impersonation nor principal rules are
defined, impersonation is not allowed.</p>
<p>Each impersonation rule is composed of the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">originalUser</span></code> (required): regex to match against the user requesting the impersonation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">newUser</span></code> (required): regex to match against the user that will be impersonated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow</span></code> (optional): boolean indicating if the authentication should be allowed.</p></li>
</ul>
<p>The following example allows the two admins, <code class="docutils literal notranslate"><span class="pre">alice</span></code> and <code class="docutils literal notranslate"><span class="pre">bob</span></code>, to impersonate
any user, except they may not impersonate each other.  It also allows any user to
impersonate the <code class="docutils literal notranslate"><span class="pre">test</span></code> user:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;catalogs&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;impersonation&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;originalUser&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span>
            <span class="nt">&quot;newUser&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
            <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;originalUser&quot;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
            <span class="nt">&quot;newUser&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span>
            <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;originalUser&quot;</span><span class="p">:</span> <span class="s2">&quot;alice|bob&quot;</span><span class="p">,</span>
            <span class="nt">&quot;newUser&quot;</span><span class="p">:</span> <span class="s2">&quot;.*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;originalUser&quot;</span><span class="p">:</span> <span class="s2">&quot;.*&quot;</span><span class="p">,</span>
            <span class="nt">&quot;newUser&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="principal-rules">
<span id="id5"></span><h3>Principal Rules<a class="headerlink" href="#principal-rules" title="Permalink to this headline">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Principal rules are deprecated and will be removed in a future release.
These rules have been replaced with <a class="reference internal" href="user-mapping.html"><span class="doc">User Mapping</span></a>, which
specifies how a complex authentication user name is mapped to a simple
user name for Presto, and impersonation rules defined above.</p>
</div>
<p>These rules serve to enforce a specific matching between a principal and a
specified user name. The principal is granted authorization as a user, based
on the first matching rule read from top to bottom. If no rules are specified,
no checks are performed. If no rule matches, user authorization is denied.
Each rule is composed of the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">principal</span></code> (required): regex to match and group against principal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code> (optional): regex to match against user name. If matched, it
will grant or deny the authorization based on the value of <code class="docutils literal notranslate"><span class="pre">allow</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">principal_to_user</span></code> (optional): replacement string to substitute against
principal. If the result of the substitution is same as the user name, it will
grant or deny the authorization based on the value of <code class="docutils literal notranslate"><span class="pre">allow</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow</span></code> (required): boolean indicating whether a principal can be authorized
as a user.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You would at least specify one criterion in a principal rule. If you specify
both criteria in a principal rule, it returns the desired conclusion when
either of criteria is satisfied.</p>
</div>
<p>The following implements an exact matching of the full principal name for LDAP
and Kerberos authentication:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;catalogs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;principals&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;principal&quot;</span><span class="p">:</span> <span class="s2">&quot;(.*)&quot;</span><span class="p">,</span>
      <span class="nt">&quot;principal_to_user&quot;</span><span class="p">:</span> <span class="s2">&quot;$1&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;principal&quot;</span><span class="p">:</span> <span class="s2">&quot;([^/]+)(/.*)?@.*&quot;</span><span class="p">,</span>
      <span class="nt">&quot;principal_to_user&quot;</span><span class="p">:</span> <span class="s2">&quot;$1&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to allow users to use the exact same name as their Kerberos principal
name, and allow <code class="docutils literal notranslate"><span class="pre">alice</span></code> and <code class="docutils literal notranslate"><span class="pre">bob</span></code> to use a group principal named as
<code class="docutils literal notranslate"><span class="pre">group&#64;example.net</span></code>, you can use the following rules.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;catalogs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;principals&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;principal&quot;</span><span class="p">:</span> <span class="s2">&quot;([^/]+)/?.*@example.net&quot;</span><span class="p">,</span>
      <span class="nt">&quot;principal_to_user&quot;</span><span class="p">:</span> <span class="s2">&quot;$1&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;principal&quot;</span><span class="p">:</span> <span class="s2">&quot;group@example.net&quot;</span><span class="p">,</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice|bob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="system-information-rules">
<span id="id6"></span><h3>System Information Rules<a class="headerlink" href="#system-information-rules" title="Permalink to this headline">#</a></h3>
<p>These rules specify which users can access the system information management interface.
The user is granted or denied access, based on the first matching rule read from top to
bottom. If no rules are specified, all access to system information is denied. If
no rule matches, system access is denied. Each rule is composed of the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code> (optional): regex to match against user name. If matched, it
will grant or deny the authorization based on the value of <code class="docutils literal notranslate"><span class="pre">allow</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow</span></code> (required): set of access permissions granted to user. Values: <code class="docutils literal notranslate"><span class="pre">read</span></code>, <code class="docutils literal notranslate"><span class="pre">write</span></code></p></li>
</ul>
<p>For example, if you want to allow only the user <code class="docutils literal notranslate"><span class="pre">admin</span></code> to read and write
system information, allow <code class="docutils literal notranslate"><span class="pre">alice</span></code> to read system information, and deny all other access, you
can use the following rules:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;catalogs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;system_information&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span>
      <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ldap-group-provider.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="7.8. LDAP group provider" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tls.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="7.6. Java Keystores and Truststores" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'338',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>