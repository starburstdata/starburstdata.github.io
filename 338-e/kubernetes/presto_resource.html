

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.4. Presto Kubernetes Resource &mdash; Starburst Enterprise Presto</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="6. Kubernetes operator" href="../kubernetes.html"/>
        <link rel="next" title="6.5. Querying Presto" href="query.html"/>
        <link rel="prev" title="6.3. Deployment of Presto on Kubernetes" href="deployment.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client.html">3. Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">4. Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s.html">5. Kubernetes with Helm</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kubernetes.html">6. Kubernetes operator</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">6.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">6.2. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">6.3. Deployment of Presto on Kubernetes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.4. Presto Kubernetes Resource</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-properties">General Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-properties">Service Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-memory-properties">General Memory Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coordinator-properties">Coordinator Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#worker-properties">Worker Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#readiness-and-liveness-probe">Readiness and Liveness Probe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-metrics">Usage Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spill-to-disk-properties">Spill to Disk Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hive-connector-properties">Hive Connector Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#external-metastore">External Metastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-metastore">Internal Metastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-internal-hive-metastore-pod">Customizing Internal Hive Metastore Pod</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-internal-postgresql-docker-pod">Customizing Internal PostgreSQL Docker Pod</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#prometheus-support">Prometheus Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="query.html">6.5. Querying Presto</a></li>
<li class="toctree-l2"><a class="reference internal" href="customizing_presto_image.html">6.6. Customizing Presto Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpa.html">6.7. Horizontal Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="secrets.html">6.8. Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="ranger.html">6.9. Ranger</a></li>
<li class="toctree-l2"><a class="reference internal" href="eks.html">6.10. Using Amazon Elastic Kubernetes Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="gcp-marketplace.html">6.11. GCP Marketplace</a></li>
<li class="toctree-l2"><a class="reference internal" href="gke.html">6.12. Using Google Kubernetes Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure-marketplace.html">6.13. Azure Marketplace</a></li>
<li class="toctree-l2"><a class="reference internal" href="aks.html">6.14. Using Microsoft Azure Kubernetes Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="openshift.html">6.15. Using Red Hat OpenShift</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html">6.16. Kubernetes Resources Release Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">7. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">8. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">9. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">10. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">11. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">12. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">13. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">14. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">15. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">16. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">17. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          

        </div>
        <div style="margin-top: 1em; margin-left: 2em;">
          Version <a href="../versions.html">338-e LTS and others</a>
          <br><br>
        <span>
  <select name="versions" id="versions" onChange="window.location.href=this.value">
    <option value="./">Choose another version</option>
    <option value="/345-e/">Latest LTS (345-e)</option>
    <option value="/338-e/">338-e LTS</option>
    <option value="/332-e/">332-e LTS</option>
    <option value="/323-e/">323-e LTS</option>
    <option value="/344-e/">Latest STS (344-e)</option>
    <option value="/343-e/">343-e STS</option>
  </select>
</span>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://www.starburstdata.com/">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/starburst-darkbg.png"/></a>
        <span class="optional">
          <a href="../index.html">Starburst Enterprise Presto</a>
          <a href="../versions.html" style="font-size: small;margin-left: 0.5em;">338-e LTS and others</a>
          <a href="https://www.starburstdata.com/oreilly-presto-guide-download/?utm_campaign=O%27Reilly%20Presto%20Book&utm_source=starburst&utm_medium=docs">
            <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px; margin-left: 0.5em;"
          src="../_static/img/ptdg-banner.png"/></a>
          </span>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../kubernetes.html"><span class="section-number">6. </span>Kubernetes operator</a> &raquo;</li>
      
    <li><span class="section-number">6.4. </span>Presto Kubernetes Resource</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="presto-kubernetes-resource">
<h1><span class="section-number">6.4. </span>Presto Kubernetes Resource<a class="headerlink" href="#presto-kubernetes-resource" title="Permalink to this headline">#</a></h1>
<p>A Presto Kubernetes resource represents a specific Presto cluster. The YAML file
allows you to specify various properties related to the coordinator and
workers, the catalogs and the cluster overall.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id7">Overview</a></p></li>
<li><p><a class="reference internal" href="#general-properties" id="id8">General Properties</a></p></li>
<li><p><a class="reference internal" href="#service-properties" id="id9">Service Properties</a></p></li>
<li><p><a class="reference internal" href="#general-memory-properties" id="id10">General Memory Properties</a></p></li>
<li><p><a class="reference internal" href="#coordinator-properties" id="id11">Coordinator Properties</a></p></li>
<li><p><a class="reference internal" href="#worker-properties" id="id12">Worker Properties</a></p></li>
<li><p><a class="reference internal" href="#readiness-and-liveness-probe" id="id13">Readiness and Liveness Probe</a></p></li>
<li><p><a class="reference internal" href="#usage-metrics" id="id14">Usage Metrics</a></p></li>
<li><p><a class="reference internal" href="#spill-to-disk-properties" id="id15">Spill to Disk Properties</a></p></li>
<li><p><a class="reference internal" href="#hive-connector-properties" id="id16">Hive Connector Properties</a></p>
<ul>
<li><p><a class="reference internal" href="#external-metastore" id="id17">External Metastore</a></p></li>
<li><p><a class="reference internal" href="#internal-metastore" id="id18">Internal Metastore</a></p></li>
<li><p><a class="reference internal" href="#customizing-internal-hive-metastore-pod" id="id19">Customizing Internal Hive Metastore Pod</a></p></li>
<li><p><a class="reference internal" href="#customizing-internal-postgresql-docker-pod" id="id20">Customizing Internal PostgreSQL Docker Pod</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#prometheus-support" id="id21">Prometheus Support</a></p></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id7">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>The following snippet shows all available properties with defaults. When
defining your particular Presto cluster resource, you need to specify <strong>only</strong>
the properties with non-default values.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata.com/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Presto</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">presto-cluster-name</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">nameOverride</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">clusterDomain</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster.local</span>
  <span class="nt">environment</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">additionalJvmConfigProperties</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">additionalCatalogs</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">additionalEtcPrestoTextFiles</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">additionalEtcPrestoBinaryFiles</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">licenseSecretName</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">imageNamePrefix</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">additionalBootstrapScriptVolume</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">additionalBootstrapScriptVolumes</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">additionalVolumes</span><span class="p">:</span> <span class="p p-Indicator">[]</span>

  <span class="nt">prometheus</span><span class="p">:</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">additionalRules</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">additionalSpecProperties</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">nodePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">31234</span>

  <span class="nt">image</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata/presto:338-e.4-k8s-0.45</span>
    <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>

  <span class="nt">memory</span><span class="p">:</span>
    <span class="nt">nodeMemoryHeadroom</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
    <span class="nt">xmxToTotalMemoryRatio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.9</span>
    <span class="nt">heapHeadroomPerNodeRatio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span>
    <span class="nt">queryMaxMemory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Pi</span>
    <span class="nt">queryMaxTotalMemoryPerNodePoolFraction</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.333</span>

  <span class="nt">coordinator</span><span class="p">:</span>
    <span class="nt">cpuLimit</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">cpuRequest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">memoryAllocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60Gi</span>
    <span class="nt">nodeSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">affinity</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">additionalProperties</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">additionalAnnotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

  <span class="nt">worker</span><span class="p">:</span>
    <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="nt">autoscaling</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">minReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">maxReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
      <span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="nt">deploymentTerminationGracePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7200</span> <span class="c1"># 2 hours</span>
    <span class="nt">prestoWorkerShutdownGracePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
    <span class="nt">cpuLimit</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">cpuRequest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">memoryAllocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100Gi</span>
    <span class="nt">nodeSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">affinity</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">additionalProperties</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">additionalAnnotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

  <span class="nt">readinessProbe</span><span class="p">:</span>
    <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>

  <span class="nt">livenessProbe</span><span class="p">:</span>
    <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
    <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
    <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>

  <span class="nt">spilling</span><span class="p">:</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">volume</span><span class="p">:</span>
      <span class="nt">emptyDir</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

  <span class="nt">usageMetrics</span><span class="p">:</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">usageClient</span><span class="p">:</span>
      <span class="nt">initialDelay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>
      <span class="nt">interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>

  <span class="nt">hive</span><span class="p">:</span>
    <span class="nt">metastoreUri</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">awsSecretName</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">googleServiceAccountKeySecretName</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">azureWasbSecretName</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">azureAbfsSecretName</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">azureAdlSecretName</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">additionalProperties</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="nt">internalMetastore</span><span class="p">:</span>
      <span class="nt">mySql</span><span class="p">:</span>
        <span class="nt">jdbcUrl</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
        <span class="nt">username</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
      <span class="nt">postgreSql</span><span class="p">:</span>
        <span class="nt">jdbcUrl</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
        <span class="nt">username</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
      <span class="nt">internalPostgreSql</span><span class="p">:</span>
        <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="nt">image</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres:9.6.10</span>
          <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
        <span class="nt">storage</span><span class="p">:</span>
          <span class="nt">className</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
          <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10Gi</span>
          <span class="nt">claimSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
        <span class="nt">nodeSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
        <span class="nt">affinity</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
      <span class="nt">s3Endpoint</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
      <span class="nt">image</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata/hive-metastore:k8s-0.7</span>
        <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
      <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6Gi</span>
      <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="nt">nodeSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
      <span class="nt">affinity</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</pre></div>
</div>
</div>
<div class="section" id="general-properties">
<span id="k8s-general"></span><h2><a class="toc-backref" href="#id8">General Properties</a><a class="headerlink" href="#general-properties" title="Permalink to this headline">#</a></h2>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">General properties</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nameOverride</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">nameOverride:</span> <span class="pre">presto-cluster</span></code></p></td>
<td><p>Presto Operator by default assigns a unique name to various Kubernetes
resources (e.g. Services). The name consists of the cluster name and a
unique suffix. Use this property to assign a static name instead.</p></td>
</tr>
<tr class="row-odd"><td><p>clusterDomain</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">clusterDomain:</span> <span class="pre">cluster-domain.example</span></code></p></td>
<td><p>Domain of the K8s cluster.</p></td>
</tr>
<tr class="row-even"><td><p>environment</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">environment:</span> <span class="pre">production</span></code></p></td>
<td><p>The name of the Presto cluster environment.</p></td>
</tr>
<tr class="row-odd"><td><p>additionalJvmConfigProperties</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">additionalJvmConfigProperties</span><span class="p">:</span> <span class="p p-Indicator">|</span>
  <span class="no">-XX:NewRatio=4</span>
  <span class="no">-XX:SurvivorRatio=</span>
</pre></div>
</div>
</td>
<td><p>Specify additional properties for the <a class="reference internal" href="../installation/deployment.html#presto-jvm-config"><span class="std std-ref">configuration of the JVM
running Presto</span></a>. Properties are appended to the
default configuration.</p></td>
</tr>
<tr class="row-even"><td><p>additionalCatalogs</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">additionalCatalogs</span><span class="p">:</span>
  <span class="nt">tpcds</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">connector.name=tpcds</span>
  <span class="nt">jmx</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">connector.name=jmx</span>
  <span class="nt">cms</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">connector.name=postgresql</span>
    <span class="no">connection-url=jdbc:postgresql://example.com:5432/cmsdb</span>
    <span class="no">connection-user=myuser</span>
    <span class="no">connection-password=mypassword</span>
</pre></div>
</div>
</td>
<td><p>Add one or more catalogs with the relevant properties files. The element
name determines the name of the catalog and the multi-line text sets the
content of the properties file.</p></td>
</tr>
<tr class="row-odd"><td><p>additionalEtcPrestoTextFiles</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">additionalEtcPrestoTextFiles</span><span class="p">:</span>
  <span class="nt">access-control.properties</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">access-control.name=read-only</span>
  <span class="nt">event-listener.properties</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">event-listener.name=event-logger</span>
    <span class="no">jdbc.url=jdbc:postgresql://example.com:5432/eventlog</span>
    <span class="no">jdbc.user=myuser</span>
    <span class="no">jdbc.password=mypassword</span>
</pre></div>
</div>
</td>
<td><p>Add one or more configuration text files to the <code class="docutils literal notranslate"><span class="pre">etc</span></code> folder used by
Presto. The element name determines the filename and the multi-line text
sets the content of the file.</p></td>
</tr>
<tr class="row-even"><td><p>additionalEtcPrestoBinaryFiles</p></td>
<td></td>
<td><p>Add one or more binary files to the <code class="docutils literal notranslate"><span class="pre">etc</span></code> folder used by Presto. The
configuration of is similar to the preceding text file configuration. The
element name determines the filename and the multi-line text element
needs to contain a base64 encoded content of the binary file.</p></td>
</tr>
<tr class="row-odd"><td><p>licenseSecretName</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">licenseSecretName:</span> <span class="pre">license_secret</span></code></p></td>
<td><p>Name of a Kubernetes Secret that contains a <a class="reference internal" href="../installation/license-requirements.html"><span class="doc">SEP license file</span></a>. The license file within the secret
should be named <code class="code docutils literal notranslate"><span class="pre">signed.license</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>imageNamePrefix</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">imageNamePrefix:</span> <span class="pre">gcr.io/project-name/</span></code></p></td>
<td><p>Specifies prefix of Docker image names used by the Presto cluster. This
property enables using a private Docker registry.</p></td>
</tr>
<tr class="row-odd"><td><p>image</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">org/name:tag</span>
  <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</pre></div>
</div>
</td>
<td><p>Image section allows you to specify a custom Docker image to be used by
the cluster with organization namespace, image name and tag.</p></td>
</tr>
<tr class="row-even"><td><p>additionalBootstrapScriptVolume</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">additionalBootstrapScriptVolume</span><span class="p">:</span>
  <span class="nt">configMap</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script</span>
</pre></div>
</div>
</td>
<td><p>Property of coordinator and worker pod. Allows adding <a class="reference internal" href="customizing_presto_image.html#k8s-custom-bootstrap"><span class="std std-ref">a custom
bootstrap script</span></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>additionalBootstrapScriptVolumes</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">additionalBootstrapScriptVolumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">configMap</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script-1</span>
  <span class="p p-Indicator">-</span> <span class="nt">configMap</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script-2</span>
</pre></div>
</div>
</td>
<td><p>Property of coordinator and worker pod. Allows adding <a class="reference internal" href="customizing_presto_image.html#k8s-custom-bootstrap"><span class="std std-ref">a custom
bootstrap script</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p>additionalVolumes</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">additionalVolumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span>
    <span class="nt">emptyDir</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script-1</span>
  <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/presto/cache1</span>
      <span class="l l-Scalar l-Scalar-Plain">volume</span><span class="p p-Indicator">:</span>
      <span class="nt">hostPath</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/media/nv1/presto-cache</span>
  <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/presto/cache2</span>
    <span class="nt">volume</span><span class="p">:</span>
      <span class="nt">hostPath</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/media/nv2/presto-cache</span>
</pre></div>
</div>
</td>
<td><p>Add one or more <a class="reference external" href="https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes">volumes supported by k8s</a>,
to all nodes in the cluster. Optionally, it can be mounted on a specific
path by adding it to the container image. You can use this feature to add
one or more volumes and use them to <a class="reference internal" href="../connector/hive-caching.html"><span class="doc">cache distributed storage
objects</span></a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="service-properties">
<span id="k8s-service"></span><h2><a class="toc-backref" href="#id9">Service Properties</a><a class="headerlink" href="#service-properties" title="Permalink to this headline">#</a></h2>
<p>Access to coordinator is possible via the Kubernetes Service. By default the
service is only accessible within the Kubernetes cluster at
<code class="code docutils literal notranslate"><span class="pre">http://presto-coordinator-CLUSTER_NAME_UUID.NAMESPACE.svc.cluster.local:8080</span></code>,
where <code class="code docutils literal notranslate"><span class="pre">NAMESPACE</span></code> is the Kubernetes namespace where the given Presto
cluster is deployed and <code class="code docutils literal notranslate"><span class="pre">CLUSTER_NAME_UUID</span></code> is the cluster name with
unique suffix appended.</p>
<p>Use the <code class="code docutils literal notranslate"><span class="pre">service.name</span></code> Presto resource parameter to make the service name
more predictable. For example, setting <code class="code docutils literal notranslate"><span class="pre">service.name=test-cluster</span></code> causes
the coordinator service address to be
<code class="code docutils literal notranslate"><span class="pre">http://presto-coordinator-test-cluster.NAMESPACE.svc.cluster.local:8080</span></code>.</p>
<p>Use the <code class="code docutils literal notranslate"><span class="pre">nameOverride</span></code> parameter in order to set <code class="code docutils literal notranslate"><span class="pre">CLUSTER_NAME_UUID</span></code>
to a different value.</p>
<p>You can also change type of the coordinator Service using the
<code class="code docutils literal notranslate"><span class="pre">service.type</span></code> parameter. For more information on Kubernetes Service
types, refer to <a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types">Kubernetes Services types</a>.</p>
<p>You can add additional parameters to <em>spec</em> section of Service by using
<code class="code docutils literal notranslate"><span class="pre">service.additionalSpecProperties</span></code> Presto resource parameter, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service</span><span class="p">:</span>
  <span class="nt">additionalSpecProperties</span><span class="p">:</span>
    <span class="nt">loadBalancerIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">78.11.24.19</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</pre></div>
</div>
<p>Use <code class="code docutils literal notranslate"><span class="pre">service.nodePort</span></code> parameter to specify the port on which Presto
Coordinator Service should be exposed when <code class="code docutils literal notranslate"><span class="pre">service.type</span></code> is set to
<code class="code docutils literal notranslate"><span class="pre">NodePort</span></code>, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="nt">nodePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3001</span>
</pre></div>
</div>
</div>
<div class="section" id="general-memory-properties">
<span id="k8s-memory"></span><h2><a class="toc-backref" href="#id10">General Memory Properties</a><a class="headerlink" href="#general-memory-properties" title="Permalink to this headline">#</a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">memory</span></code> section specifies general Presto memory configuration.</p>
<table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-text">General memory properties</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>memory.nodeMemoryHeadroom</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">memory</span><span class="p">:</span>
  <span class="nt">nodeMemoryHeadroom</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
</pre></div>
</div>
</td>
<td><p>Memory headroom that Presto should leave on a node when Presto pods are
configured to use entire node  memory (empty <code class="code docutils literal notranslate"><span class="pre">memoryAllocation</span></code>
configuration property).</p></td>
</tr>
<tr class="row-odd"><td><p>memory.xmxToTotalMemoryRatio</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">memory</span><span class="p">:</span>
  <span class="nt">xmxToTotalMemoryRatio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.9</span>
</pre></div>
</div>
</td>
<td><p>Ratio between Presto JVM heap size and memory available for a Presto pod.</p></td>
</tr>
<tr class="row-even"><td><p>memory.heapHeadroomPerNodeRatio</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">memory</span><span class="p">:</span>
  <span class="nt">heapHeadroomPerNodeRatio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span>
</pre></div>
</div>
</td>
<td><p>Ratio between <code class="code docutils literal notranslate"><span class="pre">memory.heap-headroom-per-node</span></code> Presto configuration
property and Presto JVM heap size.</p></td>
</tr>
<tr class="row-odd"><td><p>memory.queryMaxMemory</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">memory</span><span class="p">:</span>
  <span class="nt">queryMaxMemory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Pi</span>
</pre></div>
</div>
</td>
<td><p>Value of the <code class="code docutils literal notranslate"><span class="pre">query.max-memory</span></code> Presto configuration property.</p></td>
</tr>
<tr class="row-even"><td><p>memory.queryMaxTotalMemoryPerNodePoolFraction</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">memory</span><span class="p">:</span>
  <span class="nt">queryMaxTotalMemoryPerNodePoolFraction</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.333</span>
</pre></div>
</div>
</td>
<td><p>Value the <code class="code docutils literal notranslate"><span class="pre">query.max-total-memory-per-node</span></code> Presto configuration
property expressed as fraction of Presto JVM heap size</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="coordinator-properties">
<span id="k8s-coordinator"></span><h2><a class="toc-backref" href="#id11">Coordinator Properties</a><a class="headerlink" href="#coordinator-properties" title="Permalink to this headline">#</a></h2>
<p>All coordinator properties are nested within <code class="docutils literal notranslate"><span class="pre">coordinator</span></code>.</p>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">Coordinator properties</span><a class="headerlink" href="#id3" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cpuRequest and cpuLimit</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">coordinator</span><span class="p">:</span>
  <span class="nt">cpuRequest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
  <span class="nt">cpuLimit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
</pre></div>
</div>
</td>
<td><p>Specifies the coordinator pod’s CPU limit and request.</p></td>
</tr>
<tr class="row-odd"><td><p>memoryAllocation</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">coordinator</span><span class="p">:</span>
  <span class="nt">memoryAllocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60Gi</span>
</pre></div>
</div>
</td>
<td><p>Specifies coordinator pod’s memory usage (both request and limit). If
empty, the coordinator pod utilizes the entire memory available on the
node.</p></td>
</tr>
<tr class="row-even"><td><p>nodeSelector and affinity</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">coordinator</span><span class="p">:</span>
  <span class="nt">nodeSelector</span><span class="p">:</span>
    <span class="nt">role</span><span class="p">:</span> <span class="s">&quot;presto&quot;</span>
  <span class="nt">affinity</span><span class="p">:</span>
    <span class="nt">podAffinity</span><span class="p">:</span>
      <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</td>
<td><p>Specifies the coordinator pod’s node selector and affinity.</p></td>
</tr>
<tr class="row-odd"><td><p>additionalProperties</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">coordinator</span><span class="p">:</span>
  <span class="nt">additionalProperties</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">resource-groups.config-file=filename</span>
</pre></div>
</div>
</td>
<td><p>Specify additional <a class="reference internal" href="../installation/deployment.html#config-properties"><span class="std std-ref">configuration properties</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p>additionalAnnotations</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="worker-properties">
<span id="k8s-worker"></span><h2><a class="toc-backref" href="#id12">Worker Properties</a><a class="headerlink" href="#worker-properties" title="Permalink to this headline">#</a></h2>
<p>All worker properties are nested within <code class="docutils literal notranslate"><span class="pre">worker</span></code>.</p>
<table class="colwidths-given docutils align-default" id="id4">
<caption><span class="caption-text">Worker properties</span><a class="headerlink" href="#id4" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>count</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
</td>
<td><p>Number of worker pods.</p></td>
</tr>
<tr class="row-odd"><td><p>autoscaling</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">autoscaling</span><span class="p">:</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">minReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">maxReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>
</div>
</td>
<td><p>Configuration of workers autoscaling.</p></td>
</tr>
<tr class="row-even"><td><p>deploymentTerminationGracePeriodSeconds</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">deploymentTerminationGracePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7200</span>
</pre></div>
</div>
</td>
<td><p>Specifies termination grace period for workers pods. Worker pods are not
terminated until queries running on the pod are finished or grace period
passes.</p></td>
</tr>
<tr class="row-odd"><td><p>prestoWorkerShutdownGracePeriodSeconds</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>cpuRequest and cpuLimit</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">cpuRequest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
  <span class="nt">cpuLimit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
</pre></div>
</div>
</td>
<td><p>Specifies worker pod CPU limit and request.</p></td>
</tr>
<tr class="row-odd"><td><p>memoryAllocation</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">memoryAllocation</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</pre></div>
</div>
</td>
<td><p>Specifies worker pod memory usage (both request and limit). If empty, the
worker pod utilizes the entire memory available on the node.</p></td>
</tr>
<tr class="row-even"><td><p>nodeSelector and affinity</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">nodeSelector</span><span class="p">:</span>
    <span class="nt">role</span><span class="p">:</span> <span class="s">&quot;presto&quot;</span>
  <span class="nt">affinity</span><span class="p">:</span>
    <span class="nt">podAffinity</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</td>
<td><p>Specifies the worker pod’s node selector and affinity.</p></td>
</tr>
<tr class="row-odd"><td><p>additionalProperties</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">worker</span><span class="p">:</span>
  <span class="nt">additionalProperties</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">resource-groups.config-file=filename</span>
</pre></div>
</div>
</td>
<td><p>Specify additional <a class="reference internal" href="../installation/deployment.html#config-properties"><span class="std std-ref">configuration properties</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p>additionalAnnotations</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="readiness-and-liveness-probe">
<span id="k8s-probes"></span><h2><a class="toc-backref" href="#id13">Readiness and Liveness Probe</a><a class="headerlink" href="#readiness-and-liveness-probe" title="Permalink to this headline">#</a></h2>
<p>You can configure <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Kubernetes probes</a>
with the <code class="docutils literal notranslate"><span class="pre">readinessProbe</span></code> and <code class="docutils literal notranslate"><span class="pre">livenessProbe</span></code> elements.</p>
<table class="colwidths-given docutils align-default" id="id5">
<caption><span class="caption-text">Readiness and liveness probe properties</span><a class="headerlink" href="#id5" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>readinessProbe</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">readinessProbe</span><span class="p">:</span>
  <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
</td>
<td><p>Properties of the coordinator and worker readiness probes. For more
information on readiness probes, refer to <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Kubernetes probes</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>livenessProbe</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">livenessProbe</span><span class="p">:</span>
  <span class="nt">initialDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
  <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
  <span class="nt">failureThreshold</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
</td>
<td><p>Properties of coordinator and worker liveness probes. For more
information on liveness probes, refer to <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Kubernetes probes</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="usage-metrics">
<span id="k8s-usage-metrics"></span><h2><a class="toc-backref" href="#id14">Usage Metrics</a><a class="headerlink" href="#usage-metrics" title="Permalink to this headline">#</a></h2>
<p>The defaults configure <a class="reference internal" href="../admin/usage-metrics.html"><span class="doc">usage metrics</span></a> correctly.
No changes are necessary.</p>
</div>
<div class="section" id="spill-to-disk-properties">
<h2><a class="toc-backref" href="#id15">Spill to Disk Properties</a><a class="headerlink" href="#spill-to-disk-properties" title="Permalink to this headline">#</a></h2>
<p>You can add an additional volume and enable the optional <a class="reference internal" href="../admin/spill.html"><span class="doc">disk spilling</span></a> in the <code class="docutils literal notranslate"><span class="pre">spilling</span></code> section. Use <a class="reference external" href="https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes">any type of volume supported
by k8s</a>,
and configure it in <code class="docutils literal notranslate"><span class="pre">spec.volumes</span></code>.</p>
<p>The volume needs to be defined, and then used for spilling:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">someVolume</span>
    <span class="nt">emptyDir</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mySpillVolume</span>
    <span class="nt">hostPath</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/data</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Directory</span>

<span class="nt">spilling</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">volume</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">mySpillVolume</span>
</pre></div>
</div>
<p>The default spilling configuration uses <code class="docutils literal notranslate"><span class="pre">spec.volumes[0]</span></code> set to <code class="docutils literal notranslate"><span class="pre">emptyDir</span></code>.
We recommend using <code class="docutils literal notranslate"><span class="pre">emptyDir</span></code> or <code class="docutils literal notranslate"><span class="pre">hostPath</span></code> type for spilling. Ensure that
each worker has exclusive access to its spilling volume, and the path
exists.</p>
</div>
<div class="section" id="hive-connector-properties">
<h2><a class="toc-backref" href="#id16">Hive Connector Properties</a><a class="headerlink" href="#hive-connector-properties" title="Permalink to this headline">#</a></h2>
<p>SEP on Kubernetes provides automatic configuration of the Hive connector. Such a
connector allows you to either access an external Metastore or use built-in
internal Presto cluster Metastore as well.</p>
<div class="section" id="external-metastore">
<h3><a class="toc-backref" href="#id17">External Metastore</a><a class="headerlink" href="#external-metastore" title="Permalink to this headline">#</a></h3>
<p>You can configure Presto to use an external Hive Metastore by setting the
<code class="code docutils literal notranslate"><span class="pre">hive.metastoreUri</span></code> property, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">metastoreUri</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">thrift://hive-metastore:9083</span>
</pre></div>
</div>
<table class="colwidths-given docutils align-default" id="id6">
<caption><span class="caption-text">External metastore properties</span><a class="headerlink" href="#id6" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>awsSecretName</p></td>
<td></td>
<td><p>Name of the AWS secret to access the metastore</p></td>
</tr>
<tr class="row-odd"><td><p>googleServiceAccountKeySecretName</p></td>
<td></td>
<td><p>Name of the secret key for the Google service account to access the
metastore</p></td>
</tr>
<tr class="row-even"><td><p>azureWasbSecretName</p></td>
<td></td>
<td><p>Name of the secret for the Windows Azure Storage Blob (WASB) to access the
metastore</p></td>
</tr>
<tr class="row-odd"><td><p>azureAbfsSecretName</p></td>
<td></td>
<td><p>Name of the secret for the Azure Blob Filesystem (ABFS) to access the
metastore</p></td>
</tr>
<tr class="row-even"><td><p>azureAdlSecretName</p></td>
<td></td>
<td><p>Name of the secret for the Azure Data Lake (ADL) to access the metastore</p></td>
</tr>
<tr class="row-odd"><td><p>additionalProperties</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">additionalProperties</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">hive.allow-drop-table=true</span>
</pre></div>
</div>
</td>
<td><p>Specify additional properties to configure the Hive connector behavior.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="internal-metastore">
<h3><a class="toc-backref" href="#id18">Internal Metastore</a><a class="headerlink" href="#internal-metastore" title="Permalink to this headline">#</a></h3>
<p>You can configure Presto to use an internal Hive Metastore by setting the
<code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.mySql</span></code> or
<code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.postgreSql</span></code> properties, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">internalMetastore</span><span class="p">:</span>
    <span class="nt">mySql</span><span class="p">:</span>
      <span class="nt">jdbcUrl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://mysql-server/metastore-database</span>
      <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hive</span>
      <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hivePassword</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">internalMetastore</span><span class="p">:</span>
    <span class="nt">postgreSql</span><span class="p">:</span>
      <span class="nt">jdbcUrl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:postgresql://postgresql-server/metastore-database</span>
      <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hive</span>
      <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hivePassword</span>
</pre></div>
</div>
<p>In such a case, an additional Hive Metastore pod is created. It stores the
metadata in the provided PostgreSQL or MySQL database.</p>
<p>You can also make the internal Metastore to use an internal ephemeral PostgreSQL
database. This can be enabled by setting the
<code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.enabled</span></code> to <code class="code docutils literal notranslate"><span class="pre">true</span></code>, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">internalMetastore</span><span class="p">:</span>
    <span class="nt">internalPostgreSql</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>In this case, an additional PostgreSQL pod is created along with the Hive
Metastore pod. This Hive Metastore uses the internal ephemeral PostgreSQL as a
relational database.</p>
<p><strong>Note:</strong> Using the internal ephemeral PostgreSQL is not recommended for
production. Data stored within the internal PostgreSQL is lost when the Presto
cluster is terminated.</p>
<p><strong>Note:</strong> You cannot use external and internal Metastore at the same time. You
also cannot use external and internal relational database for Metastore at the
same time.</p>
</div>
<div class="section" id="customizing-internal-hive-metastore-pod">
<h3><a class="toc-backref" href="#id19">Customizing Internal Hive Metastore Pod</a><a class="headerlink" href="#customizing-internal-hive-metastore-pod" title="Permalink to this headline">#</a></h3>
<p>It possible to customize internal Hive Metastore pod’s Docker image via the
<code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.image</span></code> property, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">internalMetastore</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">customized-internal-hive-metastore:0.1</span>
      <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</pre></div>
</div>
<p>It is possible to change the resources required by Hive Metastore’s pod via:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.cpu</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.memory</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.nodeSelector</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.affinity</span></code></p></li>
</ul>
</div></blockquote>
<p>properties.</p>
</div>
<div class="section" id="customizing-internal-postgresql-docker-pod">
<span id="internal-postgresql"></span><h3><a class="toc-backref" href="#id20">Customizing Internal PostgreSQL Docker Pod</a><a class="headerlink" href="#customizing-internal-postgresql-docker-pod" title="Permalink to this headline">#</a></h3>
<p>It is possible to customize the internal PostgreSQL pod’s Docker image via the
<code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.image</span></code> property, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">internalMetastore</span><span class="p">:</span>
    <span class="nt">internalPostgreSql</span><span class="p">:</span>
      <span class="nt">image</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">customized-internal-postgresql:0.1</span>
        <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</pre></div>
</div>
<p>It is possible to change the resources required by PostgreSQL’s pod via:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.cpu</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.memory</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.nodeSelector</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.affinity</span></code></p></li>
</ul>
</div></blockquote>
<p>properties.</p>
<p>It is possible to specify the storage used by PostgreSQL’s pod via: the
<code class="code docutils literal notranslate"><span class="pre">hive.internalMetastore.internalPostgreSql.storage</span></code> property, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hive</span><span class="p">:</span>
  <span class="nt">internalMetastore</span><span class="p">:</span>
    <span class="nt">internalPostgreSql</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span>
        <span class="nt">className</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db-class</span>
        <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20Gi</span>
        <span class="nt">claimSelector</span><span class="p">:</span>
          <span class="nt">matchLabels</span><span class="p">:</span>
            <span class="nt">release</span><span class="p">:</span> <span class="s">&quot;stable&quot;</span>
          <span class="nt">matchExpressions</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt">key</span><span class="p">:</span> <span class="nv">environment</span><span class="p p-Indicator">,</span><span class="nt"> operator</span><span class="p">:</span> <span class="nv">In</span><span class="p p-Indicator">,</span><span class="nt"> values</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">dev</span><span class="p p-Indicator">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="prometheus-support">
<h2><a class="toc-backref" href="#id21">Prometheus Support</a><a class="headerlink" href="#prometheus-support" title="Permalink to this headline">#</a></h2>
<p>Presto Kubernetes supports exposing Presto metrics to Prometheus. You can use
the <a class="reference external" href="https://github.com/coreos/prometheus-operator">Prometheus Operator</a> in
order to set up Prometheus in your Kubernetes cluster and collect Presto
metrics.</p>
<p>To enable Presto Prometheus metric endpoints set the <code class="code docutils literal notranslate"><span class="pre">prometheus.enabled</span></code>
property to <code class="code docutils literal notranslate"><span class="pre">true</span></code>. This causes the following additional Kubernetes
services to be created:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">prometheus-coordinator-CLUSTER_NAME_UUID</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">prometheus-worker-CLUSTER_NAME_UUID</span></code></p></li>
</ul>
<p>where <code class="code docutils literal notranslate"><span class="pre">CLUSTER_NAME_UUID</span></code> is the cluster name with a unique suffix. Use
the <code class="code docutils literal notranslate"><span class="pre">nameOverride</span></code> property in order to set <code class="code docutils literal notranslate"><span class="pre">CLUSTER_NAME_UUID</span></code> to a
different value.</p>
<p>Those services expose Presto metrics in the Prometheus format. You can use
<a class="reference external" href="https://github.com/coreos/prometheus-operator#customresourcedefinitions">ServiceMonitor</a>
resources from the Prometheus Operator to make Prometheus collect metrics from
those endpoints. In order to match Presto Prometheus endpoints you can use
<a class="reference internal" href="overview.html#labels"><span class="std std-ref">labels</span></a>, e.g.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">matchLabels</span><span class="p">:</span>
  <span class="nt">instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CLUSTER_NAME_UUID</span>
  <span class="nt">role</span><span class="p">:</span> <span class="s">&quot;prometheus-coordinator&quot;</span>
</pre></div>
</div>
<p>The following Presto and JVM metrics are exported by default:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">running_queries</span></code> - number of currently running queries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queued_queries</span></code> - number of currently queued queries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failed_queries</span></code> - total count of failed queries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jvm_gc_collection_seconds_sum</span></code> - total GC (young and old) time in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jvm_gc_collection_seconds_count</span></code> - total GC (young and old) count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jvm_memory_bytes_committed,</span> <span class="pre">jvm_memory_bytes_init,</span> <span class="pre">jvm_memory_bytes_max,</span>
<span class="pre">jvm_memory_bytes_used</span></code> - JVM memory usage metrics (heap and non-heap). For
more information see <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/MemoryMXBean.html">MemoryMXBean</a>.</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="query.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="6.5. Querying Presto" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="deployment.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="6.3. Deployment of Presto on Kubernetes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'338',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>