

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11.15. Window Functions &mdash; Starburst Enterprise Presto</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="11. Functions and Operators" href="../functions.html"/>
        <link rel="next" title="11.16. Array Functions and Operators" href="array.html"/>
        <link rel="prev" title="11.14. Aggregate Functions" href="aggregate.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client.html">3. Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mission-control.html">4. Mission Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">5. Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes.html">6. Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">7. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">8. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">9. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">10. Connectors</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../functions.html">11. Functions and Operators</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="logical.html">11.1. Logical Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison.html">11.2. Comparison Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional.html">11.3. Conditional Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="lambda.html">11.4. Lambda Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="conversion.html">11.5. Conversion Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="math.html">11.6. Mathematical Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="bitwise.html">11.7. Bitwise Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="decimal.html">11.8. Decimal Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="string.html">11.9. String Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="regexp.html">11.10. Regular Expression Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="binary.html">11.11. Binary Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html">11.12. JSON Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="datetime.html">11.13. Date and Time Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="aggregate.html">11.14. Aggregate Functions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11.15. Window Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aggregate-functions">Aggregate Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ranking-functions">Ranking Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#value-functions">Value Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="array.html">11.16. Array Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="map.html">11.17. Map Functions and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="url.html">11.18. URL Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="geospatial.html">11.19. Geospatial Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperloglog.html">11.20. HyperLogLog Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="qdigest.html">11.21. Quantile Digest Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="uuid.html">11.22. UUID Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="color.html">11.23. Color Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="session.html">11.24. Session Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="teradata.html">11.25. Teradata Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="oracle.html">11.26. Oracle Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml.html">11.27. Machine Learning Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="list.html">11.28. List of Functions and Operators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">12. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">13. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">14. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">15. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">16. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">17. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          

        </div>
        <div style="margin-top: 1em; margin-left: 2em;">
          Version <a href="../versions.html">338-e.0 LTS and others</a>
          <br><br>
        <span>
  <select name="versions" id="versions" onChange="window.location.href=this.value">
    <option value="./">Choose another version</option>
    <option value="/338-e/">Latest LTS (338-e)</option>
    <option value="/337-e/">Latest STS (337-e)</option>
    <option value="/336-e/">336-e STS</option>
    <option value="/334-e/">334-e STS</option>
    <option value="/332-e/">332-e LTS</option>
    <option value="/323-e/">323-e LTS</option>
  </select>
</span>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://www.starburstdata.com/">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/starburst-darkbg.png"/></a>
        <span class="optional">
          <a href="../index.html">Starburst Enterprise Presto</a>
          <a href="../versions.html" style="font-size: small;margin-left: 0.5em;">338-e.0 LTS and others</a>
          <a href="https://www.starburstdata.com/oreilly-presto-guide-download/?utm_campaign=O%27Reilly%20Presto%20Book&utm_source=starburst&utm_medium=docs">
            <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px; margin-left: 0.5em;"
          src="../_static/img/ptdg-banner.png"/></a>
          </span>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../functions.html">11. Functions and Operators</a> &raquo;</li>
      
    <li>11.15. Window Functions</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="window-functions">
<h1>11.15. Window Functions<a class="headerlink" href="#window-functions" title="Permalink to this headline">#</a></h1>
<p>Window functions perform calculations across rows of the query result.
They run after the <code class="docutils literal"><span class="pre">HAVING</span></code> clause but before the <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause.
Invoking a window function requires special syntax using the <code class="docutils literal"><span class="pre">OVER</span></code>
clause to specify the window. A window has three components:</p>
<ul class="simple">
<li>The partition specification, which separates the input rows into different
partitions. This is analogous to how the <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause separates rows
into different groups for aggregate functions.</li>
<li>The ordering specification, which determines the order in which input rows
will be processed by the window function.</li>
<li>The window frame, which specifies a sliding window of rows to be processed
by the function for a given row. If the frame is not specified, it defaults
to <code class="docutils literal"><span class="pre">RANGE</span> <span class="pre">UNBOUNDED</span> <span class="pre">PRECEDING</span></code>, which is the same as
<code class="docutils literal"><span class="pre">RANGE</span> <span class="pre">BETWEEN</span> <span class="pre">UNBOUNDED</span> <span class="pre">PRECEDING</span> <span class="pre">AND</span> <span class="pre">CURRENT</span> <span class="pre">ROW</span></code>. This frame contains all
rows from the start of the partition up to the last peer of the current row.
In the absence of <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code>, all rows are considered peers, so <code class="docutils literal"><span class="pre">RANGE</span>
<span class="pre">BETWEEN</span> <span class="pre">UNBOUNDED</span> <span class="pre">PRECEDING</span> <span class="pre">AND</span> <span class="pre">CURRENT</span> <span class="pre">ROW</span></code> is equivalent to <code class="docutils literal"><span class="pre">BETWEEN</span>
<span class="pre">UNBOUNDED</span> <span class="pre">PRECEDING</span> <span class="pre">AND</span> <span class="pre">UNBOUNDED</span> <span class="pre">FOLLOWING</span></code></li>
</ul>
<p>For example, the following query ranks orders for each clerk by price:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">orderkey</span><span class="p">,</span> <span class="n">clerk</span><span class="p">,</span> <span class="n">totalprice</span><span class="p">,</span>
       <span class="n">rank</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">clerk</span>
                    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">totalprice</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rnk</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">clerk</span><span class="p">,</span> <span class="n">rnk</span>
</pre></div>
</div>
<div class="section" id="aggregate-functions">
<h2>Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Permalink to this headline">#</a></h2>
<p>All <a class="reference internal" href="aggregate.html"><span class="doc">Aggregate Functions</span></a> can be used as window functions by adding the <code class="docutils literal"><span class="pre">OVER</span></code>
clause. The aggregate function is computed for each row over the rows within
the current rowâ€™s window frame.</p>
<p>For example, the following query produces a rolling sum of order prices
by day for each clerk:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">clerk</span><span class="p">,</span> <span class="n">orderdate</span><span class="p">,</span> <span class="n">orderkey</span><span class="p">,</span> <span class="n">totalprice</span><span class="p">,</span>
       <span class="k">sum</span><span class="p">(</span><span class="n">totalprice</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">clerk</span>
                             <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">orderdate</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rolling_sum</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">clerk</span><span class="p">,</span> <span class="n">orderdate</span><span class="p">,</span> <span class="n">orderkey</span>
</pre></div>
</div>
</div>
<div class="section" id="ranking-functions">
<h2>Ranking Functions<a class="headerlink" href="#ranking-functions" title="Permalink to this headline">#</a></h2>
<dl class="function">
<dt id="cume_dist">
<code class="descname">cume_dist</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; bigint<a class="headerlink" href="#cume_dist" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the cumulative distribution of a value in a group of values.
The result is the number of rows preceding or peer with the row in the
window ordering of the window partition divided by the total number of
rows in the window partition. Thus, any tie values in the ordering will
evaluate to the same distribution value.</p>
</dd></dl>

<dl class="function">
<dt id="dense_rank">
<code class="descname">dense_rank</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; bigint<a class="headerlink" href="#dense_rank" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the rank of a value in a group of values. This is similar to
<a class="reference internal" href="#rank" title="rank"><code class="xref py py-func docutils literal"><span class="pre">rank()</span></code></a>, except that tie values do not produce gaps in the sequence.</p>
</dd></dl>

<dl class="function">
<dt id="ntile">
<code class="descname">ntile</code><span class="sig-paren">(</span><em>n</em><span class="sig-paren">)</span> &#x2192; bigint<a class="headerlink" href="#ntile" title="Permalink to this definition">#</a></dt>
<dd><p>Divides the rows for each window partition into <code class="docutils literal"><span class="pre">n</span></code> buckets ranging
from <code class="docutils literal"><span class="pre">1</span></code> to at most <code class="docutils literal"><span class="pre">n</span></code>. Bucket values will differ by at most <code class="docutils literal"><span class="pre">1</span></code>.
If the number of rows in the partition does not divide evenly into the
number of buckets, then the remainder values are distributed one per
bucket, starting with the first bucket.</p>
<p>For example, with <code class="docutils literal"><span class="pre">6</span></code> rows and <code class="docutils literal"><span class="pre">4</span></code> buckets, the bucket values would
be as follows: <code class="docutils literal"><span class="pre">1</span></code> <code class="docutils literal"><span class="pre">1</span></code> <code class="docutils literal"><span class="pre">2</span></code> <code class="docutils literal"><span class="pre">2</span></code> <code class="docutils literal"><span class="pre">3</span></code> <code class="docutils literal"><span class="pre">4</span></code></p>
</dd></dl>

<dl class="function">
<dt id="percent_rank">
<code class="descname">percent_rank</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; double<a class="headerlink" href="#percent_rank" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the percentage ranking of a value in group of values. The result
is <code class="docutils literal"><span class="pre">(r</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">/</span> <span class="pre">(n</span> <span class="pre">-</span> <span class="pre">1)</span></code> where <code class="docutils literal"><span class="pre">r</span></code> is the <a class="reference internal" href="#rank" title="rank"><code class="xref py py-func docutils literal"><span class="pre">rank()</span></code></a> of the row and
<code class="docutils literal"><span class="pre">n</span></code> is the total number of rows in the window partition.</p>
</dd></dl>

<dl class="function">
<dt id="rank">
<code class="descname">rank</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; bigint<a class="headerlink" href="#rank" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the rank of a value in a group of values. The rank is one plus
the number of rows preceding the row that are not peer with the row.
Thus, tie values in the ordering will produce gaps in the sequence.
The ranking is performed for each window partition.</p>
</dd></dl>

<dl class="function">
<dt id="row_number">
<code class="descname">row_number</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; bigint<a class="headerlink" href="#row_number" title="Permalink to this definition">#</a></dt>
<dd><p>Returns a unique, sequential number for each row, starting with one,
according to the ordering of rows within the window partition.</p>
</dd></dl>

</div>
<div class="section" id="value-functions">
<h2>Value Functions<a class="headerlink" href="#value-functions" title="Permalink to this headline">#</a></h2>
<p>By default, null values are respected. If <code class="docutils literal"><span class="pre">IGNORE</span> <span class="pre">NULLS</span></code> is specified, all rows where
<code class="docutils literal"><span class="pre">x</span></code> is null are excluded from the calculation. If <code class="docutils literal"><span class="pre">IGNORE</span> <span class="pre">NULLS</span></code> is specified and <code class="docutils literal"><span class="pre">x</span></code>
is null for all rows, the <code class="docutils literal"><span class="pre">default_value</span></code> is returned, or if it is not specified,
<code class="docutils literal"><span class="pre">null</span></code> is returned.</p>
<dl class="function">
<dt id="first_value">
<code class="descname">first_value</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span> &#x2192; [same as input]<a class="headerlink" href="#first_value" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the first value of the window.</p>
</dd></dl>

<dl class="function">
<dt id="last_value">
<code class="descname">last_value</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span> &#x2192; [same as input]<a class="headerlink" href="#last_value" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the last value of the window.</p>
</dd></dl>

<dl class="function">
<dt id="nth_value">
<code class="descname">nth_value</code><span class="sig-paren">(</span><em>x</em>, <em>offset</em><span class="sig-paren">)</span> &#x2192; [same as input]<a class="headerlink" href="#nth_value" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the value at the specified offset from the beginning of the window.
Offsets start at <code class="docutils literal"><span class="pre">1</span></code>. The offset can be any scalar
expression.  If the offset is null or greater than the number of values in
the window, <code class="docutils literal"><span class="pre">null</span></code> is returned.  It is an error for the offset to be zero or
negative.</p>
</dd></dl>

<dl class="function">
<dt id="lead">
<code class="descname">lead</code><span class="sig-paren">(</span><em>x</em><span class="optional">[</span>, <em>offset</em><span class="optional">[</span>, <em>default_value</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> &#x2192; [same as input]<a class="headerlink" href="#lead" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the value at <code class="docutils literal"><span class="pre">offset</span></code> rows after the current row in the window partition.
Offsets start at <code class="docutils literal"><span class="pre">0</span></code>, which is the current row. The
offset can be any scalar expression.  The default <code class="docutils literal"><span class="pre">offset</span></code> is <code class="docutils literal"><span class="pre">1</span></code>. If the
offset is null, <code class="docutils literal"><span class="pre">null</span></code> is returned. If the offset refers to a row that is not
within the partition, the <code class="docutils literal"><span class="pre">default_value</span></code> is returned, or if it is not specified
<code class="docutils literal"><span class="pre">null</span></code> is returned.
The <a class="reference internal" href="#lead" title="lead"><code class="xref py py-func docutils literal"><span class="pre">lead()</span></code></a> function requires that the window ordering be specified.
Window frame must not be specified.</p>
</dd></dl>

<dl class="function">
<dt id="lag">
<code class="descname">lag</code><span class="sig-paren">(</span><em>x</em><span class="optional">[</span>, <em>offset</em><span class="optional">[</span>, <em>default_value</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> &#x2192; [same as input]<a class="headerlink" href="#lag" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the value at <code class="docutils literal"><span class="pre">offset</span></code> rows before the current row in the window partition.
Offsets start at <code class="docutils literal"><span class="pre">0</span></code>, which is the current row. The
offset can be any scalar expression.  The default <code class="docutils literal"><span class="pre">offset</span></code> is <code class="docutils literal"><span class="pre">1</span></code>. If the
offset is null, <code class="docutils literal"><span class="pre">null</span></code> is returned. If the offset refers to a row that is not
within the partition, the <code class="docutils literal"><span class="pre">default_value</span></code> is returned, or if it is not specified
<code class="docutils literal"><span class="pre">null</span></code> is returned.
The <a class="reference internal" href="#lag" title="lag"><code class="xref py py-func docutils literal"><span class="pre">lag()</span></code></a> function requires that the window ordering be specified.
Window frame must not be specified.</p>
</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="array.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="11.16. Array Functions and Operators" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="aggregate.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="11.14. Aggregate Functions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'338-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>