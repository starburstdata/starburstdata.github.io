

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.9. Usage Metrics &mdash; Starburst Enterprise Presto</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="8. Administration" href="../admin.html"/>
        <link rel="next" title="9. Query Optimizer" href="../optimizer.html"/>
        <link rel="prev" title="8.8. Distributed Sort" href="dist-sort.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client.html">3. Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">4. Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s.html">5. Kubernetes with Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes.html">6. Kubernetes operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">7. Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../admin.html">8. Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="web-interface.html">8.1. Web UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="tuning.html">8.2. Tuning Presto</a></li>
<li class="toctree-l2"><a class="reference internal" href="jmx.html">8.3. Monitoring with JMX</a></li>
<li class="toctree-l2"><a class="reference internal" href="properties.html">8.4. Properties Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="spill.html">8.5. Spill to Disk</a></li>
<li class="toctree-l2"><a class="reference internal" href="resource-groups.html">8.6. Resource Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="session-property-managers.html">8.7. Session Property Managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="dist-sort.html">8.8. Distributed Sort</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.9. Usage Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging-details-and-analysis">Logging Details and Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#persisting-metrics">Persisting Metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">9. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">10. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">11. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">12. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">13. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">14. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">15. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">16. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">17. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          

        </div>
        <div style="margin-top: 1em; margin-left: 2em;">
          Version <a href="../versions.html">338-e LTS and others</a>
          <br><br>
        <span>
  <select name="versions" id="versions" onChange="window.location.href=this.value">
    <option value="./">Choose another version</option>
    <option value="/356-e/">Latest LTS (356-e)</option>
    <option value="/350-e/">350-e LTS</option>
    <option value="/345-e/">345-e LTS</option>
    <option value="/338-e/">338-e LTS</option>
    <option value="/357-e/">Latest STS (357-e)</option>
    <option value="/355-e/">355-e STS</option>
  </select>
</span>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://www.starburstdata.com/">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/starburst-darkbg.png"/></a>
        <span class="optional">
          <a href="../index.html">Starburst Enterprise Presto</a>
          <a href="../versions.html" style="font-size: small;margin-left: 0.5em;">338-e LTS and others</a>
          <a href="https://www.starburstdata.com/oreilly-presto-guide-download/?utm_campaign=O%27Reilly%20Presto%20Book&utm_source=starburst&utm_medium=docs">
            <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px; margin-left: 0.5em;"
          src="../_static/img/ptdg-banner.png"/></a>
          </span>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../admin.html"><span class="section-number">8. </span>Administration</a> &raquo;</li>
      
    <li><span class="section-number">8.9. </span>Usage Metrics</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage-metrics">
<h1><span class="section-number">8.9. </span>Usage Metrics<a class="headerlink" href="#usage-metrics" title="Permalink to this headline">#</a></h1>
<p>Usage metrics collection enables Presto to log information about all nodes in
the cluster. This feature is mostly used for Mission Control and other
management solutions. Users can use the resulting log information for their own
monitoring and operational purposes.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#configuration" id="id2">Configuration</a></p></li>
<li><p><a class="reference internal" href="#logging-details-and-analysis" id="id3">Logging Details and Analysis</a></p></li>
<li><p><a class="reference internal" href="#persisting-metrics" id="id4">Persisting Metrics</a></p></li>
</ul>
</div>
<div class="section" id="configuration">
<h2><a class="toc-backref" href="#id2">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">#</a></h2>
<p>Usage metrics collection is configured by a number of properties, that you can
add in <code class="docutils literal notranslate"><span class="pre">etc/config.properties</span></code> to configure details.</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Usage Metrics Configuration Properties</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 70%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.log.path</span></code></p></td>
<td><p>Base path of the usage log files</p></td>
<td><p>var/log/presto/usage-metrics.log</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.log.max-size</span></code></p></td>
<td><p>Maximum size of a single usage log file</p></td>
<td><p>100 MB, minimum 1MB</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.log.max-history</span></code></p></td>
<td><p>Maximum number of usage log files</p></td>
<td><p>1000</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.cloud-watch-logs-directory</span></code></p></td>
<td><p>Path to the directory on the node in which log files are stored, for
example, <code class="docutils literal notranslate"><span class="pre">/var/log/presto/cloudwatch</span></code>. Amazon CloudWatch is
automatically enabled by the Presto CFT and the usage metrics data is
available in <code class="docutils literal notranslate"><span class="pre">usage-metrics-*</span></code> log streams.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.gathering.initial-delay</span></code></p></td>
<td><p>The initial delay to before tracking usage, allowing the cluster to start
up before metrics gathering starts.</p></td>
<td><p>1 min</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.gathering.interval</span></code></p></td>
<td><p>Length of the interval between usage metric log entry creation.</p></td>
<td><p>1 min</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.gatherer-threads</span></code></p></td>
<td><p>Number of threads used to gather and write all usage information.</p></td>
<td><p>100, minimum 10</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usage-metrics.cluster-usage-resource.enabled</span></code></p></td>
<td><p>Expose the usage metrics, aggregated for all nodes since cluster start,
on a REST API end point on the coordinator at <code class="docutils literal notranslate"><span class="pre">/v1/cluster/usage</span></code></p></td>
<td><p>false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="logging-details-and-analysis">
<h2><a class="toc-backref" href="#id3">Logging Details and Analysis</a><a class="headerlink" href="#logging-details-and-analysis" title="Permalink to this headline">#</a></h2>
<p>The logged information includes details about number of nodes, number of cores,
start time, cpu time, and other data about the cluster and nodes in the
cluster. The log uses JSON format for each entry.</p>
<p>The JSON information can be inspected manually, ingested in any logging analysis
or management tool, and also parsed with the <a class="reference internal" href="../installation/download.html#download-others"><span class="std std-ref">metrics parser tools
available from Starburst</span></a>. The parser is a command line
application that can be run directly or with the <code class="docutils literal notranslate"><span class="pre">java</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mv starburst-usage-metrics-parser-*-executable.jar usage-metrics-parser
chmod a+x usage-metrics-parser
./usage-metrics-parser
<span class="c1"># or</span>
java -jar usage-metrics-parser
</pre></div>
</div>
<p>Save the logs to local empty folder and use the parser with appropriate
arguments:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>usage-metrics-parser --from &lt;from&gt; --to &lt;to&gt; &lt;path&gt;
</pre></div>
</div>
<p>The parameters <code class="docutils literal notranslate"><span class="pre">&lt;from&gt;/&lt;to&gt;</span></code> define date-time range and <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code> points to
folder with the log files. The resulting output shows the analysis results:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cluster restarts: <span class="m">1</span>, cpu time: <span class="m">265</span>.55s, available cpu time: <span class="m">93130</span>.57s, cpu utilization: <span class="m">0</span>.29%, min cores: <span class="m">16</span>, max cores: <span class="m">16</span>
</pre></div>
</div>
</div>
<div class="section" id="persisting-metrics">
<span id="usage-metrics-persisting"></span><h2><a class="toc-backref" href="#id4">Persisting Metrics</a><a class="headerlink" href="#persisting-metrics" title="Permalink to this headline">#</a></h2>
<p>Understanding the usage of your cluster requires persisting the usage metrics.
By default the metrics are not persisted.</p>
<p>The simplest mechanism to persist metrics is to configure the path of the log
file to a location that is separate from the filesystem of the coordinator.
Typically this is a network location that is mounted.</p>
<p>The <a class="reference internal" href="../aws.html"><span class="doc">CFT setup</span></a> automatically configures persisting the metrics in
CloudWatch. Users of Amazon EKS can <a class="reference external" href="https://aws.amazon.com/blogs/containers/how-to-capture-application-logs-when-using-amazon-eks-on-aws-fargate/">also use CloudWatch as well</a>.</p>
<p>Logs exported from CloudWatch are decorated and have to be pre-processed to
limit information to the raw format displayed in the preceding section to
process it with the metrics parser.</p>
<p>Log management solutions integrated with other cloud platforms, or available
separately, allow persisting the metrics by capturing the log file or regularly
inspecting the REST endpoint.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../optimizer.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="9. Query Optimizer" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dist-sort.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="8.8. Distributed Sort" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'338',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>