

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="253746">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Hive Connector Storage Caching &#8212; Starburst Enterprise Presto</title>
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/starburst.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hive connector with Alluxio" href="hive-alluxio.html" />
    <link rel="prev" title="Hive Connector GCS Tutorial" href="hive-gcs-tutorial.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#connector/hive-caching" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Starburst Enterprise Presto"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/Starburst_Logo_NoTag_White.png" height="26"
                   alt="Starburst Enterprise Presto logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Starburst Enterprise Presto</span>
          <span class="md-header-nav__topic"> Hive Connector Storage Caching </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose another version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (338-e)" href="/338-e/">Latest LTS (338-e)</a>
      
          <a title="332-e LTS" href="/332-e/">332-e LTS</a>
      
          <a title="323-e LTS" href="/323-e/">323-e LTS</a>
      
          <a title="Latest STS (341-e)" href="/341-e/">Latest STS (341-e)</a>
      
          <a title="340-e STS" href="/340-e/">340-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../connector.html" class="md-tabs__link">Connectors</a></li>
          <li class="md-tabs__item"><a href="hive.html" class="md-tabs__link">Hive Connector</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Starburst Enterprise Presto" class="md-nav__button md-logo">
      
        <img src="../_static/Starburst_Logo_NoTag_White.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Starburst Enterprise Presto">Starburst Enterprise Presto</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../aws.html" class="md-nav__link">Amazon Web Services</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../k8s.html" class="md-nav__link">Kubernetes with Helm</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../kubernetes.html" class="md-nav__link">Kubernetes operator</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="starburst-connectors.html" class="md-nav__link">Starburst connectors overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-db2.html" class="md-nav__link">Starburst IBM DB2 connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-generic-jdbc.html" class="md-nav__link">Starburst Generic JDBC connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-hive.html" class="md-nav__link">Starburst Hive connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-hive-security.html" class="md-nav__link">Starburst Hive connector security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-hive-ibm-cos.html" class="md-nav__link">IBM Cloud Object Storage support for the Hive connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-hive-mapr.html" class="md-nav__link">MapR Hive support</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-hive-cdp.html" class="md-nav__link">Cloudera Data Platform support</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-delta-lake.html" class="md-nav__link">Starburst Delta Lake connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-kafka.html" class="md-nav__link">Starburst Kafka connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-mysql.html" class="md-nav__link">Starburst MySQL connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-oracle.html" class="md-nav__link">Starburst Oracle connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-postgresql.html" class="md-nav__link">Starburst PostgreSQL connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-snowflake.html" class="md-nav__link">Starburst Snowflake connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-sqlserver.html" class="md-nav__link">Starburst SQL Server connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-teradata.html" class="md-nav__link">Starburst Teradata connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="accumulo.html" class="md-nav__link">Accumulo connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="bigquery.html" class="md-nav__link">BigQuery connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="blackhole.html" class="md-nav__link">Black hole connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cassandra.html" class="md-nav__link">Cassandra connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="druid.html" class="md-nav__link">Druid connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="elasticsearch.html" class="md-nav__link">Elasticsearch connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="googlesheets.html" class="md-nav__link">Google Sheets connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive.html" class="md-nav__link">Hive connector</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="hive-security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-s3.html" class="md-nav__link">Amazon S3</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-azure.html" class="md-nav__link">Azure Storage</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-gcs-tutorial.html" class="md-nav__link">GCS Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Storage Caching </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Storage Caching</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#connector-hive-caching--page-root" class="md-nav__link">Hive Connector Storage Caching</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#benefits" class="md-nav__link">Benefits</a>
        </li>
        <li class="md-nav__item"><a href="#architecture" class="md-nav__link">Architecture</a>
        </li>
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a>
        </li>
        <li class="md-nav__item"><a href="#recommendations" class="md-nav__link">Recommendations</a>
        </li>
        <li class="md-nav__item"><a href="#object-storage-systems" class="md-nav__link">Object storage systems</a>
        </li>
        <li class="md-nav__item"><a href="#metrics" class="md-nav__link">Metrics</a>
        </li>
        <li class="md-nav__item"><a href="#limitations" class="md-nav__link">Limitations</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-alluxio.html" class="md-nav__link">Alluxio</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jmx.html" class="md-nav__link">JMX connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iceberg.html" class="md-nav__link">Iceberg connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kafka.html" class="md-nav__link">Kafka connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kinesis.html" class="md-nav__link">Kinesis connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kudu.html" class="md-nav__link">Kudu connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="localfile.html" class="md-nav__link">Local file connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="memory.html" class="md-nav__link">Memory connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mongodb.html" class="md-nav__link">MongoDB connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="memsql.html" class="md-nav__link">MemSQL connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mysql.html" class="md-nav__link">MySQL connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="oracle.html" class="md-nav__link">Oracle connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="phoenix.html" class="md-nav__link">Phoenix connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pinot.html" class="md-nav__link">Pinot connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="postgresql.html" class="md-nav__link">PostgreSQL connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="prometheus.html" class="md-nav__link">Prometheus connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="redis.html" class="md-nav__link">Redis connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="redshift.html" class="md-nav__link">Redshift connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sqlserver.html" class="md-nav__link">SQL Server connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="system.html" class="md-nav__link">System connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="thrift.html" class="md-nav__link">Thrift connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tpcds.html" class="md-nav__link">TPCDS connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tpch.html" class="md-nav__link">TPCH connector</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../404.html" class="md-nav__link">-</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../versions.html" class="md-nav__link">343-e STS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#connector-hive-caching--page-root" class="md-nav__link">Hive Connector Storage Caching</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#benefits" class="md-nav__link">Benefits</a>
        </li>
        <li class="md-nav__item"><a href="#architecture" class="md-nav__link">Architecture</a>
        </li>
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a>
        </li>
        <li class="md-nav__item"><a href="#recommendations" class="md-nav__link">Recommendations</a>
        </li>
        <li class="md-nav__item"><a href="#object-storage-systems" class="md-nav__link">Object storage systems</a>
        </li>
        <li class="md-nav__item"><a href="#metrics" class="md-nav__link">Metrics</a>
        </li>
        <li class="md-nav__item"><a href="#limitations" class="md-nav__link">Limitations</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="connector-hive-caching--page-root">Hive Connector Storage Caching<a class="headerlink" href="#connector-hive-caching--page-root" title="Permalink to this headline">#</a></h1>
<p>Querying object storage with the <a class="reference internal" href="hive.html"><span class="doc">Hive Connector</span></a> is a
very common use case for Presto. It often involves the transfer of large amounts
of data. The objects are retrieved from HDFS, or any other supported object
storage, by multiple workers and processed on these workers. Repeated queries
with different parameters, or even different queries from different users, often
access, and therefore transfer, the same objects.</p>

<h2 id="benefits">Benefits<a class="headerlink" href="#benefits" title="Permalink to this headline">#</a></h2>
<p>Enabling caching can result in significant benefits:</p>
<p><strong>Reduced load on object storage</strong></p>
<p>Every retrieved and cached object avoids repeated retrieval from the storage in
subsequent queries. As a result the object storage system does not have to
provide the object again and again.</p>
<p>For example, if your query accesses 100MB of objects from the storage, the first
time the query runs 100MB are downloaded and cached. Any following query uses
these objects. If your users run another 100 queries accessing the same objects,
your storage system does not have to do any significant work. Without caching it
has to provide the same objects again and again, resulting in 10GB of total
storage to serve.</p>
<p>This reduced load on the object storage can also impact the sizing, and
therefore the cost, of the object storage system.</p>
<p><strong>Increased query performance</strong></p>
<p>Caching can provide significant performance benefits, by avoiding the repeated
network transfers and instead accessing copies of the objects from a local
cache. Performance gains are more significant if the performance of directly
accessing the object storage is low compared to accessing the cache.</p>
<p>For example, if you access object storage in a different network, different data
center or even different cloud-provider region query performance is slow. Adding
caching using fast, local storage has a significant impact and makes your
queries much faster.</p>
<p>On the other hand, if you object storage is already running at very high
performance for I/O and network access, and your local cache storage is at
similar speeds, or even slower, performance benefits can be minimal.</p>
<p><strong>Reduced query costs</strong></p>
<p>A result of the reduced load on the object storage, mentioned earlier, is
significantly reduced network traffic. Network traffic however is a considerable
cost factor in an setup, specifically also when hosted in public cloud provider
systems.</p>


<h2 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">#</a></h2>
<p>Caching can operate in two modes. The default async mode provides the queried
data directly and caches any objects asynchronously afterwards. Any following
queries requesting the cached objects are served directly from the cache.</p>
<p>The other mode is a read-through cache. After first retrieval from storage by
any query, objects are cached in the local cache storage on the workers.</p>
<p>In both modes objects are cached on local storage of each worker and managed by
a BookKeeper component. Workers can request cached objects from other workers to
avoid requests from the object storage.</p>
<p>The cache chunks are 1MB in size and are well suited for ORC or Parquet file
formats.</p>


<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">#</a></h2>
<p>The caching feature is part of the <a class="reference internal" href="hive.html"><span class="doc">Hive Connector</span></a> and
can be activated in the catalog properties file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>connector.name=hive-hadoop2
hive.cache.enabled=true
hive.cache.location=/opt/hive-cache
</pre></div>
</div>
<p>The cache operates on the coordinator and all workers accessing the object
storage. The used networking ports for the managing BookKeeper and the data
transfer, by default 8898 and 8899, need to be available.</p>
<p>To use caching on multiple catalogs, you need to configure different caching
directories  and different BookKeeper and data-transfer ports.</p>
<table id="id1">
<caption><span class="caption-text"><strong>Cache Configuration Parameters</strong></span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 15%"/>
<col style="width: 80%"/>
<col style="width: 5%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.enabled</span></code></p></td>
<td><p>Toggle to enable or disable caching</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.location</span></code></p></td>
<td><p>Required directory location to use for the cache storage on each worker.
Separate multiple directories, which can be mountpoints for separate drives, with commas
<code class="docutils literal notranslate"><span class="pre">hive.cache.location=/var/lib/presto/cache1,/var/lib/presto/cache2</span></code>.
More tips can be found in the <a class="reference internal" href="#hive-cache-recommendations"><span class="std std-ref">recommendations</span></a>.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.data-transfer-port</span></code></p></td>
<td><p>The TCP/IP port used to transfer data managed by the cache.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8898</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.bookkeeper-port</span></code></p></td>
<td><p>The TCP/IP port used by the BookKeeper managing the cache.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8899</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.read-mode</span></code></p></td>
<td><p>Operational mode for the cache as described earlier in the architecture
section. <code class="docutils literal notranslate"><span class="pre">async</span></code> and <code class="docutils literal notranslate"><span class="pre">read-through</span></code> are the supported.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">async</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.ttl</span></code></p></td>
<td><p>Time to live for objects in the cache. Objects, which have not been
requested for the TTL value, are removed from the cache.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">7d</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hive.cache.disk-usage-percentage</span></code></p></td>
<td><p>Percentage of disk space used for cached data</p></td>
<td><p>80</p></td>
</tr>
</tbody>
</table>


<span id="hive-cache-recommendations"></span><h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this headline">#</a></h2>
<p>The speed of the local cache storage is crucial to the performance of the cache.
The most common and cost efficient approach is to attach high performance SSD
disk or equivalents. Fast cache performance can be also be achieved with a RAM
disk used as in-memory.</p>
<p>In all cases, you should avoid using the root partition and disk of the node and
instead attach at multiple dedicated storage devices for the cache on each node.
The cache uses the disk up to a configurable percentage. Storage should be local
on each coordinator and worker node. The directory needs to exist before Presto
starts. We recommend using multiple devices to improve performance of the cache.</p>
<p>The capacity of the attached storage devices should be about 20-30% larger than
the size of the queried object storage workload. For example, your current query
workload typically accesses partitions in your HDFS storage that encapsulate
data for the last 3 months. The overall size of these partitions is currently at
1TB. As a result your cache drives have to have a total capacity of 1.2 TB or
more.</p>
<p>Your deployment method for Presto decides how to create the directory for
caching. Typically you need to connect a fast storage system, like an SSD drive,
and ensure that is it mounted on the configured path. Kubernetes, CFT and other
systems allow this via volumes.</p>


<h2 id="object-storage-systems">Object storage systems<a class="headerlink" href="#object-storage-systems" title="Permalink to this headline">#</a></h2>
<p>The following object storage systems are tested:</p>
<ul class="simple">
<li><p>HDFS</p></li>
<li><p><a class="reference internal" href="hive-s3.html"><span class="doc">Amazon S3 and S3-compatible systems</span></a></p></li>
<li><p><a class="reference internal" href="hive-azure.html"><span class="doc">Azure storage systems</span></a></p></li>
<li><p>Google Cloud Storage</p></li>
</ul>


<h2 id="metrics">Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">#</a></h2>
<p>In order to verify how caching works on your system you can take multiple
approaches:</p>
<ul class="simple">
<li><p>Inspect the disk usage on the cache storage drives on all nodes</p></li>
<li><p>Query the metrics of the caching system exposed by JMX</p></li>
</ul>
<p>The implementation of the cache exposes a <a class="reference external" href="https://rubix.readthedocs.io/en/latest/metrics.html">number of metrics</a> via JMX. You can
<a class="reference internal" href="../admin/jmx.html"><span class="doc">inspect these and other metrics directly in Presto with the JMX connector
or in external tools</span></a>.</p>
<p>Basic caching statistics for the catalog are available in the
<code class="docutils literal notranslate"><span class="pre">jmx.current."rubix:catalog=&lt;catalog_name&gt;,name=stats"</span></code> table.
The table <code class="docutils literal notranslate"><span class="pre">jmx.current."rubix:catalog=&lt;catalog_name&gt;,name=stats</span></code>
contains more detailed statistics.</p>
<p>The following example query returns the average cache hit ratio for the <code class="docutils literal notranslate"><span class="pre">hive</span></code> catalog:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">avg</span><span class="p">(</span><span class="n">cache_hit</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">jmx</span><span class="p">.</span><span class="k">current</span><span class="p">.</span><span class="ss">"rubix:catalog=hive,name=stats"</span>
<span class="k">WHERE</span> <span class="k">NOT</span> <span class="n">is_nan</span><span class="p">(</span><span class="n">cache_hit</span><span class="p">);</span>
</pre></div>
</div>


<h2 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">#</a></h2>
<p>Caching does not support user impersonation and cannot be used with HDFS secured by Kerberos.
It does not take any user-specific access rights to the object storage into account.
The cached objects are simply transparent binary blobs to the caching system and full
access to all content is available.</p>




          </article>
        </div>
      </div>
    </main>
  </div>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hive-gcs-tutorial.html" title="Hive Connector GCS Tutorial"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Hive Connector GCS Tutorial </span>
              </div>
            </a>
          
          
            <a href="hive-alluxio.html" title="Hive connector with Alluxio"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Hive connector with Alluxio </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>

<!-- custom footer should go here in time -->

<div style="background: #253746; align-content: center; height: 3em;"> 
</div>
  </body>
</html>