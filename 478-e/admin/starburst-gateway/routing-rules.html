
<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CY10FQPGJS"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-CY10FQPGJS');
</script>
  
  
    <title>Routing rules &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=bbebba6e" />
    <link rel="stylesheet" type="text/css" href="../../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/algolia.css?v=0e0f969e" />
    <link rel="stylesheet" type="text/css" href="../../_static/starburst.css?v=c0e612e9" />
    <link rel="stylesheet" type="text/css" href="../../_static/search.css?v=87ff3654" />
    <link rel="stylesheet" type="text/css" href="../../_static/sidebar.css?v=7da5440c" />
    <script src="../../_static/documentation_options.js?v=a68ab161"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=e378d701"></script>
    <script src="../../_static/main.js?v=45c62a64"></script>
    <script src="../../_static/heap_analytics.js?v=eba036f6"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Security" href="security.html" />
    <link rel="prev" title="Routing logic" href="routing-logic.html" />

  
   

<link href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" >


<!-- Always link to the latest version, as canonical -->
<link rel="canonical" href="https://docs.starburst.io/latest/admin/starburst-gateway/routing-rules.html">

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#admin/starburst-gateway/routing-rules" tabindex="1" class="md-skip"> Skip to content </a>
  
<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.starburst.io" title="Starburst Enterprise"
          class="md-header-nav__button md-logo">
            <img src="../../_static/img/Starburst_Logo_White+Blue.svg"
              alt="Starburst Enterprise 478-e STS logo">
        </a>
      </div>
      <span class="header-divider"></span>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <a href="/starburst-enterprise/index.html"
          class="md-header-nav__topic">
          Documentation: Starburst Enterprise 478-e STS</a>
          <span class="md-header-nav__topic"> Routing rules </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        <div id="algolia-search">
  <div id="searchbox"></div>
  <div id="product-list">
    <h6 class="filter-label">Product:</h6>
  </div>
  <div id="versionsRefinementList" id="version-list" style="display:none"></div>
  <div id="hits"></div>
  <div id="stats"></div>
</div>
      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (477-e)" href="/477-e/">Latest LTS (477-e)</a>
      
          <a title="476-e LTS" href="/476-e/">476-e LTS</a>
      
          <a title="474-e LTS" href="/474-e/">474-e LTS</a>
      
          <a title="468-e LTS" href="/468-e/">468-e LTS</a>
      
          <a title="Latest STS (478-e)" href="/478-e/">Latest STS (478-e)</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>


  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/introduction/index.html" class="md-tabs__link">Introduction</a></li>
            
            <li class="md-tabs__item"><a href="/clients/index.html" class="md-tabs__link">Clients</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-galaxy/index.html" class="md-tabs__link">Starburst Galaxy</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-enterprise/index.html" class="md-tabs__link">Starburst Enterprise</a></li>
            
            <li class="md-tabs__item"><a href="/resources.html" class="md-tabs__link">Resources</a></li>
          <li class="md-tabs__item"><a href="../../admin.html" class="md-tabs__link">Performance, logging, and governance features</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Starburst Gateway</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="Starburst Enterprise">Starburst Enterprise 478-e STS</a>
  </label>
  
  
  <p class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get-started/starburst-enterprise.html">What is Starburst Enterprise?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get-started/try/try-sep.html">Try Starburst Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learn/index.html">Learn Starburst Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Product versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.starburst.io/support.html">Get support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For all users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/sep-ui.html">Starburst Enterprise web UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../starburst-ai/index.html">Starburst AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client.html">Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data-products.html">Data products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../insights.html">Insights</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use SQL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language.html">SQL language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql.html">SQL statement syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html">Functions and operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../udf.html">User-defined functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For data engineers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../catalogs.html">Define catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../object-storage.html">Object storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data-engineering/materialized-views.html">Materialized views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data-engineering/data-maintenance.html">Data maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../optimizer.html">Query optimizer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Connect to data sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../connector.html">Connector overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../object-storage-connectors.html">Object storage connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non-object-storage-connectors.html">Non-object storage connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utilities.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community-connectors.html">Community-supported connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../starburst-catalog.html">Starburst catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connector/starburst-connectors.html">Starburst connectors feature matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data-engineering/cost-and-performance/index.html">Monitor and manage cost and performance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For platform administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-topics.html">Administration topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin.html">Performance, logging, and governance features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../starburst-rest-api.html">Starburst Enterprise REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deploy in cloud ecosystems</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystems/aws/index.html">AWS ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystems/google/index.html">Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystems/microsoft/index.html">Microsoft Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystems/redhat/index.html">Red Hat OpenShift</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEP deployment mechanisms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license-requirements.html">Starburst Enterprise license</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../k8s.html">Deploy with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../starburst-admin.html">Deploy with Starburst Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aws.html">Deploy with CFT on AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Local installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../develop.html">Trino developer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix.html">Version-specific notices and information</a></li>
</ul>
  
  
</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
  <div class="local-toc">
    <strong>Contents</strong>
    <ul>
<li><a class="reference internal" href="#">Routing rules</a><ul>
<li><a class="reference internal" href="#default-routing-behavior">Default routing behavior</a></li>
<li><a class="reference internal" href="#custom-routing">Custom routing</a></li>
<li><a class="reference internal" href="#enable-routing-rules">Enable routing rules</a></li>
<li><a class="reference internal" href="#file-based-routing-rules">File-based routing rules</a><ul>
<li><a class="reference internal" href="#available-objects">Available objects</a></li>
<li><a class="reference internal" href="#optional-objects">Optional objects</a></li>
<li><a class="reference internal" href="#expression-language">Expression language</a></li>
<li><a class="reference internal" href="#mvel-operators">MVEL operators</a><ul>
<li><a class="reference internal" href="#flow-control">Flow control</a></li>
</ul>
</li>
<li><a class="reference internal" href="#execution-order">Execution order</a></li>
<li><a class="reference internal" href="#sharing-state-between-rules">Sharing state between rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#external-service-routing-rules">External service routing rules</a><ul>
<li><a class="reference internal" href="#request-format">Request format</a></li>
<li><a class="reference internal" href="#response-format">Response format</a></li>
<li><a class="reference internal" href="#http-client-configuration">HTTP client configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#health-status">Health status</a></li>
<li><a class="reference internal" href="#request-analysis-configuration">Request analysis configuration</a><ul>
<li><a class="reference internal" href="#configuration-options">Configuration options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-information-extraction">User information extraction</a><ul>
<li><a class="reference internal" href="#available-methods">Available methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#query-analysis">Query analysis</a><ul>
<li><a class="reference internal" href="#id2">Available methods</a></li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>

              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="routing-rules">
<h1 id="admin-starburst-gateway-routing-rules--page-root">Routing rules<a class="headerlink" href="#admin-starburst-gateway-routing-rules--page-root" title="Link to this heading">#</a></h1>
<p>Starburst Gateway includes a routing rules engine that lets you customize how the
Gateway routes requests to backend clusters.</p>
<section id="default-routing-behavior">
<h2 id="default-routing-behavior">Default routing behavior<a class="headerlink" href="#default-routing-behavior" title="Link to this heading">#</a></h2>
<p>By default, Starburst Gateway reads the <code class="docutils literal notranslate"><span class="pre">X-Trino-Routing-Group</span></code> request header to
route requests. If you do not specify this header, the Gateway sends requests to
the default routing group called <code class="docutils literal notranslate"><span class="pre">adhoc</span></code>.</p>
</section>
<section id="custom-routing">
<h2 id="custom-routing">Custom routing<a class="headerlink" href="#custom-routing" title="Link to this heading">#</a></h2>
<p>The routing rules engine enables you to create custom routing logic based on
request information such as <a class="reference external" href="https://trino.io/docs/current/develop/client-protocol.html#client-request-headers">request
headers</a>.
You can either:</p>
<ul class="simple">
<li><p>Define routing logic in your configuration file</p></li>
<li><p>Use a custom, external service</p></li>
</ul>
</section>
<section id="enable-routing-rules">
<h2 id="enable-routing-rules">Enable routing rules<a class="headerlink" href="#enable-routing-rules" title="Link to this heading">#</a></h2>
<p>To configure the routing rules engine in your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file, use the
following configuration properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rulesEngineEnabled</span></code>: Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable the routing rules engine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rulesType</span></code>: Set to <code class="docutils literal notranslate"><span class="pre">FILE</span></code> for file-based rules or <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code> for external
service routing (default: <code class="docutils literal notranslate"><span class="pre">FILE</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rulesConfigPath</span></code>: The path to your routing rules configuration file (required
when <code class="docutils literal notranslate"><span class="pre">rulesType</span></code> is <code class="docutils literal notranslate"><span class="pre">FILE</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rulesRefreshPeriod</span></code>: Specifies how often the rules file reloads (default:
<code class="docutils literal notranslate"><span class="pre">1m</span></code>.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rulesExternalConfiguration</span></code> The URL for an external routing service (required
for when <code class="docutils literal notranslate"><span class="pre">rulesType</span></code> is <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code>)</p></li>
</ul>
<p>See the following example configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">routingRules</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rulesEngineEnabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">rulesType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FILE</span><span class="w">  </span><span class="c1"># or EXTERNAL</span>
<span class="w">    </span><span class="nt">rulesConfigPath</span><span class="p">:</span><span class="w"> </span><span class="s">"app/config/routing_rules.yml"</span><span class="w">  </span><span class="c1"># for FILE type</span>
<span class="w">    </span><span class="nt">rulesExternalConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="nt">urlPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://router.example.com/gateway-rules</span><span class="w">  </span><span class="c1"># for EXTERNAL type</span>
<span class="w">        </span><span class="nt">excludeHeaders</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'Authorization'</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'Accept-Encoding'</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If there are errors parsing the routing rules configuration file, Starburst Gateway
logs the error and uses the <code class="docutils literal notranslate"><span class="pre">X-Trino-Routing-Group</span></code> header for routing
decisions.</p>
</div>
</section>
<section id="file-based-routing-rules">
<h2 id="file-based-routing-rules">File-based routing rules<a class="headerlink" href="#file-based-routing-rules" title="Link to this heading">#</a></h2>
<p>Define routing rules in a YAML file using conditions and actions. Separate each
rule with <code class="docutils literal notranslate"><span class="pre">---</span></code>.</p>
<p>Rules consist of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: A descriptive identifier for the rule</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: Human-readable explanation of what the rule does</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: An expression that determines when the rule applies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actions</span></code>: What to do when the <code class="docutils literal notranslate"><span class="pre">condition</span></code> is met</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code> (optional): Execution order (lower numbers run first)</p></li>
</ul>
<p>See the following example rules:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"airflow"</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"if</span><span class="nv"> </span><span class="s">query</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">airflow,</span><span class="nv"> </span><span class="s">route</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">etl</span><span class="nv"> </span><span class="s">group"</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Source")</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"airflow"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl")'</span>
<span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"airflow</span><span class="nv"> </span><span class="s">special"</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"if</span><span class="nv"> </span><span class="s">query</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">airflow</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">special</span><span class="nv"> </span><span class="s">label,</span><span class="nv"> </span><span class="s">route</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">etl-special</span><span class="nv"> </span><span class="s">group"</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Source")</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"airflow"</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">contains</span><span class="nv"> </span><span class="s">"label=special"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'result.put</span>
</pre></div>
</div>
<section id="available-objects">
<h3 id="available-objects">Available objects<a class="headerlink" href="#available-objects" title="Link to this heading">#</a></h3>
<p>By default, rules can access three objects:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">request</span></code>: The incoming HTTP request as an
<a class="reference external" href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code>: A HashMap for passing data between rules</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>: A HashMap for returning routing decisions</p></li>
</ul>
</section>
<section id="optional-objects">
<h3 id="optional-objects">Optional objects<a class="headerlink" href="#optional-objects" title="Link to this heading">#</a></h3>
<p>Enable additional objects by setting the <code class="docutils literal notranslate"><span class="pre">requestAnalyzerConfig.analyzeRequest</span></code>
property to <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trinoRequestUser</span></code>: Information about the authenticated user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trinoQueryProperties</span></code>: Details about the SQL query being executed</p></li>
</ul>
</section>
<section id="expression-language">
<h3 id="expression-language">Expression language<a class="headerlink" href="#expression-language" title="Link to this heading">#</a></h3>
<p>Rules use <a class="reference internal" href="#mvel-operators">MVEL</a>, an expression language with Java-like syntax.
Available classes include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">java.util.*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">java.lang.*</span></code> (Integer, String, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">java.lang.Math</span></code> and <code class="docutils literal notranslate"><span class="pre">java.lang.StrictMath</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">java.lang.System</span></code> and other system access classes are not available for
security reasons.</p>
</div>
</section>
<section id="mvel-operators">
<span id="id1"></span><h3 id="mvel-operators">MVEL operators<a class="headerlink" href="#mvel-operators" title="Link to this heading">#</a></h3>
<p>MVEL provides convenient operators for common operations.</p>
<p>Instead of:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">null</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">request.getHeader("X-Trino-Client-Tags").contains("label=foo")'</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">contains</span></code> operator:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">contains</span><span class="nv"> </span><span class="s">"label=foo"'</span>
</pre></div>
</div>
<p>MVEL does not support generic type parameters. Use <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">HashSet()</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">HashSet&lt;String&gt;()</span></code>.</p>
<section id="flow-control">
<h4 id="flow-control">Flow control<a class="headerlink" href="#flow-control" title="Link to this heading">#</a></h4>
<p>Use MVEL flow control statements for complex logic. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"airflow</span><span class="nv"> </span><span class="s">routing"</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Source")</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"airflow"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'if</span><span class="nv"> </span><span class="s">(request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">contains</span><span class="nv"> </span><span class="s">"label=foo")</span><span class="nv"> </span><span class="s">{</span>
<span class="w">       </span><span class="s">result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl-foo")</span>
<span class="w">     </span><span class="s">}</span>
<span class="w">     </span><span class="s">else</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">(request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">contains</span><span class="nv"> </span><span class="s">"label=bar")</span><span class="nv"> </span><span class="s">{</span>
<span class="w">       </span><span class="s">result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl-bar")</span>
<span class="w">     </span><span class="s">}</span>
<span class="w">     </span><span class="s">else</span><span class="nv"> </span><span class="s">{</span>
<span class="w">       </span><span class="s">result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl")</span>
<span class="w">     </span><span class="s">}'</span>
</pre></div>
</div>
</section>
</section>
<section id="execution-order">
<h3 id="execution-order">Execution order<a class="headerlink" href="#execution-order" title="Link to this heading">#</a></h3>
<p>By default, rules execute in the order they appear in the file.</p>
<p>Assign integer priorities to control execution order. Lower numbers execute
first:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"general</span><span class="nv"> </span><span class="s">airflow"</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Route</span><span class="nv"> </span><span class="s">Airflow</span><span class="nv"> </span><span class="s">queries</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ETL</span><span class="nv"> </span><span class="s">group"</span>
<span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Source")</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"airflow"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl")'</span>
<span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"special</span><span class="nv"> </span><span class="s">airflow"</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Override</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">special</span><span class="nv"> </span><span class="s">Airflow</span><span class="nv"> </span><span class="s">queries"</span>
<span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Source")</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"airflow"</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">contains</span><span class="nv"> </span><span class="s">"label=special"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl-special")'</span>
</pre></div>
</div>
<p>Rules without specified priority default to <code class="docutils literal notranslate"><span class="pre">INT_MAX</span></code> and execute last.</p>
<p>When multiple rules match a request, all matching rules execute. A query cam
satisfy multiple conditions and have its routing group changed multiple times.
The final routing group is determined by the last rule that executes.</p>
</section>
<section id="sharing-state-between-rules">
<h3 id="sharing-state-between-rules">Sharing state between rules<a class="headerlink" href="#sharing-state-between-rules" title="Link to this heading">#</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">state</span></code> object to pass information between rules:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"initialize</span><span class="nv"> </span><span class="s">state"</span>
<span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'state.put("triggeredRules",</span><span class="nv"> </span><span class="s">new</span><span class="nv"> </span><span class="s">HashSet())'</span>
<span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"airflow</span><span class="nv"> </span><span class="s">detection"</span>
<span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'request.getHeader("X-Trino-Source")</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"airflow"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl")'</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'state.get("triggeredRules").add("airflow")'</span>
<span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"special</span><span class="nv"> </span><span class="s">airflow</span><span class="nv"> </span><span class="s">routing"</span>
<span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">'state.get("triggeredRules").contains("airflow")</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">request.getHeader("X-Trino-Client-Tags")</span><span class="nv"> </span><span class="s">contains</span><span class="nv"> </span><span class="s">"label=special"'</span>
<span class="nt">actions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'result.put("routingGroup",</span><span class="nv"> </span><span class="s">"etl-special")'</span>
</pre></div>
</div>
</section>
</section>
<section id="external-service-routing-rules">
<h2 id="external-service-routing-rules">External service routing rules<a class="headerlink" href="#external-service-routing-rules" title="Link to this heading">#</a></h2>
<p>Configure Starburst Gateway to use an external service for routing decisions.</p>
<p>Set the <code class="docutils literal notranslate"><span class="pre">rulesType</span></code> property to <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code> and configure the
<code class="docutils literal notranslate"><span class="pre">rulesExternalConfiguration</span></code> property:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">routingRules</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rulesEngineEnabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">rulesType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXTERNAL</span>
<span class="w">    </span><span class="nt">rulesExternalConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="nt">urlPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://router.example.com/gateway-rules</span>
<span class="w">        </span><span class="nt">excludeHeaders</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'Authorization'</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">'Accept-Encoding'</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starburst Gateway does not support redirect URLs.</p>
</div>
<p>Optionally, add headers to the <code class="docutils literal notranslate"><span class="pre">excludeHeaders</span></code> list to prevent sending specific
header values in the POST request.</p>
<section id="request-format">
<h3 id="request-format">Request format<a class="headerlink" href="#request-format" title="Link to this heading">#</a></h3>
<p>Starburst Gateway sends a POST request to the external service containing:</p>
<ul class="simple">
<li><p>All HTTP headers from the original request(excluding those in
<code class="docutils literal notranslate"><span class="pre">excludeHeaders</span></code>)</p></li>
<li><p>The following HTTP information:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteUser</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requestURI</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queryString</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteAddr</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remoteHost</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameterMap</span></code></p></li>
</ul>
</li>
<li><p>Optional information (if <code class="docutils literal notranslate"><span class="pre">requestAnalyzerConfig.analyzeRequest</span> <span class="pre">=</span> <span class="pre">true</span></code>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TrinoRequestUser</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TrinoQueryProperties</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="response-format">
<h3 id="response-format">Response format<a class="headerlink" href="#response-format" title="Link to this heading">#</a></h3>
<p>The external service must return a response in JSON format. It must also return
a status code <code class="docutils literal notranslate"><span class="pre">200</span></code>.</p>
<p>See the following JSON object containing a routing decision:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">"routingGroup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etl-cluster"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">"Optional error message 1"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"Optional error message 2"</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">errors</span></code> is not null or empty, the request routes to the default <code class="docutils literal notranslate"><span class="pre">adhoc</span></code>
group.</p>
</section>
<section id="http-client-configuration">
<h3 id="http-client-configuration">HTTP client configuration<a class="headerlink" href="#http-client-configuration" title="Link to this heading">#</a></h3>
<p>Configure the HTTP client for external service requests in the <code class="docutils literal notranslate"><span class="pre">serverConfig</span></code>
section:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">serverConfig</span><span class="p">:</span>
<span class="w">    </span><span class="nt">router.http-client.request-timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span>
<span class="w">    </span><span class="nt">router.http-client.connect-timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500ms</span>
</pre></div>
</div>
<p>For all available options, see the <a class="reference internal" href="../properties-http-client.html"><span class="doc std std-doc">HTTP client properties
documentation</span></a>.</p>
</section>
</section>
<section id="health-status">
<span id="gateway-healthstatus"></span><h2 id="health-status">Health status<a class="headerlink" href="#health-status" title="Link to this heading">#</a></h2>
<p>Starburst Gateway tracks the health status of the configured clusters. The Gateway
updates cluster states with every health check.</p>
<p>There are four possible states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PENDING</span></code>: The cluster is starting up (it is treated as unhealthy for
routing)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HEALTHY</span></code>: The cluster passed health checks and is ready for requests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UNHEALTHY</span></code>: The cluster failed health checks (no requests routed)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UNSUPPORTED</span></code>: A Non-SEP cluster is configured</p></li>
</ul>
</section>
<section id="request-analysis-configuration">
<h2 id="request-analysis-configuration">Request analysis configuration<a class="headerlink" href="#request-analysis-configuration" title="Link to this heading">#</a></h2>
<p>Configure request analysis in the <code class="docutils literal notranslate"><span class="pre">requestAnalyzerConfig</span></code> section of your YAML
file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">requestAnalyzerConfig</span><span class="p">:</span>
<span class="w">    </span><span class="nt">analyzeRequest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">maxBodySize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<span class="w">    </span><span class="nt">isClientsUseV2Format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">tokenUserField</span><span class="p">:</span><span class="w"> </span><span class="s">"email"</span>
<span class="w">    </span><span class="nt">oauthTokenInfoUrl</span><span class="p">:</span><span class="w"> </span><span class="s">"https://auth.example.com/userinfo"</span>
</pre></div>
</div>
<section id="configuration-options">
<h3 id="configuration-options">Configuration options<a class="headerlink" href="#configuration-options" title="Link to this heading">#</a></h3>
<p>To configure request analysis, use the following configuration properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">analyzeRequest</span></code>: Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable <code class="docutils literal notranslate"><span class="pre">trinoQueryProperties</span></code> and
<code class="docutils literal notranslate"><span class="pre">trinoRequestUser</span></code> objects (default: <code class="docutils literal notranslate"><span class="pre">false</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxBodySize</span></code>: The maximum request body size to analyze in characters
(default: 1,000,000)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isClientsUseV2Format</span></code>: Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to support for V2-style request
structure (default: <code class="docutils literal notranslate"><span class="pre">false</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokenUserField</span></code>: The JWT claim to use as username (default: <code class="docutils literal notranslate"><span class="pre">"email"</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oauthTokenInfoUrl</span></code> (optional): The URL for OAuth token exchange</p></li>
</ul>
</section>
</section>
<section id="user-information-extraction">
<h2 id="user-information-extraction">User information extraction<a class="headerlink" href="#user-information-extraction" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">trinoRequestUser</span></code> object attempts to extract user information from requests
in the following order:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X-Trino-User</span></code> header</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Authorization:</span> <span class="pre">Basic</span></code> header</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Authorization:</span> <span class="pre">Bearer</span></code> header (requires OAuth2 configuration)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Trino-UI-Token</span></code> or <code class="docutils literal notranslate"><span class="pre">__Secure-Trino-ID-Token</span></code> cookie</p></li>
</ol>
<p>To enable user information extraction, set the
<code class="docutils literal notranslate"><span class="pre">requestAnalyzerConfig.analyzeRequest</span></code> property to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<section id="available-methods">
<h3 id="available-methods">Available methods<a class="headerlink" href="#available-methods" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trinoRequestUser.getUser()</span></code>: rRturns an <code class="docutils literal notranslate"><span class="pre">Optional&lt;String&gt;</span></code> containing the
extracted username, or an empty <code class="docutils literal notranslate"><span class="pre">Optional</span></code> if user information is not
extracted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trinoRequestUser.getUserInfo()</span></code>: Returns an <code class="docutils literal notranslate"><span class="pre">Optional&lt;UserInfo</span></code>&gt;, with an
<a class="reference external" href="https://www.javadoc.io/doc/com.nimbusds/oauth2-oidc-sdk/5.34/com/nimbusds/openid/connect/sdk/claims/UserInfo.html">OpenID Connect
UserInfo</a>
if a token is successfully exchanged with the <code class="docutils literal notranslate"><span class="pre">oauthTokenInfoUrl</span></code>, and an
empty <code class="docutils literal notranslate"><span class="pre">Optional</span></code> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trinoRequestUser.userExistsAndEquals("username")</span></code>: Checks  a username matches
the extracted user.</p></li>
</ul>
</section>
</section>
<section id="query-analysis">
<h2 id="query-analysis">Query analysis<a class="headerlink" href="#query-analysis" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">trinoQueryProperties</span></code> object provides information about SQL queries.</p>
<section id="id2">
<h3 id="id2">Available methods<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">errorMessage()</span></code>: Returns error message if analysis failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isNewQuerySubmission()</span></code>: Returns true if request is a new query submission</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getQueryType()</span></code>: Returns statement class name (e.g., ShowCreate)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getResourceGroupQueryType()</span></code>: Returns resource group query type (e.g.,
SELECT, DATA_DEFINITION)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getDefaultCatalog()</span></code>: Returns default catalog if set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getDefaultSchema()</span></code>: Returns default schema if set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCatalogs()</span></code>: Returns set of catalogs used in the query</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getSchemas()</span></code>: Returns set of schemas used in the query</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCatalogSchemas()</span></code>: Returns set of qualified schemas (catalog.schema
format)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tablesContains(String</span> <span class="pre">tableName)</span></code>: Returns true if query references the
specified table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getTables()</span></code>: Returns set of fully qualified table names</p></li>
</ul>
</section>
<section id="limitations">
<h3 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Only performs syntactic analysis</p></li>
<li><p>Does not expand views</p></li>
<li><p>Does not analyze view dependencies</p></li>
<li><p>Treats views and materialized views as tables</p></li>
</ul>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-grid md-main__inner" style="height: auto;">
  <div class="md-content">
    <div class="feedback-container md-content__inner md-typeset">
      <div class="feedback-thumbs">
        <p>Is the information on this page helpful?</p>
        <p class="feedback-option" title="yes">Yes</p>
        <p class="feedback-option" title="no">No</p>
      </div>
      <div class="feedback-message">
        <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
        <button type="button" onclick="sendMessage()" class="feedback-button">Email</button>
        <a onclick="skip()" class="feedback-skip">Cancel</a>
      </div>
    </div>
  </div>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '');
</script>
<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="routing-logic.html" title="Routing logic"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Routing logic </span>
              </div>
            </a>
          
          
            <a href="security.html" title="Security"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Security </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
<!-- custom footer should go here in time -->
<div class="page-footer">
  <div class="container md-grid">
    <div class="row">
      <div class="col-md-3">
        <p style="font-weight:900">Resources</p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">

        <a href="https://www.starburst.io/" target="_blank">
          <img src="../../_static/img/Starburst_Logo_White+Blue.svg" height="34"
            alt="Starburst Enterprise 478-e STS logo">
        </a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright  2017-2025<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
  </div>
</div>
<script src="https://docs.starburst.io/latest/_static/algolia.js"></script>
<script src="https://docs.starburst.io/latest/_static/searchbox.js" data-versions="{'Latest LTS (477-e)': '/477-e/', '476-e LTS': '/476-e/', '474-e LTS': '/474-e/', '468-e LTS': '/468-e/', 'Latest STS (478-e)': '/478-e/'}"></script>
<script src="https://docs.starburst.io/latest/_static/searchresults.js" data-versions="{'Latest LTS (477-e)': '/477-e/', '476-e LTS': '/476-e/', '474-e LTS': '/474-e/', '468-e LTS': '/468-e/', 'Latest STS (478-e)': '/478-e/'}"></script>
  </body>
</html>