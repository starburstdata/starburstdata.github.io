<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Starburst | AWS EKS networking best practices</title>
    <meta name="viewport" content="width=device-width">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Starburst - AWS EKS networking best practices">
    <meta property="og:description" content="Your hub to all knowledge about Starburst products.">
    <meta property="og:image" content="/assets/img/logo/starburst-reverse.png">

    <link rel="stylesheet" href="/assets/fontawesome/css/all.css">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/mdb.min.css">
    <link rel="stylesheet" href="/assets/css/highlight.css">
    <link rel="stylesheet" href="/assets/css/style.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114610397-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114610397-1');
</script>

</head>
<body>


<div class="wrap">
  

<header style="padding-top:74px;">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
    <div class="navbar-left-container">
      <a class="navbar-brand" href="https://www.starburst.io/">
        <img src="/assets/img/logo/starburst-reverse.png" height="40" alt=" Starburst">
      </a>
      <span class="navbar-divider"></span>
      <a href="/" class="nav-item nav-link">Documentation</a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a  class="nav-link"  href="/get-started/index.html">Get started</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link"  href="/starburst-enterprise/index.html">Starburst Enterprise</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link active"  href="/ecosystems/index.html">Ecosystems</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link"  href="/starburst-galaxy/index.html">Starburst Galaxy</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link"  href="/support.html">Support</a>
        </li>
      </li>
      
      <li class="dropdown" id="site-search">
  <a id="dropdownSearch">
    <i class="fa fa-search" style="color: #ffffff; vertical-align: sub"></i>
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdownSearch">
    <div id="algolia-search">
      <div id="searchbox"></div>
      <div id="refinement-list">
        <h6>Filter:</h6>
      </div>
      <div id="hits"></div>
      <div id="stats"></div>
      <div class="close-search-container">
        <a href="javascript:closeSearch()"><h6>Close</h6></a>
      </div>
    </div>
  </div>
</li>

      
      </ul>
    </div>
  </nav>
</header>

  
  <div class="content">
    <div class="row">
      <div class="col-md-3 side-navigation">
        <div class="spacer-60 toc-sticky left-nav">
          
          <div>
    <h6 class="overline product-nav-title">Starburst cloud offerings</h6>
</div>
<hr />

 
  
  
<li >
  <a href="/ecosystems/index.html" >Home</a>
</li>



 





<li  class="active" 
    onclick="toggle_navigation_visibility('amazon');">
  <a>
    Amazon AWS
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="amazon" class="doc-subnav ">
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/s3.html" >Amazon S3</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/glue.html" >AWS Glue</a>
  </li>
  
  
  
    
    
    
  <li class="active"
      
    >
    <a href="/ecosystems/amazon/eks-networking.html" >EKS networking</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/eks-cluster-creation.html" >EKS cluster creation</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/cft-connection-info.html" >Connection parameters in CFT</a>
  </li>
  
  
</ul>



 





<li 
    onclick="toggle_navigation_visibility('google');">
  <a>
    Google Cloud
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="google" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/google/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/google/gke.html" >GKE</a>
  </li>
  
  
</ul>



 
  
  
<li >
  <a href="/ecosystems/microsoft/index.html" >Microsoft Azure</a>
</li>



 





<li 
    onclick="toggle_navigation_visibility('redhat');">
  <a>
    Red Hat OpenShift
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="redhat" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/redhat/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/redhat/openshift-deployment.html" >Deploying in OpenShift</a>
  </li>
  
  
</ul>



<div style="padding-top: 3em;">
  <h6 class="overline product-nav-title">Resources</h6>
</div>
<hr />

 
  
  
<li >
  <a href="/get-started/index.html" >Get started</a>
</li>



 
  
  
<li >
  <a href="/starburst-enterprise/index.html" >Starburst Enterprise</a>
</li>



 
  
  
<li >
  <a href="/ecosystems/index.html" >Ecosystem deployments</a>
</li>



 
  
  
<li >
  <a href="/starburst-galaxy/index.html" >Starburst Galaxy</a>
</li>



 





<li 
    onclick="toggle_navigation_visibility('personas');">
  <a>
    User personas
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="personas" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/starburst-personas.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/data-consumer/index.html" >Data consumer</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/data-engineer/index.html" >Data engineer</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/platform-administrator/index.html" >Platform administrator</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/data-leader/index.html" >Data leader</a>
  </li>
  
  
</ul>



 
  
  
<li >
  <a href="https://docs.starburst.io/latest/index.html" >Reference documentation</a>
</li>



 
  
  
<li >
  <a href="/glossary.html" >Glossary</a>
</li>



 
  
  
<li >
  <a href="/videos/index.html" >Video library</a>
</li>



          
        </div>
      </div>
      <div class="col-md-9 col-lg-6 spacer-30 docs-content">
        



<div class="breadcrumbs">
  <p>
  
  
    
      <a href="/ecosystems/"
        style="text-transform: uppercase"
      > ecosystems</a> >
    
  
    
      <a href="/ecosystems/amazon/"
        style="text-transform: uppercase"
      > amazon</a> >
    
  
    
      AWS EKS networking best practices
    
  </p>
</div>

        <h1 id="aws-eks-networking-best-practices">
        
        
          AWS EKS networking best practices <a href="#aws-eks-networking-best-practices" class="titleAnchor">#</a>
        
        
      </h1>
    

<p>When deploying Starburst Enterprise platform (SEP) into an AWS EKS cluster, it is important
to ensure that your cluster resources are located with the following in mind:</p>

<ul>
  <li>cluster communications latency</li>
  <li>data ingress/egress costs</li>
  <li>IP address availability</li>
</ul>
      <h2 id="use-a-single-availability-zone-inside-your-existing-vpc">
        
        
          Use a single availability zone inside your existing VPC <a href="#use-a-single-availability-zone-inside-your-existing-vpc" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>Using your existing VPC is a key cost control measure. It ensures that costs
associated with data ingress and egress are kept to a minimum. Every new VPC
comes with a NAT gateway. And, while NAT gateways are inexpensive, costs for
data transferred through that gateway add up very quickly. As a best practice,
placing your SEP inside of your existing VPC, co-resident with as
many of your data sources as possible not only keeps costs down, it also greatly
simplify networking and security.</p>

<p>Equally as important is performance. No matter if you use an existing or new
VPC, SEP must run in a single availability zone (AZ) to ensure
the best performance possible. To accomplish this, use node groups. The node
groups are then tied to a single AZ using affinity or node selection rules.</p>

<p>For SEP, two <a href="./eks-cluster-creation.html">managed node groups</a>
are required. The SEP coordinator and workers are deployed to
one group while support services, such as HMS, Ranger and nginx, are deployed to
the second node group.</p>

<div class="alert alert-danger" role="alert">
  <i class="fa fa-radiation"></i> <b>Warning:</b>

  You must use an existing VPC in order to
enforce the use of a single AZ. Do not use eksctl to create a new VPC at cluster
creation time.

</div>
      <h2 id="spot-instances-and-single-azs">
        
        
          Spot instances and single AZs <a href="#spot-instances-and-single-azs" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>AWS EC2 <a href="https://docs.aws.amazon.com/es_es/whitepapers/latest/cost-optimization-leveraging-ec2-spot-instances/how-spot-instances-work.html">Spot
instances</a>
are sometimes desireable to keep costs down. However, they are inherently
unreliable, as they can be recalled by the EC2 platform at any time. Because of
how SEP drives performance by dividing query processing for any
single query, sudden removal of an expected resource can cause failures.
Further, when using a single AZ, Spot instance rebalancing is diminished, as
pools in only the single AZ are available to it. Using Spot instances may still
be desirable in some cases. In this case, to use Spot instances for the
SEP workers, create a third node group to contain them,
separating the non-Spot coordinator node group from the Spot worker node group.
The remaining node group contains support services as before.</p>
      <h2 id="ip-address-requirements">
        
        
          IP address requirements <a href="#ip-address-requirements" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>An important consideration in using an existing VPC is IP address availability.
As part of standing up your SEP cluster, you must ensure that
sufficient IP addresses are reliably available for use by your
SEP instances.</p>

<p>In EKS clusters, AWS creates one subnet per availability zone. Usually, these
are configured as /20 Classless Inter-Domain Routings (CIDR) with 4,091 IP
addresses available for use (an additional 5 are reserved by the cluster
itself). SEP requires that all hosts, both workers and
coordinators, are sized identically. Each of these instances has a maximum
number of IP addresses that can be assigned to it, and EKS reserves twice that
number of addresses for it.</p>

<p>For purposes of this discussion, we assume an SEP deployment
involving six m5.xlarge workers and one m5.xlarge coordinator. Each of this
instances can have a maximum of 15 IP addresses in use, one per each of the 15 interfaces it comes with. An additional 15 are reserved, for a total of 30 IP addresses needed per instance. Those seven instances together then require 210 available IP addresses:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">(</span> 7 m5.xlarge instances<span class="o">)</span>
x <span class="o">(</span> 15 interfaces per instance <span class="o">)</span>
x <span class="o">(</span> 2 IPs per interface <span class="o">)</span>
<span class="o">=</span> 210 IP addresses needed
</code></pre></div></div>

<p>In this example, you must ensure that a minimum of 210 IP addresses are
reliably available for use by your SEP instances at all times.</p>

<div class="alert alert-info" role="alert">
  <i class="fa fa-info-circle"></i>
  <b>Note: </b>
  If you are taking advantage of AWS EKS
autoscaling, you must calculate the number of addresses needed on the maximum
allowable number of workers.</div>
      <h3 id="using-subnets">
        
        
          Using subnets <a href="#using-subnets" class="titleAnchor">#</a>
        
        
      </h3>
    

<p>You can use an existing subnet or create a new one. It must be configured with a
route out to the Internet either via a NAT gateway or an IGW to allow your EKS
cluster to communicate with the AWS EKS management backplane. Cost
considerations for these communications are minimal.</p>
      <h3 id="considerations-if-you-must-use-vpc-peering">
        
        
          Considerations if you must use VPC peering <a href="#considerations-if-you-must-use-vpc-peering" class="titleAnchor">#</a>
        
        
      </h3>
    

<p>If you cannot place SEP within your current VPC because of a
scarcity of IP addresses, as an alternative you can create a peering connection
with the new EKS cluster’s VPC to avoid the often cost-prohibitive operation of
all data passing through the NAT gateway. VPC peering requires additional setup,
and comes with potential downsides:</p>

<ul>
  <li>Does not scale well.</li>
  <li>Transitive routing is not available.</li>
  <li>Peering connections are a resource that must be managed.</li>
  <li>Firewall rules must be carefully managed.</li>
</ul>

<p>Additionally, you must ensure that the CIDR you set for the new
SEP VPC does not match or overlap with your existing VPC’s CIDR.
VPCs with overlapping CIDRs cannot create peering connections.</p>

        <div class="feedback-container">
  <div class="feedback-thumbs">
    <p>Is the information on this page helpful?</p>
    <p class="feedback-option" title="yes"><i class="fa fa-thumbs-up"></i>Yes</p>
    <p class="feedback-option" title="no"><i class="fa fa-thumbs-down"></i>No</p>
  </div>
  <div class="feedback-message">
    <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
    <button type="button" onclick="sendMessage()" class="btn btn-sm btn-primary">Submit</button>
    <a onclick="skip()" class="feedback-skip">Skip</a>
  </div>
</div>

<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

      </div>
      <div class="col-lg-3 toc-styles d-none d-lg-block">
        <div class="spacer-60 toc-sticky">
          <ul><li><a href="#aws-eks-networking-best-practices">AWS EKS networking best practices</a><ul><li><a href="#use-a-single-availability-zone-inside-your-existing-vpc">Use a single availability zone inside your existing VPC</a></li><li><a href="#spot-instances-and-single-azs">Spot instances and single AZs</a></li><li><a href="#ip-address-requirements">IP address requirements</a><ul><li><a href="#using-subnets">Using subnets</a></li><li><a href="#considerations-if-you-must-use-vpc-peering">Considerations if you must use VPC peering</a></li></ul></li></ul></li></ul>

        </div>
      </div>
  </div>
  
</div>
<footer class="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <p style="font-weight:900">Resources</b></p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">
        <a href="https://www.starburst.io/" target="_blank"><img src="/assets/img/logo/starburst-reverse.png" height="60" alt=" Starburst" style="margin-bottom:20px;"></a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright © 2017-2021<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 center spacer-30">
          <a href="https://twitter.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-twitter"></i></a>
          <a href="https://linkedin.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-linkedin"></i></a>
          <a href="https://www.youtube.com/channel/UCXjkuWSO9CV_cSI3Mvo4a4w" target="_blank" class="footer-icon"><i class="fab fa-youtube"></i></a>
          <a href="https://github.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-github"></i></a>
      </div>
    </div>
  </div>
</footer>


  <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/js/popper.min.js"></script>
  <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/assets/js/mdb.min.js"></script>
  <script type="text/javascript" src="/assets/js/custom.js"></script>
  <script type="text/javascript" src="/assets/js/algolia.js"></script>
  <script type="text/javascript" src="/assets/js/search-box.js"></script>
  <script type="text/javascript" src="/assets/js/search-results.js"></script>
</body>
</html>

