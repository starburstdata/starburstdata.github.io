<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Starburst | Working with data in Amazon S3</title>
    <meta name="viewport" content="width=device-width">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Starburst - Working with data in Amazon S3">
    <meta property="og:description" content="Your hub to all knowledge about Starburst products.">
    <meta property="og:image" content="/assets/img/logo/starburst-reverse.png">

    <link rel="stylesheet" href="/assets/fontawesome/css/all.css">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/mdb.min.css">
    <link rel="stylesheet" href="/assets/css/highlight.css">
    <link rel="stylesheet" href="/assets/css/style.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114610397-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114610397-1');
</script>

</head>
<body>


<div class="wrap">
  

<header style="padding-top:74px;">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
    <div class="navbar-left-container">
      <a class="navbar-brand" href="https://www.starburst.io/">
        <img src="/assets/img/logo/starburst-reverse.png" height="40" alt=" Starburst">
      </a>
      <span class="navbar-divider"></span>
      <a href="/" class="nav-item nav-link">Documentation</a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a  class="nav-link"  href="/get-started/index.html">Get started</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link"  href="/starburst-enterprise/index.html">Starburst Enterprise</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link active"  href="/ecosystems/index.html">Ecosystems</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link"  href="/starburst-galaxy/index.html">Starburst Galaxy</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link"  href="/support.html">Support</a>
        </li>
      </li>
      
      <li class="dropdown" id="site-search">
  <a id="dropdownSearch" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-search" style="color:white; vertical-align: sub;"></i>
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdownSearch">
    <div id="search-container">
      <div id="search-input-bar">
        <input type="text" id="search-input" name="search" placeholder="Search..." />
      </div>
      <div id="results-container"></div>
    </div>
  </div>
</li>

<script type="text/javascript" src="/assets/js/simple-jekyll-search.js"></script>
<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('results-container'),
  json: '/search.json',
  limit: 30
})
</script>

      
      </ul>
    </div>
  </nav>
</header>

  
  <div class="content">
    <div class="row">
      <div class="col-md-3 side-navigation">
        <div class="spacer-60 toc-sticky left-nav">
          
          <div>
    <h6 class="overline product-nav-title">Starburst cloud offerings</h6>
</div>
<hr />

 
  
  
<li >
  <a href="/ecosystems/index.html" >Home</a>
</li>



 





<li  class="active" 
    onclick="toggle_navigation_visibility('amazon');">
  <a>
    Amazon AWS
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="amazon" class="doc-subnav ">
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li class="active"
      
    >
    <a href="/ecosystems/amazon/s3.html" >Amazon S3</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/glue.html" >AWS Glue</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/eks-networking.html" >EKS networking</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/eks-cluster-creation.html" >EKS cluster creation</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/amazon/cft-connection-info.html" >Connection parameters in CFT</a>
  </li>
  
  
</ul>



 





<li 
    onclick="toggle_navigation_visibility('google');">
  <a>
    Google Cloud
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="google" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/google/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/google/gke.html" >GKE</a>
  </li>
  
  
</ul>



 
  
  
<li >
  <a href="/ecosystems/microsoft/index.html" >Microsoft Azure</a>
</li>



 





<li 
    onclick="toggle_navigation_visibility('redhat');">
  <a>
    Red Hat OpenShift
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="redhat" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/redhat/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/ecosystems/redhat/openshift-deployment.html" >Deploying in OpenShift</a>
  </li>
  
  
</ul>



<div style="padding-top: 3em;">
  <h6 class="overline product-nav-title">Resources</h6>
</div>
<hr />

 
  
  
<li >
  <a href="/get-started/index.html" >Get started</a>
</li>



 
  
  
<li >
  <a href="/starburst-enterprise/index.html" >Starburst Enterprise</a>
</li>



 
  
  
<li >
  <a href="/ecosystems/index.html" >Ecosystem deployments</a>
</li>



 
  
  
<li >
  <a href="/starburst-galaxy/index.html" >Starburst Galaxy</a>
</li>



 





<li 
    onclick="toggle_navigation_visibility('personas');">
  <a>
    User personas
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="personas" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/starburst-personas.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/data-consumer/index.html" >Data consumer</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/data-engineer/index.html" >Data engineer</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/platform-administrator/index.html" >Platform administrator</a>
  </li>
  
  
  
    
    
    
  <li 
      
      
      
    >
    <a href="/data-leader/index.html" >Data leader</a>
  </li>
  
  
</ul>



 
  
  
<li >
  <a href="https://docs.starburst.io/latest/index.html" >Reference documentation</a>
</li>



 
  
  
<li >
  <a href="/glossary.html" >Glossary</a>
</li>



 
  
  
<li >
  <a href="/videos/index.html" >Video library</a>
</li>



          
        </div>
      </div>
      <div class="col-md-9 col-lg-6 spacer-30 docs-content">
        



<div class="breadcrumbs">
  <p>
  
  
    
      <a href="/ecosystems/"
        style="text-transform: uppercase"
      > ecosystems</a> >
    
  
    
      <a href="/ecosystems/amazon/"
        style="text-transform: uppercase"
      > amazon</a> >
    
  
    
      Working with data in Amazon S3
    
  </p>
</div>

        <h1 id="working-with-data-in-amazon-s3">
        
        
          Working with data in Amazon S3 <a href="#working-with-data-in-amazon-s3" class="titleAnchor">#</a>
        
        
      </h1>
    
      <h2 id="prerequisites">
        
        
          Prerequisites <a href="#prerequisites" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>To enable access to S3 with Starburst Enterprise platform (SEP), the following conditions
must be met:</p>

<ul>
  <li>Your SEP cluster must have the necessary permissions needed to
access your S3 data.</li>
  <li>A Hive catalog and Hive Metastore (HMS) must be configured.</li>
</ul>
      <h3 id="ensuring-sep-access-to-s3">
        
        
          Ensuring SEP access to S3 <a href="#ensuring-sep-access-to-s3" class="titleAnchor">#</a>
        
        
      </h3>
    

<p>If your S3 data is publicly available, you do not need to do anything. However,
S3 data is not typically publicly available, and you must grant
SEP access to it. To accomplish this, you must <a href="../../latest/aws/prerequisites.html#instance-profiles">select an
appropriate instance
profile</a> when creating
a cluster.</p>

<p>When this is done, validate that the selected instance profile is sufficient for
SEP to read S3 data by opening an SSH connection to the
coordinator and issuing the following commands:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://your-bucket/path/to/dataset/
<span class="nv">$ </span>aws s3 <span class="nb">cp </span>s3://your-bucket/path/to/dataset/data-file - <span class="o">&gt;</span> /dev/null
</code></pre></div></div>
      <h3 id="configuring-the-hive-catalog-and-hms">
        
        
          Configuring the Hive catalog and HMS <a href="#configuring-the-hive-catalog-and-hms" class="titleAnchor">#</a>
        
        
      </h3>
    

<p>A <a href="../../data-engineer/catalogs.html">Hive catalog must be created</a> for your S3
bucket, along with an HMS, as the connector uses an HMS for data discovery. You
can use an existing HMS or start a new one, and it must have an instance profile
granting access to S3.</p>

<p>You can <a href="../../latest/aws/metastore.html">create a new metastore</a>
for SEP via a CloudFormation template.</p>

<p>To use an existing HMS:</p>

<ol>
  <li>
    <p>Set the <strong>MetastoreType</strong> parameter to <code class="language-plaintext highlighter-rouge">External Hive Metastore
  Service</code> and <strong>ExternalMetastoreHost</strong> to IP address of your Hive
  Metastore Service (see :doc:<code class="language-plaintext highlighter-rouge">/aws/metastore</code> section).</p>
  </li>
  <li>
    <p>If the Metastore uses authentication, review the Hive connector security
<a href="../../latest/connector/hive-security.html">documentation</a> to configure
the connector for your environment.</p>
  </li>
</ol>
      <h2 id="accessing-s3-data-from-sep">
        
        
          Accessing S3 Data from SEP <a href="#accessing-s3-data-from-sep" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>If you chose an existing HMS instance when configuring the Hive
catalog, chances are that your S3 data is already mapped to SQL tables in the
Metastore. In that case, you should be able to query it immediately.</p>

<p>If you created a new HMS instance, it is likely that your S3 data is not yet
mapped. In the Hive Metastore you must provide the schema of the data, the file
format, and the data location. For example, if you have ORC or Parquet files in
an S3 bucket, <code class="language-plaintext highlighter-rouge">my_bucket</code>, execute a command similar to the
following to create a queryable table:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  trino&gt; <span class="nt">--</span> <span class="k">select </span>schema <span class="k">in </span>which the table will be defined, must already exist
  trino&gt; USE hive.default<span class="p">;</span>
  USE

  trino&gt; <span class="nt">--</span> create table
  trino&gt; CREATE TABLE orders <span class="o">(</span>
       -&gt;     orderkey bigint,
       -&gt;     custkey bigint,
       -&gt;     orderstatus varchar<span class="o">(</span>1<span class="o">)</span>,
       -&gt;     totalprice double,
       -&gt;     orderdate <span class="nb">date</span>,
       -&gt;     orderpriority varchar<span class="o">(</span>15<span class="o">)</span>,
       -&gt;     clerk varchar<span class="o">(</span>15<span class="o">)</span>,
       -&gt;     shippriority integer,
       -&gt;     comment varchar<span class="o">(</span>79<span class="o">)</span>
       -&gt; <span class="o">)</span> WITH <span class="o">(</span>
       -&gt;     external_location <span class="o">=</span> <span class="s1">'s3://my_bucket/path/to/folder'</span>,
       -&gt;     format <span class="o">=</span> <span class="s1">'ORC'</span> <span class="nt">--</span> or <span class="s1">'PARQUET'</span>
       -&gt; <span class="o">)</span><span class="p">;</span>
  CREATE TABLE
</code></pre></div></div>

<p>Query the newly mapped table as usual:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  trino&gt; SELECT <span class="k">*</span> FROM orders<span class="p">;</span>
</code></pre></div></div>
      <h2 id="statistics">
        
        
          Statistics <a href="#statistics" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>If your queries are complex and include joining large data sets, you may run
into performance issues. This is because SEP does not know the
statistical properties of the data necessary for the cost-based optimizer’s
decisions.</p>

<p>To gather table statistics for tables in the Hive connector, execute the
following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  trino&gt; ANALYZE orders<span class="p">;</span>
</code></pre></div></div>
      <h2 id="writing-s3-data-with-sep">
        
        
          Writing S3 data with SEP <a href="#writing-s3-data-with-sep" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>After configuring  SEP to read data from S3, you can write to it.</p>

<p>If your HMS contains schema(s) mapped to S3 locations, you can use
them to export data to S3. If you don’t want to use existing schemas (or there
are no appropriate schemas in the HMS), create a new one.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  trino&gt; CREATE SCHEMA hive.s3_export WITH <span class="o">(</span>location <span class="o">=</span> <span class="s1">'s3://my_bucket/some/path'</span><span class="o">)</span><span class="p">;</span>
</code></pre></div></div>

<p>Once you have a schema pointing to a location where you want to export the data,
export data using a <code class="language-plaintext highlighter-rouge">CREATE TABLE AS</code> statement that specifies your
desired file format:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  trino&gt; CREATE TABLE hive.s3_export.my_table
  WITH <span class="o">(</span>format <span class="o">=</span> <span class="s1">'ORC'</span><span class="o">)</span>
  AS &lt;<span class="nb">source </span>query&gt;<span class="p">;</span>
</code></pre></div></div>

<p>Data is written to one or more files within the
<code class="language-plaintext highlighter-rouge">s3://my_bucket/some/path/my_table</code> namespace. The number of files depends on
the size of the data being exported and possible parallelization of the source
of the data.</p>

        <div class="feedback-container">
  <div class="feedback-thumbs">
    <p>Is the information on this page helpful?</p>
    <p class="feedback-option" title="yes"><i class="fa fa-thumbs-up"></i>Yes</p>
    <p class="feedback-option" title="no"><i class="fa fa-thumbs-down"></i>No</p>
  </div>
  <div class="feedback-message">
    <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
    <button type="button" onclick="sendMessage()" class="btn btn-sm btn-primary">Submit</button>
    <a onclick="skip()" class="feedback-skip">Skip</a>
  </div>
</div>

<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

      </div>
      <div class="col-lg-3 toc-styles d-none d-lg-block">
        <div class="spacer-60 toc-sticky">
          <ul><li><a href="#working-with-data-in-amazon-s3">Working with data in Amazon S3</a><ul><li><a href="#prerequisites">Prerequisites</a><ul><li><a href="#ensuring-sep-access-to-s3">Ensuring SEP access to S3</a></li><li><a href="#configuring-the-hive-catalog-and-hms">Configuring the Hive catalog and HMS</a></li></ul></li><li><a href="#accessing-s3-data-from-sep">Accessing S3 Data from SEP</a></li><li><a href="#statistics">Statistics</a></li><li><a href="#writing-s3-data-with-sep">Writing S3 data with SEP</a></li></ul></li></ul>

        </div>
      </div>
  </div>
  
</div>
<footer class="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <p style="font-weight:900">Resources</b></p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">
        <a href="https://www.starburst.io/" target="_blank"><img src="/assets/img/logo/starburst-reverse.png" height="60" alt=" Starburst" style="margin-bottom:20px;"></a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright © 2017-2021<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 center spacer-30">
          <a href="https://twitter.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-twitter"></i></a>
          <a href="https://linkedin.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-linkedin"></i></a>
          <a href="https://www.youtube.com/channel/UCXjkuWSO9CV_cSI3Mvo4a4w" target="_blank" class="footer-icon"><i class="fab fa-youtube"></i></a>
          <a href="https://github.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-github"></i></a>
      </div>
    </div>
  </div>
</footer>


  <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/js/popper.min.js"></script>
  <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/assets/js/mdb.min.js"></script>
  <script type="text/javascript" src="/assets/js/custom.js"></script>
</body>
</html>

