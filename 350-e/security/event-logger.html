

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Event logger &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/starburst.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Administration" href="../admin.html" />
    <link rel="prev" title="Query audit" href="audit.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#security/event-logger" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Starburst Enterprise"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/Starburst_Logo_NoTag_White.png" height="26"
                   alt="Starburst Enterprise logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Starburst Enterprise</span>
          <span class="md-header-nav__topic"> Event logger </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose another version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (350-e)" href="/350-e/">Latest LTS (350-e)</a>
      
          <a title="345-e LTS" href="/345-e/">345-e LTS</a>
      
          <a title="338-e LTS" href="/338-e/">338-e LTS</a>
      
          <a title="332-e LTS" href="/332-e/">332-e LTS</a>
      
          <a title="Latest STS (348-e)" href="/348-e/">Latest STS (348-e)</a>
      
          <a title="347-e STS" href="/347-e/">347-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Reference documentation</a></li>
            
            <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">User guides</a></li>
            
            <li class="md-tabs__item"><a href="https://starburst.io" class="md-tabs__link">Starburst</a></li>
          <li class="md-tabs__item"><a href="../security.html" class="md-tabs__link">Security</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../_static/Starburst_Logo_NoTag_White.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Starburst Enterprise">Starburst Enterprise</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mission-control.html" class="md-nav__link">Mission Control</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../aws.html" class="md-nav__link">Amazon Web Services</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../k8s.html" class="md-nav__link">Kubernetes with Helm</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../kubernetes.html" class="md-nav__link">Kubernetes operator</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="security-overview.html" class="md-nav__link">Security overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="https.html" class="md-nav__link">HTTPS and TLS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tls.html" class="md-nav__link">PEM, keystore, and truststore files</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="password-file.html" class="md-nav__link">Password file authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ldap.html" class="md-nav__link">LDAP authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="salesforce.html" class="md-nav__link">Salesforce authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="okta-authentication.html" class="md-nav__link">Okta authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="server.html" class="md-nav__link">Kerberos authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cli.html" class="md-nav__link">Kerberos authentication with CLI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-mapping.html" class="md-nav__link">User mapping</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="group-file.html" class="md-nav__link">File-based group provider</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ldap-group-provider.html" class="md-nav__link">LDAP group provider</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="access-control.html" class="md-nav__link">Access control overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="built-in-system-access-control.html" class="md-nav__link">Built-in system access control</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="file-system-access-control.html" class="md-nav__link">File-based system access control</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="impersonation.html" class="md-nav__link">User impersonation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="password-passthrough.html" class="md-nav__link">Password credential pass-through</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kerberos-passthrough.html" class="md-nav__link">Kerberos credential pass-through</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ranger-overview.html" class="md-nav__link">Apache Ranger overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="global-ranger.html" class="md-nav__link">Global access control with Apache Ranger</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-ranger.html" class="md-nav__link">Hive and Delta Lake access control with Apache Ranger</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="global-privacera.html" class="md-nav__link">Global access control with the Privacera Platform</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-privacera.html" class="md-nav__link">Hive access control with the Privacera Platform</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-sentry.html" class="md-nav__link">Hive access control with Apache Sentry</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="internal-communication.html" class="md-nav__link">Secure internal communication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="secrets.html" class="md-nav__link">Secrets management</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="audit.html" class="md-nav__link">Query audit</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Event logger </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Event logger</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#security-event-logger--page-root" class="md-nav__link">Event logger</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#requirements" class="md-nav__link">Requirements</a>
        </li>
        <li class="md-nav__item"><a href="#installation-and-configuration" class="md-nav__link">Installation and configuration</a>
        </li>
        <li class="md-nav__item"><a href="#logged-information" class="md-nav__link">Logged information</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#completed-queries" class="md-nav__link">Completed queries</a>
        </li>
        <li class="md-nav__item"><a href="#query-tables" class="md-nav__link">Query tables</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#analyzing-the-event-log" class="md-nav__link">Analyzing the event log</a>
        </li>
        <li class="md-nav__item"><a href="#example" class="md-nav__link">Example</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../insights.html" class="md-nav__link">Insights</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../versions.html" class="md-nav__link">350-e LTS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../404.html" class="md-nav__link">&nbsp;</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#security-event-logger--page-root" class="md-nav__link">Event logger</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#requirements" class="md-nav__link">Requirements</a>
        </li>
        <li class="md-nav__item"><a href="#installation-and-configuration" class="md-nav__link">Installation and configuration</a>
        </li>
        <li class="md-nav__item"><a href="#logged-information" class="md-nav__link">Logged information</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#completed-queries" class="md-nav__link">Completed queries</a>
        </li>
        <li class="md-nav__item"><a href="#query-tables" class="md-nav__link">Query tables</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#analyzing-the-event-log" class="md-nav__link">Analyzing the event log</a>
        </li>
        <li class="md-nav__item"><a href="#example" class="md-nav__link">Example</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="security-event-logger--page-root">Event logger<a class="headerlink" href="#security-event-logger--page-root" title="Permalink to this headline">#</a></h1>
<p>The event logger allows query completion events and all related Starburst Enterprise platform (SEP)
information to be logged into a PostgreSQL database.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Event logger requires a valid <a class="reference internal" href="../installation/license-requirements.html"><span class="doc">Starburst Enterprise license</span></a>.</p>
</div>
<p>Event logger data is used to provide cluster performance history, including:</p>
<ul class="simple">
<li><p>CPU and memory usage</p></li>
<li><p>Cluster size</p></li>
<li><p>Query load</p></li>
</ul>
<p>In addition to cluster performance data, the event logger also provides query
history and performance data. Once the event logger is running, use the
<a class="reference internal" href="../insights/index.html"><span class="doc">Insights user interface</span></a> to view cluster and query
data.</p>

<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>PostgreSQL database, version 9.6 or higher</p></li>
<li><p>Network connectivity between the coordinator and the PostgreSQL server</p></li>
</ul>
<p>Connectivity between SEP and the PostgreSQL database can be verified
on the coordinator or worker.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">ping</span></code> to verify the hostname:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ping postgresql.example.com
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">telnet</span></code> with the hostname and port of the database to confirm
PostgreSQL is listening on the configured port.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ telnet postgresql.example.com:5432
</pre></div>
</div>


<h2 id="installation-and-configuration">Installation and configuration<a class="headerlink" href="#installation-and-configuration" title="Permalink to this headline">#</a></h2>
<p>The event logger is implemented as a <a class="reference internal" href="../develop/event-listener.html"><span class="doc">event listener implementation</span></a> and can be enabled by creating a configuration file
called <code class="docutils literal notranslate"><span class="pre">etc/event-listener.properties</span></code> on the coordinator and workers. The
name needs to be set to <code class="docutils literal notranslate"><span class="pre">event-logger</span></code>. The configuration includes the JDBC
connection URL with hostname, port and database name as well as username and
password for accessing the PostgreSQL database.</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">event-listener.name</span><span class="o">=</span><span class="s">event-logger</span>
<span class="na">jdbc.url</span><span class="o">=</span><span class="s">jdbc:postgresql://postgresql.example.com:5432/event_logger</span>
<span class="na">jdbc.user</span><span class="o">=</span><span class="s">test_psql</span>
<span class="na">jdbc.password</span><span class="o">=</span><span class="s">test12</span>
</pre></div>
</div>
<p>The user needs to have sufficient rights to create tables and insert data in the
configured schema.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not good practice to use the <code class="docutils literal notranslate"><span class="pre">public</span></code> schema. The user should be
configured to use a different schema, by default. See the <a class="reference external" href="https://www.postgresql.org/docs/current/ddl-schemas.html#DDL-SCHEMAS-PATTERNS">PostgreSQL
documentation</a>
for details.</p>
</div>
<p>The cluster must be restarted after creating configuration file. At first usage
the table <code class="docutils literal notranslate"><span class="pre">completed_queries</span></code> is automatically created in the PostgreSQL
database.</p>
<p>Once the table is created, logging is activated and running.</p>


<h2 id="logged-information">Logged information<a class="headerlink" href="#logged-information" title="Permalink to this headline">#</a></h2>
<p>Information from processing queries is logged in multiple tables and the
contained fields. Details are documented in the following sections.</p>

<h3 id="completed-queries">Completed queries<a class="headerlink" href="#completed-queries" title="Permalink to this headline">#</a></h3>
<p>A row is created in the <code class="docutils literal notranslate"><span class="pre">completed_queries</span></code> table for each submitted query. It
captures everything that SEP emits – query, user, metadata, stats, performance
related attributes, resource consumption, start time, end time, and much more:</p>
<table id="id1">
<caption><span class="caption-text">Columns of the <code class="docutils literal notranslate"><span class="pre">completed_queries</span></code> table</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 35%"/>
<col style="width: 65%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">query_id</span></code></p></td>
<td><p>Unique identifier of the query</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">catalog</span></code></p></td>
<td><p>Session catalog</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">schema</span></code></p></td>
<td><p>Session schema</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">principal</span></code></p></td>
<td><p>Identity used to authenticate to SEP</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">user_agent</span></code></p></td>
<td><p>User agent that submitted the query</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">client_info</span></code></p></td>
<td><p>Information about the client submitting the query</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p>Client tool or driver used to execute query</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">environment</span></code></p></td>
<td><p>Name of the SEP environment name</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">remote_client_address</span></code></p></td>
<td><p>Address of the client that submitted the query</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">server_version</span></code></p></td>
<td><p>Version of SEP that executed the query</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usr</span></code></p></td>
<td><p>Identity used for authorization and access control</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">usr_groups</span></code></p></td>
<td><p>The groups the user executing the query belongs to, as an array of strings</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">query_state</span></code></p></td>
<td><p>State of the query when logged</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">query</span></code></p></td>
<td><p>Full SQL statement of the submitted query</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">query_plan</span></code></p></td>
<td><p>Full explain plan of the submitted query, including costs for each stage.
Identical to the output from <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span> <span class="pre">ANALYZE</span> <span class="pre">&lt;query&gt;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">total_rows</span></code></p></td>
<td><p>Sum of all rows used in the query input</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">total_bytes</span></code></p></td>
<td><p>Sum of all bytes used in the query input</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">output_rows</span></code></p></td>
<td><p>Number of filtered rows on query output</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">output_bytes</span></code></p></td>
<td><p>Number of filtered bytes on query output</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">written_rows</span></code></p></td>
<td><p>Number of inserted rows</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">written_bytes</span></code></p></td>
<td><p>Number of bytes of inserted rows</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cpu_time_ms</span></code></p></td>
<td><p>Total accumulated CPU time across threads and workers</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wall_time_ms</span></code></p></td>
<td><p>Elapsed time for query pressing as measured by a wall clock in ms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">queued_time_ms</span></code></p></td>
<td><p>Time spent between query submission and the beginning of query planning
in ms</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">peak_user_memory_bytes</span></code></p></td>
<td><p>Maximum amount of memory directly tied to query resources used by a query
at one time</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">peak_total_non_revocable_memory_bytes</span></code></p></td>
<td><p>Maximum amount of memory used at one time which is not eligible to be
spilled to disk</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">peak_task_user_memory</span></code></p></td>
<td><p>Maximum amount of user memory reserved at one time by one task</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">peak_task_total_memory</span></code></p></td>
<td><p>Maximum amount of user and system memory reserved at one time by one task,
values are impacted by the <a class="reference internal" href="../admin/properties-memory-management.html"><span class="doc">memory management configurations</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">physical_input_bytes</span></code></p></td>
<td><p>Number of uncompressed bytes read from source</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">physical_input_rows</span></code></p></td>
<td><p>Number of rows read from source</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">internal_network_bytes</span></code></p></td>
<td><p>Number of bytes of data exchanged between nodes during query execution</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">internal_network_rows</span></code></p></td>
<td><p>Number of rows of data exchanged between nodes during query execution</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cumulative_memory</span></code></p></td>
<td><p>Integral of memory reservation with respect to time, giving units of
<code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">x</span> <span class="pre">time</span></code>. Dividing this figure by the execution time approximates
the average memory reservation during query execution.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">completed_splits</span></code></p></td>
<td><p>Total number of splits completed by the query</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">plan_node_stats_and_costs</span></code></p></td>
<td><p>Table statistics for each source table, as well as estimates for the CPU,
memory, and network I/O for each stage of the query plan and each operator
in each plan node. Operator costs are denoted by their plan node ID, as
indicated from the <code class="docutils literal notranslate"><span class="pre">operator_summaries</span></code> column. Cost values do not
represent any actual unit, but are numbers that are used to compare the
relative costs between plan nodes, allowing the optimizer to choose the
best plan for executing a query.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">stage_gc_statistics</span></code></p></td>
<td><p>Information about JVM garbage collection tasks and time spent in GC for
each query stage</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cpu_time_distribution</span></code></p></td>
<td><p>Min, max, average, and percentiles for reserved CPU time per task for each
query stage. Can be useful for identifying skew in a query.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">operator_summaries</span></code></p></td>
<td><p>Information about every operator, including operator type (TableScan,
Aggregation, Join, etc.) and resources used (CPU time, network I/O,
memory reserved, etc.) invoked at each stage of the query.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">resource_waiting_time</span></code></p></td>
<td><p>Time spent waiting for sufficient resources before query execution in ms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">analysis_time</span></code></p></td>
<td><p>Time spent reading the metadata and checking the query for semantic errors
in ms</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">execution_time</span></code></p></td>
<td><p>Total time a query spent in the execution phase in ms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">create_time</span></code></p></td>
<td><p>Timestamp from when query was received</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">end_time</span></code></p></td>
<td><p>Timestamp when results were finished being consumed by the client</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">accessed_metadata</span></code></p></td>
<td><p>List of catalogs, schemas, tables, and columns read. Query must be a
<code class="docutils literal notranslate"><span class="pre">SELECT</span></code> query that returned more than 0 rows.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">planning_time</span></code></p></td>
<td><p>Time spent creating and optimizing the query plan in ms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">scheduled_time</span></code></p></td>
<td><p>Total time a query’s tasks were scheduled on a thread to run in ms</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failure_info</span></code></p></td>
<td><p>Information about a query’s failure reason (if applicable), as a JSON
formatted string.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">query_type</span></code></p></td>
<td><p>The type of query. Possible values are the ones enumerated for the
<code class="docutils literal notranslate"><span class="pre">queryType</span></code> selector rule for <a class="reference internal" href="../admin/resource-groups.html"><span class="doc">Resource Groups</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">update_type</span></code></p></td>
<td><p>The type of update the query performed (e.g. <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code>); this
column is <code class="docutils literal notranslate"><span class="pre">null</span></code> for <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> queries.</p></td>
</tr>
</tbody>
</table>


<h3 id="query-tables">Query tables<a class="headerlink" href="#query-tables" title="Permalink to this headline">#</a></h3>
<p>For every table referenced by a query, zero, one or more rows with information
about the accessed table is created in the <code class="docutils literal notranslate"><span class="pre">query_tables</span></code> table. The
<code class="docutils literal notranslate"><span class="pre">query_id</span></code> defines the relationship to the query in the <code class="docutils literal notranslate"><span class="pre">completed_queries</span></code>
table.</p>
<table id="id2">
<caption><span class="caption-text">Columns of the <code class="docutils literal notranslate"><span class="pre">query_tables</span></code> table</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 35%"/>
<col style="width: 65%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">query_id</span></code></p></td>
<td><p>Unique identifier of the query</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">catalog_name</span></code></p></td>
<td><p>Name of the catalog containing the queried table</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">schema_name</span></code></p></td>
<td><p>Name of the schema containing the queried table</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">table_name</span></code></p></td>
<td><p>Name of the queried table</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">physical_bytes</span></code></p></td>
<td><p>Number of bytes read or written</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">physical_rows</span></code></p></td>
<td><p>Number of rows read or written</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">is_output</span></code></p></td>
<td><p>Boolean flag indicating whether the table was written to (<code class="docutils literal notranslate"><span class="pre">true</span></code>) or
read from (<code class="docutils literal notranslate"><span class="pre">false</span></code>)</p></td>
</tr>
</tbody>
</table>



<h2 id="analyzing-the-event-log">Analyzing the event log<a class="headerlink" href="#analyzing-the-event-log" title="Permalink to this headline">#</a></h2>
<p>To analyze and query the event log, you can create a catalog with the
<a class="reference internal" href="../connector/postgresql.html"><span class="doc">PostgreSQL connector</span></a> using the same JDBC
connection parameters. This allows you to use the Presto CLI, or any other
application connected to the catalog to create queries, dashboards, perform ad
hoc analysis and more.</p>
<p>Example use cases:</p>
<ul class="simple">
<li><p>measure query performance numbers and trends</p></li>
<li><p>understand impact of different cluster configurations</p></li>
<li><p>enable cluster workload management and resource consumption</p></li>
</ul>


<h2 id="example">Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h2>
<p>Generate event logger data by running a query.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>presto&gt; CREATE TABLE memory.default.country AS
        SELECT n.name nation_name, r.name region_name
        FROM delta.sf1.nation n JOIN delta.sf1.region r ON n.regionkey = r.regionkey;
CREATE TABLE: 25 rows

Query 20201209_021306_00003_qsyab, FINISHED, 1 node
Splits: 68 total, 68 done (100.00%)
3.34 [35 rows, 5.35KB] [10 rows/s, 1.6KB/s]
</pre></div>
</div>
<p>Event logger data is written to the <code class="docutils literal notranslate"><span class="pre">completed_queries</span></code> table in the
PostgreSQL database.</p>
<p>In the following example, the catalog file is named <code class="docutils literal notranslate"><span class="pre">event_logger.properties</span></code>
and the <code class="docutils literal notranslate"><span class="pre">public</span></code> schema contains the <code class="docutils literal notranslate"><span class="pre">completed_queries</span></code> table. The
<code class="docutils literal notranslate"><span class="pre">query_id</span></code> from the execution is used to locate the correct record. The output
in the following example has been trimmed.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>presto&gt; SELECT *
        FROM event_logger.public.completed_queries
        WHERE query_id = '20201209_021306_00003_qsyab';
-[ RECORD 1 ]-------------------------+---------------------------------------
query_id                              | 20201209_021306_00003_qsyab
catalog                               | NULL
schema                                | NULL
principal                             | demo
user_agent                            | StatementClientV1/345
client_info                           | NULL
source                                | presto-cli
environment                           | demo
remote_client_address                 | 127.0.0.1
server_version                        | 350-e
usr                                   | demo
query_state                           | FINISHED
query                                 | CREATE TABLE memory.default.country AS SELECT n.name nation_name, r.name region_name FROM delta.sf1.nation n JOIN delta.sf1.region r ON n.regionkey = r.regionkey
query_plan                            | Fragment 0 [COORDINATOR_ONLY]
                                      |     CPU: 43.24ms, Scheduled: 60.81ms, Input: 2 rows (81B); per task: avg.: 2.00 std.dev.: 0.00, Output: 1 row (9B)
                                      |     Output layout: [rows]
                                      | ...
total_rows                            | 35
total_bytes                           | 5477
output_rows                           | 1
output_bytes                          | 9
written_rows                          | 25
written_bytes                         | 597
cpu_time_ms                           | 392
wall_time_ms                          | 3342
queued_time_ms                        | 10
peak_user_memory_bytes                | 387318
peak_total_non_revocable_memory_bytes | 387318
peak_task_user_memory                 | 387318
peak_task_total_memory                | 387318
physical_input_bytes                  | 5274
physical_input_rows                   | 30
internal_network_bytes                | 933
internal_network_rows                 | 32
cumulative_memory                     | 7.7086698E7
completed_splits                      | 68
plan_node_stats_and_costs             | {"stats":{},"costs":{}}
stage_gc_statistics                   | [{"stageId":0,"tasks":1,"fullGcTasks":0,...
cpu_time_distribution                 | [{"stageId":0,"tasks":1,"p25":25,"p50":25,...
operator_summaries                    | [{"stageId":0,"pipelineId":0,"operatorId":0,..
resource_waiting_time                 | 783
analysis_time                         | 783
execution_time                        | 2559
create_time                           | 2020-12-09 02:13:06.140000 UTC
end_time                              | 2020-12-09 02:13:09.482000 UTC
accessed_metadata                     | [{"catalogName":"delta","schema":"sf1","table":"nation","columns":["name","regionkey"],...
failure_info                          | NULL
update_type                           | CREATE TABLE
planning_time                         | 1711
scheduled_time                        | 1263
</pre></div>
</div>
<p>The tables accessed by the query are recorded in the <code class="docutils literal notranslate"><span class="pre">query_tables</span></code> table and
can be identified using the same <code class="docutils literal notranslate"><span class="pre">query_id</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>presto&gt; SELECT *
        FROM event_logger.public.query_tables
        WHERE query_id = '20201209_021306_00003_qsyab';
          query_id           | catalog_name | schema_name | table_name | physical_bytes | physical_rows | is_output
-----------------------------+--------------+-------------+------------+----------------+---------------+-----------
 20201209_021306_00003_qsyab | memory       | default     | country    |            597 |            25 | true
 20201209_021306_00003_qsyab | delta        | sf1         | region     |           1691 |             5 | false
 20201209_021306_00003_qsyab | delta        | sf1         | nation     |           3583 |            25 | false
(3 rows)
</pre></div>
</div>




          </article>
        </div>
      </div>
    </main>
  </div>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="audit.html" title="Query audit"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Query audit </span>
              </div>
            </a>
          
          
            <a href="../admin.html" title="Administration"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Administration </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>

<!-- custom footer should go here in time -->

<div style="background: #000A2C; align-content: center; height: 5em;">

</div>
  </body>
</html>