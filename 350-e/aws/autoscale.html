

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Auto scaling &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <link rel="stylesheet" type="text/css" href="../_static/starburst.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coordinator high availability" href="high-availability.html" />
    <link rel="prev" title="Manually scaling a running SEP cluster" href="manualscale.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#aws/autoscale" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Starburst Enterprise"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/Starburst_Logo_NoTag_White.png" height="26"
                   alt="Starburst Enterprise logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Starburst Enterprise</span>
          <span class="md-header-nav__topic"> Auto scaling </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose another version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (350-e)" href="/350-e/">Latest LTS (350-e)</a>
      
          <a title="345-e LTS" href="/345-e/">345-e LTS</a>
      
          <a title="338-e LTS" href="/338-e/">338-e LTS</a>
      
          <a title="332-e LTS" href="/332-e/">332-e LTS</a>
      
          <a title="Latest STS (348-e)" href="/348-e/">Latest STS (348-e)</a>
      
          <a title="347-e STS" href="/347-e/">347-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>


  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Reference documentation</a></li>
            
            <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">User guides</a></li>
            
            <li class="md-tabs__item"><a href="https://starburst.io" class="md-tabs__link">Starburst</a></li>
          <li class="md-tabs__item"><a href="../aws.html" class="md-tabs__link">Amazon Web Services</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../_static/Starburst_Logo_NoTag_White.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Starburst Enterprise">Starburst Enterprise</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mission-control.html" class="md-nav__link">Mission Control</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../aws.html" class="md-nav__link">Amazon Web Services</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="quickstart.html" class="md-nav__link">Getting started on AWS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="prerequisites.html" class="md-nav__link">Prerequisites</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="deploy.html" class="md-nav__link">Deploying SEP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="configuration.html" class="md-nav__link">Configuring SEP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="metastore.html" class="md-nav__link">Configuring Hive Metastore</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="access.html" class="md-nav__link">Accessing the SEP cluster</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="query.html" class="md-nav__link">Querying SEP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="s3.html" class="md-nav__link">Querying AWS S3</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="glue.html" class="md-nav__link">AWS Glue support</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="superset.html" class="md-nav__link">Using Apache Superset</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="manualscale.html" class="md-nav__link">Manually scaling a running SEP cluster</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Auto scaling </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Auto scaling</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#aws-autoscale--page-root" class="md-nav__link">Auto scaling</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#manage-auto-scaling-groups" class="md-nav__link">Manage auto scaling groups</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#auto-scaling-models" class="md-nav__link">Auto scaling models</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#static-or-manual-auto-scaling" class="md-nav__link">Static or manual auto scaling</a>
        </li>
        <li class="md-nav__item"><a href="#static-or-scheduled-auto-scaling" class="md-nav__link">Static or scheduled auto scaling</a>
        </li>
        <li class="md-nav__item"><a href="#dynamic-auto-scaling" class="md-nav__link">Dynamic auto scaling</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#auto-scaling-activity" class="md-nav__link">Auto scaling activity</a>
        </li>
        <li class="md-nav__item"><a href="#manual" class="md-nav__link">Manual</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#graceful-scaledown-of-workers" class="md-nav__link">Graceful scaledown of workers</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#how-it-works" class="md-nav__link">How it works</a>
        </li>
        <li class="md-nav__item"><a href="#aws-elements-on-the-stack" class="md-nav__link">AWS elements on the stack</a>
        </li>
        <li class="md-nav__item"><a href="#sep-node-role-permissions" class="md-nav__link">SEP node role permissions</a>
        </li>
        <li class="md-nav__item"><a href="#graceful-scaledown-limitations" class="md-nav__link">Graceful scaledown limitations</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="high-availability.html" class="md-nav__link">Coordinator high availability</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="secrets.html" class="md-nav__link">Secrets</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="logs.html" class="md-nav__link">Integration with CloudWatch logs</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="metrics.html" class="md-nav__link">Integration with CloudWatch metrics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="troubleshooting.html" class="md-nav__link">Troubleshooting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="uninstall.html" class="md-nav__link">Uninstalling SEP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="release-notes.html" class="md-nav__link">AWS AMI/CFT release notes</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../k8s.html" class="md-nav__link">Kubernetes with Helm</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../insights.html" class="md-nav__link">Insights</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../versions.html" class="md-nav__link">350-e.6 LTS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../404.html" class="md-nav__link">&nbsp;</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#aws-autoscale--page-root" class="md-nav__link">Auto scaling</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#manage-auto-scaling-groups" class="md-nav__link">Manage auto scaling groups</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#auto-scaling-models" class="md-nav__link">Auto scaling models</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#static-or-manual-auto-scaling" class="md-nav__link">Static or manual auto scaling</a>
        </li>
        <li class="md-nav__item"><a href="#static-or-scheduled-auto-scaling" class="md-nav__link">Static or scheduled auto scaling</a>
        </li>
        <li class="md-nav__item"><a href="#dynamic-auto-scaling" class="md-nav__link">Dynamic auto scaling</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#auto-scaling-activity" class="md-nav__link">Auto scaling activity</a>
        </li>
        <li class="md-nav__item"><a href="#manual" class="md-nav__link">Manual</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#graceful-scaledown-of-workers" class="md-nav__link">Graceful scaledown of workers</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#how-it-works" class="md-nav__link">How it works</a>
        </li>
        <li class="md-nav__item"><a href="#aws-elements-on-the-stack" class="md-nav__link">AWS elements on the stack</a>
        </li>
        <li class="md-nav__item"><a href="#sep-node-role-permissions" class="md-nav__link">SEP node role permissions</a>
        </li>
        <li class="md-nav__item"><a href="#graceful-scaledown-limitations" class="md-nav__link">Graceful scaledown limitations</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="aws-autoscale--page-root">Auto scaling<a class="headerlink" href="#aws-autoscale--page-root" title="Permalink to this headline">#</a></h1>
<p>AWS Auto Scaling offers automatic control over the size of your Starburst Enterprise platform (SEP)
cluster (CloudFormation stack).</p>

<h2 id="manage-auto-scaling-groups">Manage auto scaling groups<a class="headerlink" href="#manage-auto-scaling-groups" title="Permalink to this headline">#</a></h2>
<p>When you create a cluster, an auto scaling group (ASG) is automatically created
for all the workers. To view and manage this ASG, refer to the <a class="reference external" href="https://console.aws.amazon.com/ec2/autoscaling/home?#AutoScalingGroups">AWS ASG</a> page
and log into your AWS account. There, you see a list of ASGs for all workers
across all clusters you have running. Here, you can control how Amazon Auto
Scaling manages your cluster.</p>

<h3 id="auto-scaling-models">Auto scaling models<a class="headerlink" href="#auto-scaling-models" title="Permalink to this headline">#</a></h3>
<p>There are three types of auto scaling models you can employ to manage your
cluster:</p>
<ul class="simple">
<li><p>Static/Manual</p></li>
<li><p>Static/Scheduled</p></li>
<li><p>Dynamic</p></li>
</ul>

<h4 id="static-or-manual-auto-scaling">Static or manual auto scaling<a class="headerlink" href="#static-or-manual-auto-scaling" title="Permalink to this headline">#</a></h4>
<p>The static or manual auto scaling model is managed from the “Details” tab. This
model is configured by default. In this tab, there are three main properties:
“Desired Capacity”, “Min” and “Max”. Click on the “Edit” button to change those
values to your desired values and when you hit “Save” the auto scaling mechanism
starts to satisfy your requirements – either spinning up new workers or
shutting down existing ones.</p>
<p>In the CloudFormation template, by default, all three properties are
set to the same value. As a result the number of workers remains constant. When
a worker is terminated (or is unavailable for whatever reason), auto scaling
starts a new one to satisfy the requirements.</p>


<h4 id="static-or-scheduled-auto-scaling">Static or scheduled auto scaling<a class="headerlink" href="#static-or-scheduled-auto-scaling" title="Permalink to this headline">#</a></h4>
<p>The static or scheduled auto scaling model is controlled from the “Scheduled
Actions” tab. There, you can create a number of scheduled actions that allow you
to change the size of the cluster based on the time of day. For example, you can
keep a small number of nodes during the night, and boost it during different
parts of the day.</p>
<p>The configuration of this model is a simple list of actions that are scheduled
to execute and change the static values of “Min”, “Max” and “Desired Capacity”
properties to some other arbitrary (static) values of your choosing. Such an
action is  executed with the configured schedule, either once or in a repetitive
manner (cron). Continuing on the previous example, you can configure a nightly
cooldown – one event to handle lowering the values in the evening and another
event every morning to bring them back up.</p>


<h4 id="dynamic-auto-scaling">Dynamic auto scaling<a class="headerlink" href="#dynamic-auto-scaling" title="Permalink to this headline">#</a></h4>
<p>Dynamic auto scaling uses policies which you define in the in the “Scaling
Policies” tab. Of the three types of policies, “scaling policy with steps” and
“target tracking scaling policy” (default policy), are the most useful. The
third is a special case of the “with steps” policy that contains a single step.
You can change the policy type by clicking a link at the bottom of the “Scaling
Policies” tab.</p>
<ul>
<li><p><strong>Dynamic target tracking:</strong></p>
<p>With the dynamic target tracking policy you: (1) choose a relevant metric
(eg., avg CPU utilization) and state the target value; and (2) indicate the
time buffer to wait before reassessing the metric to let the new nodes start
up and start contributing to the metric value. Additionally, you can disable
scale-in to have the mechanism be able to only increase the worker count,
not shrink the cluster.</p>
</li>
<li><p><strong>Dynamic “with steps”:</strong></p>
<p>The dynamic “with steps” policy is more complex, as it consists of an alarm
and a number of adjustments. To define an alarm, you must choose a metric
and define its breach criteria (eg., avg CPU utilization over a chosen
period of time higher than 70%). Additionally, the alarm can optionally send
an event to an SNS topic for other systems to observe. Once the alarm is
breached, a set of adjustments to the number of nodes are executed. Those
adjustments can be either arbitrary (setting the number of nodes to a
specific value) or increments. The increments can be a value (eg., add 2
nodes, or remove 1 node) or a percentage of the current number of workers
(eg., add 10%, or reduce by 20%).</p>
</li>
</ul>



<h3 id="auto-scaling-activity">Auto scaling activity<a class="headerlink" href="#auto-scaling-activity" title="Permalink to this headline">#</a></h3>
<p>All events in the auto scaling mechanism can be observed in the Activity History
tab. This is very useful for debugging purposes. The current instances part of
the ASG are listed in the “Instances” tab. There you can observe which instances
are currently being started-up or decommissioned.</p>


<h3 id="manual">Manual<a class="headerlink" href="#manual" title="Permalink to this headline">#</a></h3>
<p>Auto scaling can also be used for clusters built manually using the Starburst
AMIs and not using the CloudFormation stack. The workers need to be manually put
into a single ASG, and configured as described above. Graceful
scaledown of workers, as described in the <a class="reference internal" href="#graceful-scaledown"><span class="std std-ref">Graceful scaledown of workers</span></a>, does not
work for manually setup auto scaling groups.</p>



<span id="graceful-scaledown"></span><h2 id="graceful-scaledown-of-workers">Graceful scaledown of workers<a class="headerlink" href="#graceful-scaledown-of-workers" title="Permalink to this headline">#</a></h2>
<p>When a CloudFormation stack is created using the CloudFormation template all the
workers are automatically organized within an AWS ASG.</p>
<p>When AWS auto scaling resizes the cluster it starts decommissioning workers. The
CloudFormation stack has features to make sure this process doesn’t disrupt the
usage of the cluster, most importantly that no queries fail because of that.</p>
<p>Without this feature if a worker is forcefully shut down, all queries currently
running fail and need to be restarted.</p>

<h3 id="how-it-works">How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">#</a></h3>
<p>With graceful scaledown, when the ASG stack is modified to shrink
the cluster (number of workers lowered, or the auto scaling group is configured
to do so automatically) then AWS auto scaling notifies the workers it intends to
shut down and let them prepare for this.</p>
<p>The worker enters a special state in which it (1) stops serving new requests,
(2) continues processing the current query tasks that are scheduled on it and
(3) shuts down after finishing that work. Next after a 2 minute quiet period the
worker process automatically exits, and notifies the auto scaling mechanism to
proceed with the termination of its EC2 node.</p>
<p>The maximum time a worker can postpone AWS auto scaling termination of its node
is 48hrs, this is a AWS limitation.</p>


<h3 id="aws-elements-on-the-stack">AWS elements on the stack<a class="headerlink" href="#aws-elements-on-the-stack" title="Permalink to this headline">#</a></h3>
<p>The CloudFormation Template creates a number of resources on the
stack:</p>
<ul class="simple">
<li><p>an <a class="reference external" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/lifecycle-hooks.html">Auto Scaling Hook</a></p></li>
<li><p>an <a class="reference external" href="https://aws.amazon.com/documentation/sqs/">SQS Queue</a> that this hook writes to</p></li>
<li><p>an <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">IAM Role</a> and an <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html">InstanceProfile</a> wrapper to allow auto scaling to
write to SQS</p></li>
<li><p>an <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">IAM Role</a> to allow the workers to talk to SQS, Auto scaling and
EC2 services. The role is fine grained to allow only the necessary actions.
It’s discussed in a section below.</p></li>
</ul>
<p>All the resources created on the stack are explicit, and you can find them and
view their settings/permissions. All resources are terminated once the stack is
deleted.</p>


<h3 id="sep-node-role-permissions">SEP node role permissions<a class="headerlink" href="#sep-node-role-permissions" title="Permalink to this headline">#</a></h3>
<p><strong>The node role is created automatically by the CloudFormation template
on the stack (and deleted when the stack is deleted).</strong></p>
<p><strong>When using Starburst via our CloudFormation template, by default, you do not
need to provide anything. The template creates all necessary resources
automatically.</strong></p>
<p>If you need to provide your own IAM Instance Profile for the SEP instances
(<code class="docutils literal notranslate"><span class="pre">IamInstanceProfile</span></code> field in the Stack creation form), consult the
<a class="reference internal" href="prerequisites.html#aws-security-prereq-nodes"><span class="std std-ref">IAM role Permissions for cluster nodes</span></a> section. Same applies when launching the AMI
manually. Make sure you choose an IAM Role that satisfies the requirements.</p>


<h3 id="graceful-scaledown-limitations">Graceful scaledown limitations<a class="headerlink" href="#graceful-scaledown-limitations" title="Permalink to this headline">#</a></h3>
<p>PrestoSQL instances created manually from the AWS Marketplace AMIs and manually
setup in an ASG do not benefit from this mechanism without manual setup. They
are operating without graceful scaledown, so when auto scaling kicks in, all
queries that are currently running may fail. In that case, at boot time a
warning log is recorded in the graceful scaledown handler log saying it’s not
running - this is intended behavior.</p>





          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-grid md-main__inner" style="height: auto;">
  <div class="md-content">
    <div class="feedback-container md-content__inner md-typeset">
      <div class="feedback-thumbs">
        <p>Is the information on this page helpful?</p>
        <p class="feedback-option" title="yes">Yes</p>
        <p class="feedback-option" title="no">No</p>
      </div>
      <div class="feedback-message">
        <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
        <button type="button" onclick="sendMessage()" class="feedback-button">Submit</button>
        <a onclick="skip()" class="feedback-skip">Skip</a>
      </div>
    </div>
  </div>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '');
</script>
<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="manualscale.html" title="Manually scaling a running SEP cluster"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Manually scaling a running SEP cluster </span>
              </div>
            </a>
          
          
            <a href="high-availability.html" title="Coordinator high availability"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Coordinator high availability </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>

<!-- custom footer should go here in time -->

<div style="background: #000A2C; align-content: center; height: 5em;">

</div>
  </body>
</html>