

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Cache service &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/trino.css" />
    <link rel="stylesheet" type="text/css" href="../_static/starburst.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/main.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cache service CLI" href="cache-service-cli.html" />
    <link rel="prev" title="Graceful shutdown" href="graceful-shutdown.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#admin/cache-service" tabindex="1" class="md-skip"> Skip to content </a>
  
<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://www.starburst.io" title="Starburst Enterprise"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/Starburst_Logo_NoTag_White.png" height="26"
                   alt="Starburst Enterprise logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Starburst Enterprise</span>
          <span class="md-header-nav__topic"> Cache service </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose another version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (356-e)" href="/356e/">Latest LTS (356-e)</a>
      
          <a title="350-e LTS" href="/350-e/">350-e LTS</a>
      
          <a title="345-e LTS" href="/345-e/">345-e LTS</a>
      
          <a title="338-e LTS" href="/338-e/">338-e LTS</a>
      
          <a title="Latest STS (355-e)" href="/355-e/">Latest STS (355-e)</a>
      
          <a title="354-e STS" href="/354-e/">354-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>


  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Reference documentation</a></li>
            
            <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">User guides</a></li>
          <li class="md-tabs__item"><a href="../admin.html" class="md-tabs__link">Administration</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../_static/Starburst_Logo_NoTag_White.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Starburst Enterprise">Starburst Enterprise</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../aws.html" class="md-nav__link">Amazon Web Services</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../k8s.html" class="md-nav__link">Kubernetes with Helm</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="web-interface.html" class="md-nav__link">Web UI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tuning.html" class="md-nav__link">Tuning Starburst Enterprise</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jmx.html" class="md-nav__link">Monitoring with JMX</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="properties.html" class="md-nav__link">Properties reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="spill.html" class="md-nav__link">Spill to disk</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="resource-groups.html" class="md-nav__link">Resource groups</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="session-property-managers.html" class="md-nav__link">Session property managers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dist-sort.html" class="md-nav__link">Distributed sort</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dynamic-filtering.html" class="md-nav__link">Dynamic filtering</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="graceful-shutdown.html" class="md-nav__link">Graceful shutdown</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Cache service </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Cache service</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-cache-service--page-root" class="md-nav__link">Cache service</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#requirements" class="md-nav__link">Requirements</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#linux-operating-system" class="md-nav__link">Linux Operating System</a>
        </li>
        <li class="md-nav__item"><a href="#java-runtime-environment" class="md-nav__link">Java Runtime Environment</a>
        </li>
        <li class="md-nav__item"><a href="#python" class="md-nav__link">Python</a>
        </li>
        <li class="md-nav__item"><a href="#relational-database" class="md-nav__link">Relational database</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#installation" class="md-nav__link">Installation</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#standalone-deployment" class="md-nav__link">Standalone deployment</a>
        </li>
        <li class="md-nav__item"><a href="#embedded-mode" class="md-nav__link">Embedded mode</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#jvm-configuration" class="md-nav__link">JVM configuration</a>
        </li>
        <li class="md-nav__item"><a href="#configuration-properties" class="md-nav__link">Configuration properties</a>
        </li>
        <li class="md-nav__item"><a href="#tls-and-authentication" class="md-nav__link">TLS and authentication</a>
        </li>
        <li class="md-nav__item"><a href="#log-levels" class="md-nav__link">Log Levels</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#cache-refresh-rules" class="md-nav__link">Cache refresh rules</a>
        </li>
        <li class="md-nav__item"><a href="#running-the-cache-service" class="md-nav__link">Running the cache service</a>
        </li>
        <li class="md-nav__item"><a href="#docker-container" class="md-nav__link">Docker container</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#getting-started" class="md-nav__link">Getting started</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#jmx-metrics" class="md-nav__link">JMX metrics</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cache-service-cli.html" class="md-nav__link">Cache service CLI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="usage-metrics.html" class="md-nav__link">Usage metrics</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../insights.html" class="md-nav__link">Insights</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../appendix.html" class="md-nav__link">Appendix</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../versions.html" class="md-nav__link">355-e STS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../404.html" class="md-nav__link">&nbsp;</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-cache-service--page-root" class="md-nav__link">Cache service</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#requirements" class="md-nav__link">Requirements</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#linux-operating-system" class="md-nav__link">Linux Operating System</a>
        </li>
        <li class="md-nav__item"><a href="#java-runtime-environment" class="md-nav__link">Java Runtime Environment</a>
        </li>
        <li class="md-nav__item"><a href="#python" class="md-nav__link">Python</a>
        </li>
        <li class="md-nav__item"><a href="#relational-database" class="md-nav__link">Relational database</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#installation" class="md-nav__link">Installation</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#standalone-deployment" class="md-nav__link">Standalone deployment</a>
        </li>
        <li class="md-nav__item"><a href="#embedded-mode" class="md-nav__link">Embedded mode</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#jvm-configuration" class="md-nav__link">JVM configuration</a>
        </li>
        <li class="md-nav__item"><a href="#configuration-properties" class="md-nav__link">Configuration properties</a>
        </li>
        <li class="md-nav__item"><a href="#tls-and-authentication" class="md-nav__link">TLS and authentication</a>
        </li>
        <li class="md-nav__item"><a href="#log-levels" class="md-nav__link">Log Levels</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#cache-refresh-rules" class="md-nav__link">Cache refresh rules</a>
        </li>
        <li class="md-nav__item"><a href="#running-the-cache-service" class="md-nav__link">Running the cache service</a>
        </li>
        <li class="md-nav__item"><a href="#docker-container" class="md-nav__link">Docker container</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#getting-started" class="md-nav__link">Getting started</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#jmx-metrics" class="md-nav__link">JMX metrics</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="admin-cache-service--page-root">Cache service<a class="headerlink" href="#admin-cache-service--page-root" title="Permalink to this headline">#</a></h1>
<p>The Starburst Enterprise platform (SEP) cache service provides the ability to configure and automate the
management of <a class="reference internal" href="../connector/starburst-shared-features.html#shared-table-scan-redirection"><span class="std std-ref">table scan redirections</span></a>.
The service connects to an existing SEP installation to run queries for
copying data from the source catalog to the target catalog. The target catalog
is regularly synchronized with the source and used as a cache.</p>
<p>The cache service can be run as a standalone service or within the coordinator
process. You can interact with it using its REST API, or the <a class="reference internal" href="cache-service-cli.html"><span class="doc">cache service
CLI</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table scan redirection and the cache service requires a valid
<a class="reference internal" href="../installation/license-requirements.html"><span class="doc">Starburst Enterprise license</span></a>.</p>
</div>

<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">#</a></h2>
<p>The cache service has similar requirements to SEP, which are described on
the <a class="reference internal" href="../installation/deployment.html"><span class="doc">Deploying</span></a> page.</p>

<h3 id="linux-operating-system">Linux Operating System<a class="headerlink" href="#linux-operating-system" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>64-bit required</p></li>
<li><p>Newer release preferred, especially when running on containers</p></li>
</ul>


<h3 id="java-runtime-environment">Java Runtime Environment<a class="headerlink" href="#java-runtime-environment" title="Permalink to this headline">#</a></h3>
<p>The cache service requires a 64-bit version of Java 11. Newer major versions
such as Java 12 or 13 are not supported – they may work, but are not tested.</p>


<h3 id="python">Python<a class="headerlink" href="#python" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>version 2.6.x, 2.7.x, or 3.x</p></li>
<li><p>required by the <code class="docutils literal notranslate"><span class="pre">bin/launcher</span></code> script only</p></li>
</ul>


<h3 id="relational-database">Relational database<a class="headerlink" href="#relational-database" title="Permalink to this headline">#</a></h3>
<p>The cache service requires an externally managed database for storing table
scan redirections data. The following RDBMS are supported:</p>
<ul class="simple">
<li><p>MySQL 8.0.12+</p></li>
<li><p>PostgreSQL 9.6+</p></li>
<li><p>OracleDB 12.2.0.1+</p></li>
</ul>



<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<p>The cache service can be deployed either as a standalone application separate
from your SEP cluster or within the existing coordinator process.</p>

<h3 id="standalone-deployment">Standalone deployment<a class="headerlink" href="#standalone-deployment" title="Permalink to this headline">#</a></h3>
<p>A standalone deployment can ensure that the service remains unaffected by
the cluster switching over to a different coordinator in case of a
<a class="reference internal" href="../aws/high-availability.html"><span class="doc">Coordinator high availability</span></a> setup.
It also ensures that the service is not affected by coordinator performance,
or the deployment of a new release on the SEP cluster.</p>
<ul class="simple">
<li><p>To download the cache service binary file, contact Starburst Support</p></li>
<li><p>Starburst Support provides access to a file named much like
<code class="docutils literal notranslate"><span class="pre">starburst-cache-service-*.tar.gz</span></code></p></li>
<li><p>Extract it, for example with <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">xfvz</span> <span class="pre">starburst-cache-service-*.tar.gz</span></code></p></li>
</ul>
<p>The resulting directory <code class="docutils literal notranslate"><span class="pre">starburst-cache-service-nnn</span></code>, with <em>nnn</em> replaced by
the release number, is called the <em>installation</em> directory. It contains all
necessary resources.</p>
<p>Move the extracted directory into the desired location, such as <code class="docutils literal notranslate"><span class="pre">/opt/</span></code>, and
you are ready to proceed with configuring the service.</p>


<h3 id="embedded-mode">Embedded mode<a class="headerlink" href="#embedded-mode" title="Permalink to this headline">#</a></h3>
<p>The cache service can be setup to run within the coordinator process by
providing <a class="reference internal" href="#cache-service-config-properties"><span class="std std-ref">configuration for the cache service</span></a> on the coordinator in
<code class="docutils literal notranslate"><span class="pre">etc/cache.properties</span></code>. This mode of deployment does not require
installation of any additional packages or running a separate service.</p>
<p>Keep in mind that the coordinator JVM is used and it’s JVM and logging
configuration is also used for the cache service.</p>



<span id="cache-service-configuration"></span><h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">#</a></h2>
<p>Create an <code class="docutils literal notranslate"><span class="pre">etc</span></code> directory inside the installation directory to hold the
following configuration files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">etc/jvm.config</span></code> -  <a class="reference internal" href="#cache-service-jvm-config"><span class="std std-ref">command line configurations options for starting
the Java Virtual Machine (JVM)</span></a> used by the cache
service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">etc/config.properties</span></code> - <a class="reference internal" href="#cache-service-config-properties"><span class="std std-ref">configuration for the cache
service</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">etc/log.properties</span></code> - optional <a class="reference internal" href="#cache-service-log-properties"><span class="std std-ref">logging
configuration</span></a>
for the cache service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">etc/rules.json</span></code> -  <a class="reference internal" href="#cache-service-refresh-rules"><span class="std std-ref">JSON file</span></a>
specifying the source tables and target connector for the cache along with the
schedule for refreshing them</p></li>
</ul>

<span id="cache-service-jvm-config"></span><h3 id="jvm-configuration">JVM configuration<a class="headerlink" href="#jvm-configuration" title="Permalink to this headline">#</a></h3>
<p>The Java Virtual Machine (JVM) config file, <code class="docutils literal notranslate"><span class="pre">etc/jvm.config</span></code>, contains a list
of command line options used for launching the JVM running the cache service.
The format of the file is a list of options, one per line. These options are not
interpreted by the shell, so options containing spaces, or other special
characters, should not be quoted.</p>
<p>The following provides a good starting point for creating <code class="docutils literal notranslate"><span class="pre">etc/jvm.config</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-server
-Xmx512M
-XX:+ExitOnOutOfMemoryError
-XX:+HeapDumpOnOutOfMemoryError
</pre></div>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">OutOfMemoryError</span></code> typically leaves the JVM in an inconsistent state. The
above configuration causes the JVM to write a heap dump file for debugging, and
forcibly terminate the process when this occurs.</p>


<span id="cache-service-config-properties"></span><h3 id="configuration-properties">Configuration properties<a class="headerlink" href="#configuration-properties" title="Permalink to this headline">#</a></h3>
<p>The configuration properties file, <code class="docutils literal notranslate"><span class="pre">etc/config.properties</span></code>, contains the
configuration for the cache service.</p>
<p>The following is a minimal configuration for the service:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>service-database.user=alice
service-database.password=test123
service-database.jdbc-url=jdbc:mysql://mysql-server:13306/redirections
starburst.user=bob
starburst.jdbc-url=jdbc:presto://presto-coordinator:8080
rules.file=etc/rules.json
</pre></div>
</div>
<p>The properties to configure the cache service are explained in detail in the
following sections.</p>
<table id="id1">
<caption><span class="caption-text">General cache service configuration properties</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 32%"/>
<col style="width: 63%"/>
<col style="width: 5%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">starburst.user</span></code></p></td>
<td><p>username to connect to the SEP cluster for executing queries to refresh
the cached tables</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">starburst.password</span></code></p></td>
<td><p>password to connect to the SEP cluster when password based
authentication is enabled on the SEP cluster</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">starburst.jdbc-url</span></code></p></td>
<td><p>JDBC URL of the SEP cluster used for executing queries to refresh the
cached tables</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rules.file</span></code></p></td>
<td><p>path to the JSON file containing rules for identifying source tables and
target connector for caching. It also specifies a schedule for refreshing
cached tables.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rules.refresh-period</span></code></p></td>
<td><p>Frequency at which cache rules are refreshed from the <code class="docutils literal notranslate"><span class="pre">rules.file</span></code></p></td>
<td><p>1m</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max-table-import-threads</span></code></p></td>
<td><p>Maximum number of table import jobs that can be run in parallel</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">refresh-interval</span></code></p></td>
<td><p>Frequency at which the cache service triggers refresh of cached tables</p></td>
<td><p>10m</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">refresh-initial-delay</span></code></p></td>
<td><p>Initial delay for startup of the refresh</p></td>
<td><p>0s</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cleanup-interval</span></code></p></td>
<td><p>Frequency at which cache service triggers cleanup of expired tables in the
cache</p></td>
<td><p>10m</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cleanup-initial-delay</span></code></p></td>
<td><p>Initial delay for startup of the cleanup</p></td>
<td><p>0s</p></td>
</tr>
</tbody>
</table>
<p>The following required properties allow you to configure the connectivity to the
service database used for storing redirections.</p>
<table id="id2">
<caption><span class="caption-text">Cache service database related configuration properties</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 32%"/>
<col style="width: 63%"/>
<col style="width: 5%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">service-database.user</span></code></p></td>
<td><p>Username used to connect to the database storing table redirections</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">service-database.password</span></code></p></td>
<td><p>Password used to connect to the database storing table redirections</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">service-database.jdbc-url</span></code></p></td>
<td><p>JDBC URL of the database storing table redirections, only MySQL, PostgreSQL and Oracle
URLs are supported</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">service-database.connection-pool.enabled</span></code></p></td>
<td><p>Enables pooling for connections to the service database</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">service-database.connection-pool.max-size</span></code></p></td>
<td><p>Maximum number of connections in the pool</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">service-database.connection-pool.idle-timeout</span></code></p></td>
<td><p>Maximum time an idle connection is kept in the pool</p></td>
<td><p>10m</p></td>
</tr>
</tbody>
</table>
<p>The following optional properties allow you to configure the table import
configuration used when running queries on SEP to populate the cached table.</p>
<table id="id3">
<caption><span class="caption-text">Cache service database related configuration properties</span><a class="headerlink" href="#id3" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 32%"/>
<col style="width: 63%"/>
<col style="width: 5%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">unpartitioned.writer-count</span></code></p></td>
<td><p>Number of writers per task when writing unpartitioned table</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">unpartitioned.scale-writers</span></code></p></td>
<td><p>Scale writers when writing unpartitioned table</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">unpartitioned.writer-min-size</span></code></p></td>
<td><p>Target minimum size of writer output when writing unpartitioned table
with writers scaling</p></td>
<td><p>32MB</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">partitioned.use-preferred-write-partitioning</span></code></p></td>
<td><p>Use table partitioning to parallelize writes between worker nodes when
writing to a partitioned table. This reduces import memory usage and
improves cached table file sizes.</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">partitioned.preferred-write-partitioning-min-number-of-partitions</span></code></p></td>
<td><p>The minimum number of written partitions that is required to use connector
<code class="docutils literal notranslate"><span class="pre">preferred</span> <span class="pre">write</span> <span class="pre">partitioning</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">partitioned.writer-count</span></code></p></td>
<td><p>Number of writers per task when writing partitioned table</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">partitioned.scale-writers</span></code></p></td>
<td><p>Scale writers when writing partitioned table</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">partitioned.writer-min-size</span></code></p></td>
<td><p>Target minimum size of writer output when writing partitioned table with
writers scaling</p></td>
<td><p>32MB</p></td>
</tr>
</tbody>
</table>


<h3 id="tls-and-authentication">TLS and authentication<a class="headerlink" href="#tls-and-authentication" title="Permalink to this headline">#</a></h3>
<p>File based password authentication can be configured for the cache service
by adding the following properties:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>http-server.https.enabled=true
http-server.authentication.type=password
http-server.https.keystore.path=etc/auth/localhost.keystore
http-server.https.keystore.key=changeit
file.password-file=etc/auth/password.db
</pre></div>
</div>
<table id="id4">
<caption><span class="caption-text">HTTP and authentication properties</span><a class="headerlink" href="#id4" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 32%"/>
<col style="width: 63%"/>
<col style="width: 5%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.http.port</span></code></p></td>
<td><p>HTTP port for the cache service</p></td>
<td><p>8180</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.port</span></code></p></td>
<td><p>HTTPS port of the cache service</p></td>
<td><p>8543</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.enabled</span></code></p></td>
<td><p>Flag to activate HTTPS/TLS</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.authentication.type</span></code></p></td>
<td><p>Authentication type used for the cache service, use <code class="docutils literal notranslate"><span class="pre">password</span></code> for
password file based authentication</p></td>
<td><p>none</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.keystore.path</span></code></p></td>
<td><p>Path to the JKS keystore file used for TLS</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.keystore.key</span></code></p></td>
<td><p>Name of the key in the JKS keystore used for TLS</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">file.password-file</span></code></p></td>
<td><p>Path to the password file used with the <a class="reference internal" href="../security/password-file.html"><span class="doc">file authentication type</span></a></p></td>
<td></td>
</tr>
</tbody>
</table>


<span id="cache-service-log-properties"></span><h3 id="log-levels">Log Levels<a class="headerlink" href="#log-levels" title="Permalink to this headline">#</a></h3>
<p>The optional log levels file, <code class="docutils literal notranslate"><span class="pre">etc/log.properties</span></code>, allows setting the
minimum log level for named logger hierarchies. Every logger has a name,
which is typically the fully qualified name of the class that uses the logger.
Loggers have a hierarchy based on the dots in the name, like Java packages.
For example, consider the following log levels file:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>com.starburstdata.presto.cache=INFO
</pre></div>
</div>
<p>This sets the minimum level to <code class="docutils literal notranslate"><span class="pre">INFO</span></code> for both
<code class="docutils literal notranslate"><span class="pre">com.starburstdata.presto.cache.db</span></code> and
<code class="docutils literal notranslate"><span class="pre">com.starburstdata.presto.cache.rules</span></code>. The default minimum level is <code class="docutils literal notranslate"><span class="pre">INFO</span></code>,
thus the above example does not actually change anything. There are four levels:
<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>, <code class="docutils literal notranslate"><span class="pre">INFO</span></code>, <code class="docutils literal notranslate"><span class="pre">WARN</span></code> and <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>.</p>



<span id="cache-service-refresh-rules"></span><h2 id="cache-refresh-rules">Cache refresh rules<a class="headerlink" href="#cache-refresh-rules" title="Permalink to this headline">#</a></h2>
<p>A JSON file, <code class="docutils literal notranslate"><span class="pre">rules.json</span></code>, is used to define rules for which tables are cached
by the service, the target catalog, and the schedule for refreshing them. The
following is a sample showing the supported ways of configuring redirections.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"defaultGracePeriod"</span><span class="p">:</span> <span class="s2">"42m"</span><span class="p">,</span>
  <span class="nt">"defaultMaxImportDuration"</span><span class="p">:</span> <span class="s2">"1m"</span><span class="p">,</span>
  <span class="nt">"defaultCacheCatalog"</span><span class="p">:</span> <span class="s2">"default_cache_catalog"</span><span class="p">,</span>
  <span class="nt">"defaultCacheSchema"</span><span class="p">:</span> <span class="s2">"default_cache_schema"</span><span class="p">,</span>
  <span class="nt">"defaultUnpartitionedImportConfig"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"usePreferredWritePartitioning"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">"preferredWritePartitioningMinNumberOfPartitions"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">"writerCount"</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
    <span class="nt">"scaleWriters"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">"writerMinSize"</span><span class="p">:</span> <span class="s2">"110MB"</span>
  <span class="p">},</span>
  <span class="nt">"defaultPartitionedImportConfig"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"usePreferredWritePartitioning"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">"preferredWritePartitioningMinNumberOfPartitions"</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
    <span class="nt">"writerCount"</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="nt">"scaleWriters"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">"writerMinSize"</span><span class="p">:</span> <span class="s2">"52MB"</span>
  <span class="p">},</span>
  <span class="nt">"rules"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"catalogName"</span><span class="p">:</span> <span class="s2">"test_catalog"</span><span class="p">,</span>
      <span class="nt">"schemaNameLike"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span>
      <span class="nt">"tableNameLike"</span><span class="p">:</span> <span class="s2">"bar"</span><span class="p">,</span>
      <span class="nt">"refreshInterval"</span><span class="p">:</span> <span class="s2">"10m"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"catalogName"</span><span class="p">:</span> <span class="s2">"test_catalog"</span><span class="p">,</span>
      <span class="nt">"schemaNameLike"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span>
      <span class="nt">"tableNameLike"</span><span class="p">:</span> <span class="s2">"bar"</span><span class="p">,</span>
      <span class="nt">"cronExpression"</span><span class="p">:</span> <span class="s2">"* * * 2 *"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"catalogName"</span><span class="p">:</span> <span class="s2">"some_catalog"</span><span class="p">,</span>
      <span class="nt">"schemaName"</span><span class="p">:</span> <span class="s2">"xyz"</span><span class="p">,</span>
      <span class="nt">"tableName"</span><span class="p">:</span> <span class="s2">"ijk"</span><span class="p">,</span>
      <span class="nt">"columns"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"column1"</span><span class="p">,</span>
        <span class="s2">"column2"</span><span class="p">,</span>
        <span class="s2">"column3"</span>
      <span class="p">],</span>
      <span class="nt">"partitionColumns"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"column1"</span>
      <span class="p">],</span>
      <span class="nt">"bucketColumns"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"column2"</span>
      <span class="p">],</span>
      <span class="nt">"bucketCount"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="nt">"sortColumns"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"column3"</span>
      <span class="p">],</span>
      <span class="nt">"refreshInterval"</span><span class="p">:</span> <span class="s2">"123h"</span><span class="p">,</span>
      <span class="nt">"gracePeriod"</span><span class="p">:</span> <span class="s2">"80m"</span><span class="p">,</span>
      <span class="nt">"maxImportDuration"</span><span class="p">:</span> <span class="s2">"67h"</span><span class="p">,</span>
      <span class="nt">"cacheCatalog"</span><span class="p">:</span> <span class="s2">"table_catalog"</span><span class="p">,</span>
      <span class="nt">"cacheSchema"</span><span class="p">:</span> <span class="s2">"table_schema"</span><span class="p">,</span>
      <span class="nt">"importConfig"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"usePreferredWritePartitioning"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">"preferredWritePartitioningMinNumberOfPartitions"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nt">"writerCount"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="nt">"scaleWriters"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">"writerMinSize"</span><span class="p">:</span> <span class="s2">"100MB"</span>
      <span class="p">},</span>
      <span class="nt">"incrementalImportConfig"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"usePreferredWritePartitioning"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">"preferredWritePartitioningMinNumberOfPartitions"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">"writerCount"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nt">"scaleWriters"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">"writerMinSize"</span><span class="p">:</span> <span class="s2">"100MB"</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"catalogName"</span><span class="p">:</span> <span class="s2">"mysql"</span><span class="p">,</span>
      <span class="nt">"schemaName"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span>
      <span class="nt">"tableName"</span><span class="p">:</span> <span class="s2">"events"</span><span class="p">,</span>
      <span class="nt">"refreshInterval"</span><span class="p">:</span> <span class="s2">"2m"</span><span class="p">,</span>
      <span class="nt">"gracePeriod"</span><span class="p">:</span> <span class="s2">"15m"</span><span class="p">,</span>
      <span class="nt">"incrementalColumn"</span><span class="p">:</span> <span class="s2">"event_id"</span><span class="p">,</span>
      <span class="nt">"deletePredicate"</span><span class="p">:</span> <span class="s2">"event_date &lt; date_add('day', -31, CURRENT_DATE)"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"catalogName"</span><span class="p">:</span> <span class="s2">"postgresql"</span><span class="p">,</span>
      <span class="nt">"schemaName"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span>
      <span class="nt">"tableName"</span><span class="p">:</span> <span class="s2">"events"</span><span class="p">,</span>
      <span class="nt">"refreshInterval"</span><span class="p">:</span> <span class="s2">"2m"</span><span class="p">,</span>
      <span class="nt">"gracePeriod"</span><span class="p">:</span> <span class="s2">"15m"</span><span class="p">,</span>
      <span class="nt">"incrementalColumn"</span><span class="p">:</span> <span class="s2">"event_hour"</span><span class="p">,</span>
      <span class="nt">"predicate"</span><span class="p">:</span> <span class="s2">"event_hour &lt; (SELECT date_add('hour', -1, latest_event_hour) FROM (SELECT max(event_hour) AS latest_event_hour FROM postgresql.foo.events))"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each rule in the <code class="docutils literal notranslate"><span class="pre">rules</span></code> array defines what is cached, where the cached table
is located and a schedule for automated refresh. The source catalog is defined
within each rule using <code class="docutils literal notranslate"><span class="pre">catalogName</span></code>. A specific source table can be defined
by explicitly providing <code class="docutils literal notranslate"><span class="pre">schemaName</span></code> and <code class="docutils literal notranslate"><span class="pre">tableName</span></code>.
<code class="docutils literal notranslate"><span class="pre">tableName</span></code> can point at either table or view. One rule can match
multiple source tables using <code class="docutils literal notranslate"><span class="pre">schemaNameLike</span></code> and <code class="docutils literal notranslate"><span class="pre">tableNameLike</span></code> patterns.
A rule must either specify <code class="docutils literal notranslate"><span class="pre">schemaName</span></code> and <code class="docutils literal notranslate"><span class="pre">tableName</span></code> or
<code class="docutils literal notranslate"><span class="pre">schemaNameLike</span></code> and <code class="docutils literal notranslate"><span class="pre">tableNameLike</span></code>.</p>
<p>For each rule, the frequency of refreshing cached table can be defined either by
specifying a time duration in <code class="docutils literal notranslate"><span class="pre">refreshInterval</span></code>, or by a cron expression in
<code class="docutils literal notranslate"><span class="pre">cronExpression</span></code>.</p>
<p>By default, each refresh of a cached table results in all the rows from the
specified columns of the source table getting bulk loaded into the cached table.
When the source table is large and requires frequent refreshes, the rule can be
configured to load data from the source table incrementally.</p>
<p>For incrementally refreshed cached tables, an <code class="docutils literal notranslate"><span class="pre">incrementalColumn</span></code> must be
specified. This column is used by the service to apply a <code class="docutils literal notranslate"><span class="pre">incrementalColumn</span> <span class="pre">&gt;</span>
<span class="pre">(SELECT</span> <span class="pre">max(incrementalColumn)</span> <span class="pre">FROM</span> <span class="pre">cachedTable)</span></code> filter when loading data
incrementally from the source table. This facilitates loading only newer data
from the source table instead of the entire table in each refresh iteration.</p>
<p>Depending on the properties of the source table, incremental refresh can be
setup in one of two ways shown in the example <code class="docutils literal notranslate"><span class="pre">rules.json</span></code> above:</p>
<ol class="arabic simple">
<li><p>Use a strictly incrementing column from the source table to detect new rows.
The service depends on the property of strictly increasing values to
copy only the rows from source table where the value of <code class="docutils literal notranslate"><span class="pre">incrementalColumn</span></code>
is greater than the values already present in the cached table.
Modifications or deletions of existing rows are ignored.</p></li>
<li><p>Use a monotonically incrementing column from the source table in combination
with a configured <code class="docutils literal notranslate"><span class="pre">predicate</span></code>. Fact tables often contain time/date based
columns which have the property of monotonically increasing, but not strictly
increasing values. The <code class="docutils literal notranslate"><span class="pre">predicate</span></code> field can be used to specify a filter
condition that delays loading the latest data which could still be modified
(e.g. new rows added or existing rows changed) in the source table. This
filter is applied in addition to the filter applied on <code class="docutils literal notranslate"><span class="pre">incrementalColumn</span></code>
by the service to avoid loading the same data again.</p></li>
</ol>
<p>The initial refresh for an incrementally cached table is a bulk load.
Modification of <code class="docutils literal notranslate"><span class="pre">columns</span></code>, <code class="docutils literal notranslate"><span class="pre">partitionColumns</span></code>, <code class="docutils literal notranslate"><span class="pre">bucketColumns</span></code>,
<code class="docutils literal notranslate"><span class="pre">bucketCount</span></code>, <code class="docutils literal notranslate"><span class="pre">sortColumns</span></code>, <code class="docutils literal notranslate"><span class="pre">incrementalColumn</span></code>, <code class="docutils literal notranslate"><span class="pre">predicate</span></code>
or <code class="docutils literal notranslate"><span class="pre">deletePredicate</span></code> field results in the creation of a new cached table
which is re-populated from the source table from scratch.</p>
<p>For bulk loaded cached tables, ttl is the time until the table expires. The
service removes cached tables when they are no longer needed, such as when a
newer redirection is present or ttl expired. The service waits for the
<code class="docutils literal notranslate"><span class="pre">grace-period</span></code> before removing the cached table. This allows any running
queries, which started just before the cached table is expired, to finish
gracefully. The ttl is computed so that the service performs a complete source
table import before the current cached table expires.</p>
<p>For incrementally cached tables, the cached table is not removed until the
corresponding redirection rule is removed or modified in <code class="docutils literal notranslate"><span class="pre">rules.json</span></code>. If the
cached table can not be successfully refreshed according to the specified
refresh frequency, it is not used for table scan redirection so that queries on
stale data are avoided.</p>
<p>The redirection rule for an incrementally cached table can also optionally
specify a <code class="docutils literal notranslate"><span class="pre">deletePredicate</span></code> to clean up old data from the cached table. The
<code class="docutils literal notranslate"><span class="pre">deletePredicate</span></code> is used to run a <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span> <span class="pre">cachedTable</span> <span class="pre">WHERE</span>
<span class="pre">&lt;deletePredicate&gt;</span></code> query at every <code class="docutils literal notranslate"><span class="pre">cleanup-interval</span></code>. The connector used to
store the cached table must support the <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span></code> statement configured
through <code class="docutils literal notranslate"><span class="pre">deletePredicate</span></code>.</p>
<p>The grace period can be specified for all cached tables using
<code class="docutils literal notranslate"><span class="pre">defaultGracePeriod</span></code>, and overridden within each rule using <code class="docutils literal notranslate"><span class="pre">gracePeriod</span></code>.</p>
<p>The target catalog for all cached tables can be defined using
<code class="docutils literal notranslate"><span class="pre">defaultCacheCatalog</span></code>, each rule can override it using <code class="docutils literal notranslate"><span class="pre">cacheCatalog</span></code>.</p>
<p>The target schema for all cached tables can be defined using
<code class="docutils literal notranslate"><span class="pre">defaultCacheSchema</span></code>, each rule can override it using <code class="docutils literal notranslate"><span class="pre">cacheSchema</span></code>.</p>
<p>Max import duration is the maximum allowed execution time for a query used to
populate the cached table. It can be defined globally using
<code class="docutils literal notranslate"><span class="pre">defaultMaxImportDuration</span></code>, or for each rule using <code class="docutils literal notranslate"><span class="pre">maxImportDuration</span></code>. It
must be smaller than the refresh interval and greater than or equal to 1m.
This field is compulsory when <code class="docutils literal notranslate"><span class="pre">cronExpression</span></code> is used to define a schedule
for refresh of cached tables.</p>
<p>Each rule can optionally define partitioning for the target table by providing
a comma separated list of column names in <code class="docutils literal notranslate"><span class="pre">partitionColumns</span></code>.
Similarly, bucketing and sorting can also be defined using <code class="docutils literal notranslate"><span class="pre">bucketColumns</span></code>
and <code class="docutils literal notranslate"><span class="pre">sortColumns</span></code> respectively. <code class="docutils literal notranslate"><span class="pre">bucketCount</span></code> must be provided when
<code class="docutils literal notranslate"><span class="pre">bucketColumns</span></code> are provided. Table bucketing must be provided when
<code class="docutils literal notranslate"><span class="pre">sortColumns</span></code> are provided.</p>
<p>The default import configuration for partitioned and non-partitioned cached
tables can be specified in the <code class="docutils literal notranslate"><span class="pre">defaultUnpartitionedImportConfig</span></code> and
<code class="docutils literal notranslate"><span class="pre">defaultPartitionedImportConfig</span></code> fields. Each rule can optionally specify an
<code class="docutils literal notranslate"><span class="pre">importConfig</span></code>. It overrides the default import config when loading the cached
tables defined by the rule. The rule can also include an
<code class="docutils literal notranslate"><span class="pre">incrementalImportConfig</span></code> which applies for incremental imports.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The definition of the source table or view must remain compatible with it’s
corresponding redirection rule definition for incrementally cached tables. Any
table and columns changes need be followed with an update of the relevant
names to the caching rules. This includes rules that do not specify columns,
if any columns are added, removed or renamed in the source table. Such a
change must be followed with expiring the cache with the
<code class="docutils literal notranslate"><span class="pre">expire_redirection</span></code> command from <a class="reference internal" href="cache-service-cli.html"><span class="doc">the cache service CLI</span></a> to create a new redirection with the updated table
definition.</p>
</div>


<span id="running-cache-service"></span><h2 id="running-the-cache-service">Running the cache service<a class="headerlink" href="#running-the-cache-service" title="Permalink to this headline">#</a></h2>
<p>The installation directory contains the launcher script in <code class="docutils literal notranslate"><span class="pre">bin/launcher</span></code>. It
service can be started as a daemon by running the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bin/launcher start
</pre></div>
</div>
<p>Alternatively, it can be run in the foreground, with the logs and other output
written to stdout/stderr. Both streams should be captured if using a supervision
system like <code class="docutils literal notranslate"><span class="pre">daemontools</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bin/launcher run
</pre></div>
</div>
<p>Run the launcher with <code class="docutils literal notranslate"><span class="pre">--help</span></code> to see the supported commands and command line
options. In particular, the <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> option is very useful for debugging
the installation.</p>
<p>The launcher configures default values for the configuration directory <code class="docutils literal notranslate"><span class="pre">etc</span></code>,
configuration files, the data directory <code class="docutils literal notranslate"><span class="pre">var</span></code>, and log files in the data
directory. You can change these values to adjust your usage to any requirements,
such as using a directory outside the installation directory, specific mount
points or locations, and even using other file names.</p>
<p>After starting the cache service, you can find log files in the <code class="docutils literal notranslate"><span class="pre">log</span></code>
directory inside the data directory <code class="docutils literal notranslate"><span class="pre">var</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">launcher.log</span></code>:
This log is created by the launcher and is connected to the stdout and stderr
streams of the server. It contains a few log messages that occur while the
server logging is being initialized, and any errors or diagnostics produced by
the JVM.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">server.log</span></code>:
This is the main log file used by the service. It typically contains the
relevant information if the server fails during initialization. It is
automatically rotated and compressed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http-request.log</span></code>:
This is the HTTP request log which contains every HTTP request received by the
server. It is automatically rotated and compressed.</p></li>
</ul>


<h2 id="docker-container">Docker container<a class="headerlink" href="#docker-container" title="Permalink to this headline">#</a></h2>
<p>It is possible to run the cache service in a Docker container for initial
exploration and testing, as well as for deployments in Kubernetes.</p>
<p>The Docker image is available at <a class="reference external" href="https://hub.docker.com/r/starburstdata/starburst-cache-service">starburstdata/starburst-cache-service</a></p>

<h3 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">#</a></h3>
<p>You can run the container locally, making sure you publish port 8180 of the
service. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>docker run -p 8180:8180 -v ~/starburst-cache-service/etc:/usr/lib/starburst-cache-service/etc --network="host" --rm harbor.starburstdata.net/starburstdata/starburst-cache-service:latest
</pre></div>
</div>
<p>For administration, direct a locally installed <a class="reference internal" href="cache-service-cli.html"><span class="doc">cache service CLI</span></a> to the same port:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cache-cli current_redirection --server localhost:8180 --source=mysql.test.nation_tmp
</pre></div>
</div>



<h2 id="jmx-metrics">JMX metrics<a class="headerlink" href="#jmx-metrics" title="Permalink to this headline">#</a></h2>
<p>Metrics about table import are reported in the JMX table
<code class="docutils literal notranslate"><span class="pre">jmx.current."com.starburstdata.presto.cache:name=TableImportService"</span></code>.</p>
<p>Metrics about cached table cleanup are reported in the JMX table
<code class="docutils literal notranslate"><span class="pre">jmx.current."com.starburstdata.presto.cache:name=CleanupService"</span></code>.</p>
<p>Metrics about redirections requests on the web service resources are reported in
the JMX table
<code class="docutils literal notranslate"><span class="pre">jmx.current."com.starburstdata.presto.cache:name=RedirectionsResource"</span></code>.</p>
<p>Metrics about table import and expiration requests on the web service resource are reported in
the JMX table
<code class="docutils literal notranslate"><span class="pre">jmx.current."com.starburstdata.presto.cache:name=CacheResource"</span></code>.</p>




          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-grid md-main__inner" style="height: auto;">
  <div class="md-content">
    <div class="feedback-container md-content__inner md-typeset">
      <div class="feedback-thumbs">
        <p>Is the information on this page helpful?</p>
        <p class="feedback-option" title="yes">Yes</p>
        <p class="feedback-option" title="no">No</p>
      </div>
      <div class="feedback-message">
        <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
        <button type="button" onclick="sendMessage()" class="feedback-button">Submit</button>
        <a onclick="skip()" class="feedback-skip">Skip</a>
      </div>
    </div>
  </div>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '');
</script>
<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="graceful-shutdown.html" title="Graceful shutdown"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Graceful shutdown </span>
              </div>
            </a>
          
          
            <a href="cache-service-cli.html" title="Cache service CLI"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Cache service CLI </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
<!-- custom footer should go here in time -->
<div class="page-footer">
  <div class="container md-grid">
    <div class="row">
      <div class="col-md-3">
        <p style="font-weight:900">Resources</p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-presto-guide/" target="_blank">Free O'Reilly book - Presto: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">

        <a href="https://www.starburst.io/" target="_blank">
          
            <img src="../_static/Starburst_Logo_NoTag_White.png" height="26"
                  alt="Starburst Enterprise logo">
        
        </a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright © 2017-2021<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
  </div>
</div>
  </body>
</html>