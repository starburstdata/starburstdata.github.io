

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Fault-tolerant execution &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/algolia.css" />
    <link rel="stylesheet" type="text/css" href="../_static/starburst.css" />
    <link rel="stylesheet" type="text/css" href="../_static/search.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/main.js"></script>
    <script src="../_static/algolia.js"></script>
    <script src="../_static/searchbox.js"></script>
    <script src="../_static/searchresults.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTP event listener" href="event-listeners-http.html" />
    <link rel="prev" title="Graceful shutdown" href="graceful-shutdown.html" />

  
   

<link href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">


<!-- Always link to the latest version, as canonical -->
<link rel="canonical" href="https://docs.starburst.io/latest/admin/fault-tolerant-execution.html">

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#admin/fault-tolerant-execution" tabindex="1" class="md-skip"> Skip to content </a>
  
<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://www.starburst.io" title="Starburst Enterprise"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/starburst_KO-T.png"
                   alt="Starburst Enterprise 393-e.4 LTS logo">
          
        </a>
      </div>
      <span class="header-divider"></span>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <a href="/starburst-enterprise/index.html"
          class="md-header-nav__topic">
          Documentation: Starburst Enterprise 393-e.4 LTS</a>
          <span class="md-header-nav__topic"> Fault-tolerant execution </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        <div id="algolia-search">
  <div id="searchbox"></div>
  <div id="refinement-list">
    <h6 class="filter-label">Filter:</h6>
  </div>
  <div id="hits"></div>
  <div id="stats"></div>
</div>
      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (393-e)" href="/393-e/">Latest LTS (393-e)</a>
      
          <a title="380-e LTS" href="/380-e/">380-e LTS</a>
      
          <a title="370-e LTS" href="/370-e/">370-e LTS</a>
      
          <a title="364-e LTS" href="/364-e/">364-e LTS</a>
      
          <a title="Latest STS (399-e)" href="/399-e/">Latest STS (399-e)</a>
      
          <a title="398-e STS" href="/398-e/">398-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>


  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/get-started/index.html" class="md-tabs__link">Get started</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-galaxy/index.html" class="md-tabs__link">Starburst Galaxy</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-enterprise/index.html" class="md-tabs__link">Starburst Enterprise</a></li>
            
            <li class="md-tabs__item"><a href="/ecosystems/index.html" class="md-tabs__link">Ecosystems</a></li>
            
            <li class="md-tabs__item"><a href="/resources.html" class="md-tabs__link">Resources</a></li>
          <li class="md-tabs__item"><a href="../admin.html" class="md-tabs__link">Administration</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../_static/starburst_KO-T.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Starburst Enterprise">Starburst Enterprise 393-e.4 LTS</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Manual installation and license</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../k8s.html" class="md-nav__link">Deploying with Kubernetes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../aws.html" class="md-nav__link">Deploying with CFT on AWS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="web-interface.html" class="md-nav__link">Trino web UI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tuning.html" class="md-nav__link">Tuning Starburst Enterprise</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jmx.html" class="md-nav__link">Monitoring with JMX</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="properties.html" class="md-nav__link">Properties reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="spill.html" class="md-nav__link">Spill to disk</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="resource-groups.html" class="md-nav__link">Resource groups</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="session-property-managers.html" class="md-nav__link">Session property managers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dist-sort.html" class="md-nav__link">Distributed sort</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dynamic-filtering.html" class="md-nav__link">Dynamic filtering</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="graceful-shutdown.html" class="md-nav__link">Graceful shutdown</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Fault-tolerant execution </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Fault-tolerant execution</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-fault-tolerant-execution--page-root" class="md-nav__link">Fault-tolerant execution</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a>
        </li>
        <li class="md-nav__item"><a href="#retry-policy" class="md-nav__link">Retry policy</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#query" class="md-nav__link">QUERY</a>
        </li>
        <li class="md-nav__item"><a href="#task" class="md-nav__link">TASK</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#advanced-configuration" class="md-nav__link">Advanced configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#retry-limits" class="md-nav__link">Retry limits</a>
        </li>
        <li class="md-nav__item"><a href="#task-sizing" class="md-nav__link">Task sizing</a>
        </li>
        <li class="md-nav__item"><a href="#node-allocation" class="md-nav__link">Node allocation</a>
        </li>
        <li class="md-nav__item"><a href="#other-tuning" class="md-nav__link">Other tuning</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#exchange-manager" class="md-nav__link">Exchange manager</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id1" class="md-nav__link">Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#aws-s3" class="md-nav__link">AWS S3</a>
        </li>
        <li class="md-nav__item"><a href="#azure-blob-storage" class="md-nav__link">Azure Blob Storage</a>
        </li>
        <li class="md-nav__item"><a href="#google-cloud-storage" class="md-nav__link">Google Cloud Storage</a>
        </li>
        <li class="md-nav__item"><a href="#local-filesystem-storage" class="md-nav__link">Local filesystem storage</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="event-listeners-http.html" class="md-nav__link">HTTP event listener</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="query-logger.html" class="md-nav__link">Query logger</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="telemetry.html" class="md-nav__link">Telemetry</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-cached-views.html" class="md-nav__link">Starburst Cached Views</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="table-scan-redirection.html" class="md-nav__link">Table scan redirection</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cache-service.html" class="md-nav__link">Cache service</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cache-service-cli.html" class="md-nav__link">Cache service CLI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="atlas-integration.html" class="md-nav__link">Atlas integration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="atlas-plugin.html" class="md-nav__link">Starburst Atlas plugin</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="atlas-cli.html" class="md-nav__link">Atlas CLI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="atlas-ranger.html" class="md-nav__link">Ranger Tagsync and Atlas</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../data-products.html" class="md-nav__link">Data products</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../insights.html" class="md-nav__link">Insights</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../appendix.html" class="md-nav__link">Appendix</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../versions.html" class="md-nav__link">393-e.4 LTS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../404.html" class="md-nav__link">&nbsp;</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-fault-tolerant-execution--page-root" class="md-nav__link">Fault-tolerant execution</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a>
        </li>
        <li class="md-nav__item"><a href="#retry-policy" class="md-nav__link">Retry policy</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#query" class="md-nav__link">QUERY</a>
        </li>
        <li class="md-nav__item"><a href="#task" class="md-nav__link">TASK</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#advanced-configuration" class="md-nav__link">Advanced configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#retry-limits" class="md-nav__link">Retry limits</a>
        </li>
        <li class="md-nav__item"><a href="#task-sizing" class="md-nav__link">Task sizing</a>
        </li>
        <li class="md-nav__item"><a href="#node-allocation" class="md-nav__link">Node allocation</a>
        </li>
        <li class="md-nav__item"><a href="#other-tuning" class="md-nav__link">Other tuning</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#exchange-manager" class="md-nav__link">Exchange manager</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id1" class="md-nav__link">Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#aws-s3" class="md-nav__link">AWS S3</a>
        </li>
        <li class="md-nav__item"><a href="#azure-blob-storage" class="md-nav__link">Azure Blob Storage</a>
        </li>
        <li class="md-nav__item"><a href="#google-cloud-storage" class="md-nav__link">Google Cloud Storage</a>
        </li>
        <li class="md-nav__item"><a href="#local-filesystem-storage" class="md-nav__link">Local filesystem storage</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="admin-fault-tolerant-execution--page-root">Fault-tolerant execution<a class="headerlink" href="#admin-fault-tolerant-execution--page-root" title="Permalink to this headline">#</a></h1>
<p>By default, if a Trino node lacks the resources to execute a task or
otherwise fails during query execution, the query fails and must be run again
manually. The longer the runtime of a query, the more likely it is to be
susceptible to such failures.</p>
<p>Fault-tolerant execution is a mechanism in Trino that enables a cluster to
mitigate query failures by retrying queries or their component tasks in
the event of failure. With fault-tolerant execution enabled, intermediate
exchange data is spooled and can be re-used by another worker in the event of a
worker outage or other fault during query execution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fault tolerance does not apply to broken queries or other user error. For
example, Trino does not spend resources retrying a query that fails because
its SQL cannot be parsed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fault-tolerant execution is a <a class="reference internal" href="../versions.html#feature-release-status"><span class="std std-ref">public preview</span></a> in Starburst Enterprise. Contact <a class="reference external" href="../../support.html">Starburst Support</a> with questions or feedback.</p>
</div>

<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">#</a></h2>
<p>Fault-tolerant execution is disabled by default. To enable the feature, set the
<code class="docutils literal notranslate"><span class="pre">retry-policy</span></code> configuration property to either <code class="docutils literal notranslate"><span class="pre">QUERY</span></code> or <code class="docutils literal notranslate"><span class="pre">TASK</span></code>
depending on the desired <a class="reference internal" href="#fte-retry-policy"><span class="std std-ref">retry policy</span></a>.</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">retry-policy</span><span class="o">=</span><span class="s">QUERY</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">retry-policy</span></code> disables <a class="reference internal" href="../language/sql-support.html#sql-write-operations"><span class="std std-ref">write operations</span></a> with connectors that do not support fault-tolerant
execution of write operations, resulting in a “This connector does not support
query retries” error message.</p>
<p>Support for fault-tolerant execution of SQL statements varies on a
per-connector basis:</p>
<ul class="simple">
<li><p>Fault-tolerant execution of <a class="reference internal" href="../language/sql-support.html#sql-read-operations"><span class="std std-ref">read operations</span></a> is
supported by all connectors.</p></li>
<li><p>Fault tolerant execution of <a class="reference internal" href="../language/sql-support.html#sql-write-operations"><span class="std std-ref">write operations</span></a>
is only supported by the <a class="reference internal" href="../connector/delta-lake.html"><span class="doc">Delta Lake connector</span></a>,
<a class="reference internal" href="../connector/hive.html"><span class="doc">Hive connector</span></a>, and <a class="reference internal" href="../connector/iceberg.html"><span class="doc">Iceberg connector</span></a>.</p></li>
</ul>
</div>
<p>The following configuration properties control the behavior of fault-tolerant
execution on a Trino cluster:</p>
<table id="id2">
<caption><span class="caption-text">Fault-tolerant execution configuration properties</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 50%"/>
<col style="width: 20%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">retry-policy</span></code></p></td>
<td><p>Configures what is retried in the event of failure, either
<code class="docutils literal notranslate"><span class="pre">QUERY</span></code> to retry the whole query, or <code class="docutils literal notranslate"><span class="pre">TASK</span></code> to retry tasks
individually if they fail. See <a class="reference internal" href="#fte-retry-policy"><span class="std std-ref">retry policy</span></a> for
more information.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.deduplication-buffer-size</span></code></p></td>
<td><p>Size of the coordinator’s in-memory buffer used by fault-tolerant
execution to store output of query <a class="reference internal" href="../overview/concepts.html#trino-concept-stage"><span class="std std-ref">stages</span></a>.
If this buffer is filled during query execution, the query fails with a
“Task descriptor storage capacity has been exceeded” error message unless
an <a class="reference internal" href="#fte-exchange-manager"><span class="std std-ref">exchange manager</span></a> is configured.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">32MB</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.compression-enabled</span></code></p></td>
<td><p>Enable compression of spooling data. Setting to <code class="docutils literal notranslate"><span class="pre">true</span></code> is recommended
when using an <a class="reference internal" href="#fte-exchange-manager"><span class="std std-ref">exchange manager</span></a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
</tbody>
</table>


<span id="fte-retry-policy"></span><h2 id="retry-policy">Retry policy<a class="headerlink" href="#retry-policy" title="Permalink to this headline">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">retry-policy</span></code> configuration property designates whether Trino retries
entire queries or a query’s individual tasks in the event of failure.</p>

<h3 id="query">QUERY<a class="headerlink" href="#query" title="Permalink to this headline">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">QUERY</span></code> retry policy instructs Trino to automatically retry a query in the
event of an error occuring on a worker node. A <code class="docutils literal notranslate"><span class="pre">QUERY</span></code> retry policy is
recommended when the majority of the Trino cluster’s workload consists of many
small queries, or if an <a class="reference internal" href="#fte-exchange-manager"><span class="std std-ref">exchange manager</span></a> is not
configured.</p>
<p>By default Trino does not implement fault tolerance for queries whose result set
exceeds 32MB in size, such as <a class="reference internal" href="../sql/select.html"><span class="doc">SELECT</span></a> statements that return a very
large data set to the user. This limit can be increased by modifying the
<code class="docutils literal notranslate"><span class="pre">exchange.deduplication-buffer-size</span></code> configuration property to be greater than
the default value of <code class="docutils literal notranslate"><span class="pre">32MB</span></code>, but this results in higher memory usage on the
coordinator.</p>
<p>To enable fault-tolerant execution on queries with a larger result set, it is
strongly recommended to configure an <a class="reference internal" href="#fte-exchange-manager"><span class="std std-ref">exchange manager</span></a> that utilizes external storage for spooled data and
therefore allows for storage of spilled data beyond the in-memory buffer size.</p>


<h3 id="task">TASK<a class="headerlink" href="#task" title="Permalink to this headline">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy instructs Trino to retry individual query
<a class="reference internal" href="../overview/concepts.html#trino-concept-task"><span class="std std-ref">tasks</span></a> in the event of failure. This policy is
recommended when executing large batch queries, as the cluster can more
efficiently retry smaller tasks within the query rather than retry the whole
query.</p>
<p>The following cluster configuration changes are recommended to improve
fault-tolerant execution with a <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy:</p>
<ul class="simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">task.low-memory-killer.policy</span></code>
<a class="reference internal" href="properties-query-management.html"><span class="doc">query management property</span></a> to
<code class="docutils literal notranslate"><span class="pre">total-reservation-on-blocked-nodes</span></code>, or queries may
need to be manually killed if the cluster runs out of memory.</p></li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">query.low-memory-killer.delay</span></code>
<a class="reference internal" href="properties-query-management.html"><span class="doc">query management property</span></a> to
<code class="docutils literal notranslate"><span class="pre">0s</span></code> so the cluster immediately unblocks nodes that run out of memory.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">query.remote-task.max-error-duration</span></code>
<a class="reference internal" href="properties-query-management.html"><span class="doc">query management property</span></a>
to adjust how long Trino allows a remote task to try reconnecting before
considering it lost and rescheduling.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy is best suited for large batch queries, but this
policy can result in higher latency for short-running queries executed in high
volume. As a best practice, it is recommended to run a dedicated cluster
with a <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy for large batch queries, separate from another
cluster that handles short queries.</p>
</div>



<h2 id="advanced-configuration">Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this headline">#</a></h2>
<p>You can further configure fault-tolerant execution with the following
configuration properties. The default values for these properties should work
for most deployments, but you can change these values for testing or
troubleshooting purposes.</p>

<h3 id="retry-limits">Retry limits<a class="headerlink" href="#retry-limits" title="Permalink to this headline">#</a></h3>
<p>The following configuration properties control the thresholds at which
queries/tasks are no longer retried in the event of repeated failures:</p>
<table id="id3">
<caption><span class="caption-text">Fault tolerance retry limit configuration properties</span><a class="headerlink" href="#id3" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 23%"/>
<col style="width: 38%"/>
<col style="width: 15%"/>
<col style="width: 23%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Retry policy</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">query-retry-attempts</span></code></p></td>
<td><p>Maximum number of times Trino may attempt to retry a query before
declaring the query as failed.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">QUERY</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">task-retry-attempts-overall</span></code></p></td>
<td><p>Maximum number retries across all tasks within a given query
before declaring the query as failed.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">null</span></code> (no limit)</p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">task-retry-attempts-per-task</span></code></p></td>
<td><p>Maximum number of times Trino may attempt to retry a single task before
declaring the query as failed.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">retry-initial-delay</span></code></p></td>
<td><p>Minimum time that a failed query or task must wait before it is retried. May be
overridden with the <code class="docutils literal notranslate"><span class="pre">retry_initial_delay</span></code> <a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10s</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">QUERY</span></code> and <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">retry-max-delay</span></code></p></td>
<td><p>Maximum time that a failed query or task must wait before it is retried.
Wait time is increased on each subsequent  failure. May be
overridden with the <code class="docutils literal notranslate"><span class="pre">retry_max_delay</span></code> <a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1m</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">QUERY</span></code> and <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">retry-delay-scale-factor</span></code></p></td>
<td><p>Factor by which retry delay is increased on each query or task failure. May be
overridden with the <code class="docutils literal notranslate"><span class="pre">retry_delay_scale_factor</span></code> <a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2.0</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">QUERY</span></code> and <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
</tbody>
</table>


<h3 id="task-sizing">Task sizing<a class="headerlink" href="#task-sizing" title="Permalink to this headline">#</a></h3>
<p>With a <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy, it is important to manage the amount of data
processed in each task. If tasks are too small, the management of task
coordination can take more processing time and resources than executing the task
itself. If tasks are too large, then a single task may require more resources
than are available on any one node and therefore prevent the query from
completing.</p>
<p>Trino supports limited automatic task sizing. If issues are occurring
during fault-tolerant task execution, you can configure the following
configuration properties to manually control task sizing. These configuration
properties only apply to a <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy.</p>
<table id="id4">
<caption><span class="caption-text">Task sizing configuration properties</span><a class="headerlink" href="#id4" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 50%"/>
<col style="width: 20%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-target-task-input-size</span></code></p></td>
<td><p>Target size in bytes of all task inputs for a single fault-tolerant task.
Applies to tasks that read input from spooled data written by other
tasks.</p>
<p>May be overridden for the current session with the
<code class="docutils literal notranslate"><span class="pre">fault_tolerant_execution_target_task_input_size</span></code>
<a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">4GB</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-target-task-split-count</span></code></p></td>
<td><p>Target number of standard <a class="reference internal" href="../overview/concepts.html#trino-concept-splits"><span class="std std-ref">splits</span></a> processed
by a single task that reads data from source tables. Value is interpreted
with split weight taken into account. If the weight of splits produced by
a catalog denotes that they are lighter or heavier than “standard” split,
then the number of splits processed by single task is adjusted
accordingly.</p>
<p>May be overridden for the current session with the
<code class="docutils literal notranslate"><span class="pre">fault_tolerant_execution_target_task_split_count</span></code>
<a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">64</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-min-task-split-count</span></code></p></td>
<td><p>Minimum number of <a class="reference internal" href="../overview/concepts.html#trino-concept-splits"><span class="std std-ref">splits</span></a> processed by
a single task. This value is not split weight-adjusted and serves as
protection against situations where catalogs report an incorrect split
weight.</p>
<p>May be overridden for the current session with the
<code class="docutils literal notranslate"><span class="pre">fault_tolerant_execution_min_task_split_count</span></code>
<a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">16</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-max-task-split-count</span></code></p></td>
<td><p>Maximum number of <a class="reference internal" href="../overview/concepts.html#trino-concept-splits"><span class="std std-ref">splits</span></a> processed by a
single task. This value is not split weight-adjusted and serves as
protection against situations where catalogs report an incorrect split
weight.</p>
<p>May be overridden for the current session with the
<code class="docutils literal notranslate"><span class="pre">fault_tolerant_execution_max_task_split_count</span></code>
<a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">256</span></code></p></td>
</tr>
</tbody>
</table>


<h3 id="node-allocation">Node allocation<a class="headerlink" href="#node-allocation" title="Permalink to this headline">#</a></h3>
<p>With a <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy, nodes are allocated to tasks based on available
memory and estimated memory usage. If task failure occurs due to exceeding
available memory on a node, the task is restarted with a request to allocate the
full node for its execution.</p>
<p>The initial task memory-requirements estimation is static and configured with
the <code class="docutils literal notranslate"><span class="pre">fault-tolerant-task-memory</span></code> configuration property. This property only
applies to a <code class="docutils literal notranslate"><span class="pre">TASK</span></code> retry policy.</p>
<table id="id5">
<caption><span class="caption-text">Node allocation configuration properties</span><a class="headerlink" href="#id5" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 50%"/>
<col style="width: 20%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-task-memory</span></code></p></td>
<td><p>Initial task memory estimation used for bin-packing when allocating nodes
for tasks. May be overridden for the current session with the
<code class="docutils literal notranslate"><span class="pre">fault_tolerant_execution_task_memory</span></code>
<a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">5GB</span></code></p></td>
</tr>
</tbody>
</table>


<h3 id="other-tuning">Other tuning<a class="headerlink" href="#other-tuning" title="Permalink to this headline">#</a></h3>
<p>The following additional configuration property can be used to manage
fault-tolerant execution:</p>
<table id="id6">
<caption><span class="caption-text">Other fault-tolerant execution configuration properties</span><a class="headerlink" href="#id6" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 23%"/>
<col style="width: 38%"/>
<col style="width: 15%"/>
<col style="width: 23%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Retry policy</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-task-descriptor-storage-max-memory</span></code></p></td>
<td><p>Maximum amount of memory to be used to store task descriptors for fault
tolerant queries on coordinator. Extra memory is needed to be able to
reschedule tasks in case of a failure.</p></td>
<td><p>(JVM heap size * 0.15)</p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">fault-tolerant-execution-partition-count</span></code></p></td>
<td><p>Number of partitions to use for distributed joins and aggregations,
similar in function to the <code class="docutils literal notranslate"><span class="pre">query.hash-partition-count</span></code> <a class="reference internal" href="properties-query-management.html"><span class="doc">query
management property</span></a>. It is not
recommended to increase this property value above the default of <code class="docutils literal notranslate"><span class="pre">50</span></code>,
which may result in instability and poor performance. May be overridden
for the current session with the
<code class="docutils literal notranslate"><span class="pre">fault_tolerant_execution_partition_count</span></code> <a class="reference internal" href="../sql/set-session.html#session-properties-definition"><span class="std std-ref">session property</span></a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">50</span></code></p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max-tasks-waiting-for-node-per-stage</span></code></p></td>
<td><p>Allow for up to configured number of tasks to wait for node allocation
per stage, before pausing scheduling for other tasks from this stage.</p></td>
<td><p>5</p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">TASK</span></code></p></td>
</tr>
</tbody>
</table>



<span id="fte-exchange-manager"></span><h2 id="exchange-manager">Exchange manager<a class="headerlink" href="#exchange-manager" title="Permalink to this headline">#</a></h2>
<p>Exchange spooling is responsible for storing and managing spooled data for
fault-tolerant execution. You can configure a filesystem-based exchange manager
that stores spooled data in a specified location, such as an S3-compatible
storage system, Google Cloud Storage (GCS), or a local filesystem.</p>

<h3 id="id1">Configuration<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>To configure an exchange manager, create a new
<code class="docutils literal notranslate"><span class="pre">etc/exchange-manager.properties</span></code> configuration file on the coordinator and
all worker nodes. In this file, set the <code class="docutils literal notranslate"><span class="pre">exchange-manager.name</span></code> configuration
propertry to <code class="docutils literal notranslate"><span class="pre">filesystem</span></code>, and additional configuration properties as needed
for your storage solution.</p>
<p>The following table lists the available configuration properties for
<code class="docutils literal notranslate"><span class="pre">exchange-manager.properties</span></code>, their default values, and which filesystem(s)
the property may be configured for:</p>
<table id="id7">
<caption><span class="caption-text">Exchange manager configuration properties</span><a class="headerlink" href="#id7" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 23%"/>
<col style="width: 38%"/>
<col style="width: 15%"/>
<col style="width: 23%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Supported filesystem</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.base-directories</span></code></p></td>
<td><p>Comma-separated list of URI locations that the exchange manager uses to
store spooling data. Only supports S3 and local filesystems.</p></td>
<td></td>
<td><p>Any</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.encryption-enabled</span></code></p></td>
<td><p>Enable encrypting of spooling data.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
<td><p>Any</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.sink-buffer-pool-min-size</span></code></p></td>
<td><p>The minimum buffer pool size for an exchange sink. The larger the buffer
pool size, the larger the write parallelism and memory usage.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td><p>Any</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.sink-buffers-per-partition</span></code></p></td>
<td><p>The number of buffers per partition in the buffer pool. The larger the
buffer pool size, the larger the write parallelism and memory usage.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>Any</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.sink-max-file-size</span></code></p></td>
<td><p>Max size of files written by exchange sinks.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1GB</span></code></p></td>
<td><p>Any</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.source-concurrent-reader</span></code></p></td>
<td><p>Number of concurrent readers to read from spooling storage. The
larger the number of concurrent readers, the larger the read parallelism
and memory usage.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td><p>Any</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.aws-access-key</span></code></p></td>
<td><p>AWS access key to use. Required for a connection to AWS S3 and GCS, can
be ignored for other S3 storage systems.</p></td>
<td></td>
<td><p>AWS S3, GCS</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.aws-secret-key</span></code></p></td>
<td><p>AWS secret key to use. Required for a connection to AWS S3 and GCS, can
be ignored for other S3 storage systems.</p></td>
<td></td>
<td><p>AWS S3, GCS</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.iam-role</span></code></p></td>
<td><p>IAM role to assume.</p></td>
<td></td>
<td><p>AWS S3, GCS</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.external-id</span></code></p></td>
<td><p>External ID for the IAM role trust policy.</p></td>
<td></td>
<td><p>AWS S3, GCS</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.region</span></code></p></td>
<td><p>Region of the S3 bucket.</p></td>
<td></td>
<td><p>AWS S3, GCS</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.endpoint</span></code></p></td>
<td><p>S3 storage endpoint server if using an S3-compatible storage system that
is not AWS. If using AWS S3, this can be ignored. If using GCS, set it
to <code class="docutils literal notranslate"><span class="pre">https://storage.googleapis.com</span></code>.</p></td>
<td></td>
<td><p>Any S3-compatible storage</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.max-error-retries</span></code></p></td>
<td><p>Maximum number of times the exchange manager’s S3 client should retry
a request.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td><p>Any S3-compatible storage</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.s3.upload.part-size</span></code></p></td>
<td><p>Part size for S3 multi-part upload.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">5MB</span></code></p></td>
<td><p>Any S3-compatible storage</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.gcs.json-key-file-path</span></code></p></td>
<td><p>Path to the JSON file that contains your Google Cloud Platform
service account key. Not to be set together with
<code class="docutils literal notranslate"><span class="pre">exchange.gcs.json-key</span></code></p></td>
<td></td>
<td><p>GCS</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.gcs.json-key</span></code></p></td>
<td><p>Your Google Cloud Platform service account key in JSON format.
Not to be set together with <code class="docutils literal notranslate"><span class="pre">exchange.gcs.json-key-file-path</span></code></p></td>
<td></td>
<td><p>GCS</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.azure.connection-string</span></code></p></td>
<td><p>Connection string used to access the spooling container.</p></td>
<td></td>
<td><p>Azure Blob Storage</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.azure.block-size</span></code></p></td>
<td><p>Block size for Azure block blob parallel upload.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">4MB</span></code></p></td>
<td><p>Azure Blob Storage</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exchange.azure.max-error-retries</span></code></p></td>
<td><p>Maximum number of times the exchange manager’s Azure client should
retry a request.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td><p>Azure Blob Storage</p></td>
</tr>
</tbody>
</table>
<p>It is recommended to set the <code class="docutils literal notranslate"><span class="pre">exchange.compression-enabled</span></code> property to
<code class="docutils literal notranslate"><span class="pre">true</span></code> in the cluster’s <code class="docutils literal notranslate"><span class="pre">config.properties</span></code> file, to reduce the exchange
manager’s overall I/O load. It is also recommended to configure a bucket
lifecycle rule to automatically expire abandoned objects in the event of a node
crash.</p>

<span id="fte-exchange-aws-s3"></span><h4 id="aws-s3">AWS S3<a class="headerlink" href="#aws-s3" title="Permalink to this headline">#</a></h4>
<p>The following example <code class="docutils literal notranslate"><span class="pre">exchange-manager.properties</span></code> configuration specifies an
AWS S3 bucket as the spooling storage destination. Note that the destination
does not have to be in AWS, but can be any S3-compatible storage system.</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">exchange-manager.name</span><span class="o">=</span><span class="s">filesystem</span>
<span class="na">exchange.base-directories</span><span class="o">=</span><span class="s">s3://exchange-spooling-bucket</span>
<span class="na">exchange.s3.region</span><span class="o">=</span><span class="s">us-west-1</span>
<span class="na">exchange.s3.aws-access-key</span><span class="o">=</span><span class="s">example-access-key</span>
<span class="na">exchange.s3.aws-secret-key</span><span class="o">=</span><span class="s">example-secret-key</span>
</pre></div>
</div>
<p>You can configure multiple S3 buckets for the exchange manager to distribute
spooled data across buckets, reducing the I/O load on any one bucket. If a query
fails with the error message
“software.amazon.awssdk.services.s3.model.S3Exception: Please reduce your
request rate”, this indicates that the workload is I/O intensive, and you should
specify multiple S3 buckets in <code class="docutils literal notranslate"><span class="pre">exchange.base-directories</span></code> to balance the
load:</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">exchange.base-directories</span><span class="o">=</span><span class="s">s3://exchange-spooling-bucket-1,s3://exchange-spooling-bucket-2</span>
</pre></div>
</div>


<span id="fte-exchange-azure-blob"></span><h4 id="azure-blob-storage">Azure Blob Storage<a class="headerlink" href="#azure-blob-storage" title="Permalink to this headline">#</a></h4>
<p>The following example <code class="docutils literal notranslate"><span class="pre">exchange-manager.properties</span></code> configuration specifies an
Azure Blob Storage container as the spooling storage destination.</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">exchange-manager.name</span><span class="o">=</span><span class="s">filesystem</span>
<span class="na">exchange.base-directories</span><span class="o">=</span><span class="s">abfs://container_name@account_name.dfs.core.windows.net</span>
<span class="na">exchange.azure.connection-string</span><span class="o">=</span><span class="s">connection-string</span>
</pre></div>
</div>


<span id="fte-exchange-gcs"></span><h4 id="google-cloud-storage">Google Cloud Storage<a class="headerlink" href="#google-cloud-storage" title="Permalink to this headline">#</a></h4>
<p>To enable exchange spooling on GCS in Trino, change the request endpoint to the
<code class="docutils literal notranslate"><span class="pre">https://storage.googleapis.com</span></code> Google storage URI, and configure your AWS
access/secret keys to use the GCS HMAC keys. If you deploy Trino on GCP, you
must either create a service account with access to your spooling bucket or
configure the key path to your GCS credential file.</p>
<p>For more information on GCS’s S3 compatibility, refer to the <a class="reference external" href="https://cloud.google.com/storage/docs/aws-simple-migration">Google Cloud
documentation on S3 migration</a>.</p>
<p>The following example <code class="docutils literal notranslate"><span class="pre">exchange-manager.properties</span></code> configuration specifies a
GCS bucket as the spooling storage destination.</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">exchange-manager.name</span><span class="o">=</span><span class="s">filesystem</span>
<span class="na">exchange.base-directories</span><span class="o">=</span><span class="s">gs://exchange-spooling-bucket</span>
<span class="na">exchange.s3.region</span><span class="o">=</span><span class="s">us-west-1</span>
<span class="na">exchange.s3.aws-access-key</span><span class="o">=</span><span class="s">example-access-key</span>
<span class="na">exchange.s3.aws-secret-key</span><span class="o">=</span><span class="s">example-secret-key</span>
<span class="na">exchange.s3.endpoint</span><span class="o">=</span><span class="s">https://storage.googleapis.com</span>
<span class="na">exchange.gcs.json-key-file-path</span><span class="o">=</span><span class="s">/path/to/gcs_keyfile.json</span>
</pre></div>
</div>


<span id="fte-exchange-local-filesystem"></span><h4 id="local-filesystem-storage">Local filesystem storage<a class="headerlink" href="#local-filesystem-storage" title="Permalink to this headline">#</a></h4>
<p>The following example <code class="docutils literal notranslate"><span class="pre">exchange-manager.properties</span></code> configuration specifies a
local directory, <code class="docutils literal notranslate"><span class="pre">/tmp/trino-exchange-manager</span></code>, as the spooling storage
destination.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is only recommended to use a local filesystem for exchange in standalone,
non-production clusters. A local directory can only be used for exchange in
a distributed cluster if the exchange directory is shared and accessible
from all worker nodes.</p>
</div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">exchange-manager.name</span><span class="o">=</span><span class="s">filesystem</span>
<span class="na">exchange.base-directories</span><span class="o">=</span><span class="s">/tmp/trino-exchange-manager</span>
</pre></div>
</div>






          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-grid md-main__inner" style="height: auto;">
  <div class="md-content">
    <div class="feedback-container md-content__inner md-typeset">
      <div class="feedback-thumbs">
        <p>Is the information on this page helpful?</p>
        <p class="feedback-option" title="yes">Yes</p>
        <p class="feedback-option" title="no">No</p>
      </div>
      <div class="feedback-message">
        <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
        <button type="button" onclick="sendMessage()" class="feedback-button">Submit</button>
        <a onclick="skip()" class="feedback-skip">Skip</a>
      </div>
    </div>
  </div>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '');
</script>
<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="graceful-shutdown.html" title="Graceful shutdown"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Graceful shutdown </span>
              </div>
            </a>
          
          
            <a href="event-listeners-http.html" title="HTTP event listener"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> HTTP event listener </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
<!-- custom footer should go here in time -->
<div class="page-footer">
  <div class="container md-grid">
    <div class="row">
      <div class="col-md-3">
        <p style="font-weight:900">Resources</p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">

        <a href="https://www.starburst.io/" target="_blank">
          
            <img src="../_static/starburst_KO-T.png" height="26"
                  alt="Starburst Enterprise 393-e.4 LTS logo">
        
        </a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright © 2017-2022<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
  </div>
</div>
<script src="../_static/algolia.js"></script>
<script src="../_static/searchbox.js"></script>
<script src="../_static/searchresults.js"></script>
  </body>
</html>