

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="000A2C">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', ' UA-114610397-1', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Iceberg connector &#8212; Starburst Enterprise</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/algolia.css" />
    <link rel="stylesheet" type="text/css" href="../_static/starburst.css" />
    <link rel="stylesheet" type="text/css" href="../_static/search.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/main.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kafka connector" href="kafka.html" />
    <link rel="prev" title="Hive connector with Alluxio" href="hive-alluxio.html" />

  
   

<link href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">


<!-- Always link to the latest version, as canonical -->
<link rel="canonical" href="https://docs.starburst.io/latest/connector/iceberg.html">

  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#connector/iceberg" tabindex="1" class="md-skip"> Skip to content </a>
  
<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://www.starburst.io" title="Starburst Enterprise"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/starburst_KO-T.png"
                   alt="Starburst Enterprise 407-e.13 LTS logo">
          
        </a>
      </div>
      <span class="header-divider"></span>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <a href="/starburst-enterprise/index.html"
          class="md-header-nav__topic">
          Documentation: Starburst Enterprise 407-e.13 LTS</a>
          <span class="md-header-nav__topic"> Iceberg connector </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        <div id="algolia-search">
  <div id="searchbox"></div>
  <div id="product-list">
    <h6 class="filter-label">Product:</h6>
  </div>
  <div id="versionsRefinementList" id="version-list" style="display:none"></div>
  <div id="hits"></div>
  <div id="stats"></div>
</div>
      </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Choose version</button>
    <div class="dropdown-content md-hero">
          <a title="Latest LTS (423-e)" href="/423-e/">Latest LTS (423-e)</a>
      
          <a title="413-e LTS" href="/413-e/">413-e LTS</a>
      
          <a title="407-e LTS" href="/407-e/">407-e LTS</a>
      
          <a title="402-e LTS" href="/402-e/">402-e LTS</a>
      
          <a title="Latest STS (427-e)" href="/427-e/">Latest STS (427-e)</a>
      
          <a title="426-e STS" href="/426-e/">426-e STS</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>


  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/get-started/index.html" class="md-tabs__link">Get started</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-galaxy/index.html" class="md-tabs__link">Starburst Galaxy</a></li>
            
            <li class="md-tabs__item"><a href="/starburst-enterprise/index.html" class="md-tabs__link">Starburst Enterprise</a></li>
            
            <li class="md-tabs__item"><a href="/ecosystems/index.html" class="md-tabs__link">Ecosystems</a></li>
            
            <li class="md-tabs__item"><a href="/resources.html" class="md-tabs__link">Resources</a></li>
          <li class="md-tabs__item"><a href="../non-object-storage.html" class="md-tabs__link">Non-object storage connectors</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Starburst Enterprise" class="md-nav__button md-logo">
      
        <img src="../_static/starburst_KO-T.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Starburst Enterprise">Starburst Enterprise 407-e.13 LTS</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Overview</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Features, use cases, and support</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">For all users</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../overview/sep-ui.html" class="md-nav__link">Starburst Enterprise web UI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../data-products.html" class="md-nav__link">Data products</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../insights.html" class="md-nav__link">Insights</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">For data engineers</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">For platform administrators</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Manual installation and license</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../k8s.html" class="md-nav__link">Deploying with Kubernetes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../aws.html" class="md-nav__link">Deploying with CFT on AWS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Performance, logging, and governance features</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../starburst-rest-api.html" class="md-nav__link">Starburst Enterprise REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Data sources</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connector overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../object-storage.html" class="md-nav__link">Object storage connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html" class="md-nav__link">Non-object storage connectors</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html#connector-types" class="md-nav__link">Connector types</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html#rdbms-connectors" class="md-nav__link">RDBMS connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html#key-value-store-connectors" class="md-nav__link">Key-value store connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html#stream-processing-system-connectors" class="md-nav__link">Stream processing system connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html#document-oriented-databases" class="md-nav__link">Document-oriented databases</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../non-object-storage.html#other-connectors" class="md-nav__link">Other connectors</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../utilities.html" class="md-nav__link">Utilities</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="starburst-connectors.html" class="md-nav__link">Starburst connectors feature matrix</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">SQL reference</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Version information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../versions.html" class="md-nav__link">407-e.13 LTS and others</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Appendix</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../appendix.html" class="md-nav__link">Version-specific notices and information</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../404.html" class="md-nav__link">&nbsp;</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#connector-iceberg--page-root" class="md-nav__link">Iceberg connector</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#requirements" class="md-nav__link">Requirements</a>
        </li>
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#hive-metastore-catalog" class="md-nav__link">Hive metastore catalog</a>
        </li>
        <li class="md-nav__item"><a href="#glue-catalog" class="md-nav__link">Glue catalog</a>
        </li>
        <li class="md-nav__item"><a href="#rest-catalog" class="md-nav__link">REST catalog</a>
        </li>
        <li class="md-nav__item"><a href="#jdbc-catalog" class="md-nav__link">JDBC catalog</a>
        </li>
        <li class="md-nav__item"><a href="#general-configuration" class="md-nav__link">General configuration</a>
        </li>
        <li class="md-nav__item"><a href="#orc-format-configuration" class="md-nav__link">ORC format configuration</a>
        </li>
        <li class="md-nav__item"><a href="#parquet-format-configuration" class="md-nav__link">Parquet format configuration</a>
        </li>
        <li class="md-nav__item"><a href="#authorization-checks" class="md-nav__link">Authorization checks</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#table-redirection" class="md-nav__link">Table redirection</a>
        </li>
        <li class="md-nav__item"><a href="#sql-support" class="md-nav__link">SQL support</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#schema-and-table-management" class="md-nav__link">Schema and table management</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#create-schema" class="md-nav__link">CREATE SCHEMA</a>
        </li>
        <li class="md-nav__item"><a href="#creating-tables" class="md-nav__link">Creating tables</a>
        </li>
        <li class="md-nav__item"><a href="#not-null-column-constraint" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> column constraint</a>
        </li>
        <li class="md-nav__item"><a href="#drop-table" class="md-nav__link">DROP TABLE</a>
        </li>
        <li class="md-nav__item"><a href="#alter-table-execute" class="md-nav__link">ALTER TABLE EXECUTE</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#optimize" class="md-nav__link">optimize</a>
        </li>
        <li class="md-nav__item"><a href="#expire-snapshots" class="md-nav__link">expire_snapshots</a>
        </li>
        <li class="md-nav__item"><a href="#remove-orphan-files" class="md-nav__link">remove_orphan_files</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#drop-extended-stats" class="md-nav__link">drop_extended_stats</a>
        </li>
        <li class="md-nav__item"><a href="#alter-table-set-properties" class="md-nav__link">ALTER TABLE SET PROPERTIES</a>
        </li>
        <li class="md-nav__item"><a href="#comment" class="md-nav__link">COMMENT</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#data-management" class="md-nav__link">Data management</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#deletion-by-partition" class="md-nav__link">Deletion by partition</a>
        </li>
        <li class="md-nav__item"><a href="#row-level-deletion" class="md-nav__link">Row level deletion</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#type-mapping" class="md-nav__link">Type mapping</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#iceberg-to-trino-type-mapping" class="md-nav__link">Iceberg to Trino type mapping</a>
        </li>
        <li class="md-nav__item"><a href="#trino-to-iceberg-type-mapping" class="md-nav__link">Trino to Iceberg type mapping</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#partitioned-tables" class="md-nav__link">Partitioned tables</a>
        </li>
        <li class="md-nav__item"><a href="#rolling-back-to-a-previous-snapshot" class="md-nav__link">Rolling back to a previous snapshot</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#time-travel-queries" class="md-nav__link">Time travel queries</a>
        </li>
        <li class="md-nav__item"><a href="#id2" class="md-nav__link">Rolling back to a previous snapshot</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#schema-evolution" class="md-nav__link">Schema evolution</a>
        </li>
        <li class="md-nav__item"><a href="#register-table" class="md-nav__link">Register table</a>
        </li>
        <li class="md-nav__item"><a href="#unregister-table" class="md-nav__link">Unregister table</a>
        </li>
        <li class="md-nav__item"><a href="#migrating-existing-tables" class="md-nav__link">Migrating existing tables</a>
        </li>
        <li class="md-nav__item"><a href="#iceberg-table-properties" class="md-nav__link">Iceberg table properties</a>
        </li>
        <li class="md-nav__item"><a href="#metadata-columns" class="md-nav__link">Metadata columns</a>
        </li>
        <li class="md-nav__item"><a href="#metadata-tables" class="md-nav__link">Metadata tables</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#data-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$data</span></code> table</a>
        </li>
        <li class="md-nav__item"><a href="#properties-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$properties</span></code> table</a>
        </li>
        <li class="md-nav__item"><a href="#history-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$history</span></code> table</a>
        </li>
        <li class="md-nav__item"><a href="#snapshots-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> table</a>
        </li>
        <li class="md-nav__item"><a href="#manifests-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$manifests</span></code> table</a>
        </li>
        <li class="md-nav__item"><a href="#partitions-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$partitions</span></code> table</a>
        </li>
        <li class="md-nav__item"><a href="#files-table" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">$files</span></code> table</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#materialized-views" class="md-nav__link">Materialized views</a>
        </li>
        <li class="md-nav__item"><a href="#table-statistics" class="md-nav__link">Table statistics</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#updating-table-statistics" class="md-nav__link">Updating table statistics</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="iceberg-connector">
<h1 id="connector-iceberg--page-root">Iceberg connector<a class="headerlink" href="#connector-iceberg--page-root" title="Permalink to this heading">#</a></h1>
<img class="connector-logo" src="../_static/img/iceberg.png"/><p>Apache Iceberg is an open table format for huge analytic datasets.
The Iceberg connector allows querying data stored in
files written in Iceberg format, as defined in the
<a class="reference external" href="https://iceberg.apache.org/spec/">Iceberg Table Spec</a>. It supports Apache
Iceberg table spec version 1 and 2.</p>
<p>The Iceberg table state is maintained in metadata files. All changes to table state
create a new metadata file and replace the old metadata with an atomic swap.
The table metadata file tracks the table schema, partitioning config,
custom properties, and snapshots of the table contents.</p>
<p>Iceberg data files can be stored in either Parquet, ORC or Avro format, as
determined by the <code class="docutils literal notranslate"><span class="pre">format</span></code> property in the table definition.  The
table <code class="docutils literal notranslate"><span class="pre">format</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">ORC</span></code>.</p>
<p>Iceberg is designed to improve on the known scalability limitations of Hive, which stores
table metadata in a metastore that is backed by a relational database such as MySQL.  It tracks
partition locations in the metastore, but not individual data files.  Trino queries
using the <a class="reference internal" href="hive.html"><span class="doc">Hive connector</span></a> must first call the metastore to get partition locations,
then call the underlying filesystem to list all data files inside each partition,
and then read metadata from each data file.</p>
<p>Since Iceberg stores the paths to data files in the metadata files, it
only consults the underlying file system for files that must be read.</p>
<section id="requirements">
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h2>
<p>To use Iceberg, you need:</p>
<ul class="simple">
<li><p>Network access from the Trino coordinator and workers to the distributed
object storage.</p></li>
<li><p>Access to a Hive metastore service (HMS) or AWS Glue.</p></li>
<li><p>Network access from the Trino coordinator to the HMS. Hive
metastore access with the Thrift protocol defaults to using port 9083.</p></li>
</ul>
</section>
<section id="configuration">
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">#</a></h2>
<p>The connector supports multiple Iceberg catalog types, you may use either a Hive
metastore service (HMS), AWS Glue, or a REST catalog. The catalog type is determined by the
<code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code> property, it can be set to <code class="docutils literal notranslate"><span class="pre">HIVE_METASTORE</span></code>, <code class="docutils literal notranslate"><span class="pre">GLUE</span></code>, <code class="docutils literal notranslate"><span class="pre">JDBC</span></code>, or <code class="docutils literal notranslate"><span class="pre">REST</span></code>.</p>
<section id="hive-metastore-catalog">
<span id="iceberg-hive-catalog"></span><h3 id="hive-metastore-catalog">Hive metastore catalog<a class="headerlink" href="#hive-metastore-catalog" title="Permalink to this heading">#</a></h3>
<p>The Hive metastore catalog is the default implementation.
When using it, the Iceberg connector supports the same metastore
configuration properties as the Hive connector. At a minimum,
<code class="docutils literal notranslate"><span class="pre">hive.metastore.uri</span></code> must be configured, see
<a class="reference internal" href="hive.html#hive-thrift-metastore"><span class="std std-ref">Thrift metastore configuration</span></a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
hive.metastore.uri=thrift://localhost:9083
</pre></div>
</div>
</section>
<section id="glue-catalog">
<span id="iceberg-glue-catalog"></span><h3 id="glue-catalog">Glue catalog<a class="headerlink" href="#glue-catalog" title="Permalink to this heading">#</a></h3>
<p>When using the Glue catalog, the Iceberg connector supports the same
configuration properties as the Hive connector’s Glue setup. See
<a class="reference internal" href="hive.html#hive-glue-metastore"><span class="std std-ref">AWS Glue metastore configuration</span></a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
iceberg.catalog.type=glue
</pre></div>
</div>
</section>
<section id="rest-catalog">
<span id="iceberg-rest-catalog"></span><h3 id="rest-catalog">REST catalog<a class="headerlink" href="#rest-catalog" title="Permalink to this heading">#</a></h3>
<p>In order to use the Iceberg REST catalog, ensure to configure the catalog type with
<code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type=rest</span></code> and provide further details with the following
properties:</p>
<table>
<colgroup>
<col style="width: 40%"/>
<col style="width: 60%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.rest-catalog.uri</span></code></p></td>
<td><p>REST server API endpoint URI (required).
Example: <code class="docutils literal notranslate"><span class="pre">http://iceberg-with-rest:8181</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.rest-catalog.security</span></code></p></td>
<td><p>The type of security to use (default: <code class="docutils literal notranslate"><span class="pre">NONE</span></code>).  <code class="docutils literal notranslate"><span class="pre">OAUTH2</span></code>
requires either a <code class="docutils literal notranslate"><span class="pre">token</span></code> or <code class="docutils literal notranslate"><span class="pre">credential</span></code>.
Example: <code class="docutils literal notranslate"><span class="pre">OAUTH2</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.rest-catalog.session</span></code></p></td>
<td><p>Session information included when communicating with the REST Catalog.
Options are <code class="docutils literal notranslate"><span class="pre">NONE</span></code> or <code class="docutils literal notranslate"><span class="pre">USER</span></code> (default: <code class="docutils literal notranslate"><span class="pre">NONE</span></code>).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.rest-catalog.oauth2.token</span></code></p></td>
<td><p>The Bearer token which will be used for interactions
with the server. A <code class="docutils literal notranslate"><span class="pre">token</span></code> or <code class="docutils literal notranslate"><span class="pre">credential</span></code> is required for
<code class="docutils literal notranslate"><span class="pre">OAUTH2</span></code> security.
Example: <code class="docutils literal notranslate"><span class="pre">AbCdEf123456</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.rest-catalog.oauth2.credential</span></code></p></td>
<td><p>The credential to exchange for a token in the OAuth2 client
credentials flow with the server. A <code class="docutils literal notranslate"><span class="pre">token</span></code> or <code class="docutils literal notranslate"><span class="pre">credential</span></code>
is required for <code class="docutils literal notranslate"><span class="pre">OAUTH2</span></code> security.
Example: <code class="docutils literal notranslate"><span class="pre">AbCdEf123456</span></code></p></td>
</tr>
</tbody>
</table>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
iceberg.catalog.type=rest
iceberg.rest-catalog.uri=http://iceberg-with-rest:8181
</pre></div>
</div>
<p>REST catalog does not support <a class="reference internal" href="../sql/create-view.html"><span class="doc">views</span></a> or
<a class="reference internal" href="../sql/create-materialized-view.html"><span class="doc">materialized views</span></a>.</p>
</section>
<section id="jdbc-catalog">
<span id="iceberg-jdbc-catalog"></span><h3 id="jdbc-catalog">JDBC catalog<a class="headerlink" href="#jdbc-catalog" title="Permalink to this heading">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The JDBC catalog may face the compatibility issue if Iceberg introduces breaking changes in the future.
Consider the <a class="reference internal" href="#iceberg-rest-catalog"><span class="std std-ref">REST catalog</span></a> as an alternative solution.</p>
</div>
<p>At a minimum, <code class="docutils literal notranslate"><span class="pre">iceberg.jdbc-catalog.connection-url</span></code> and
<code class="docutils literal notranslate"><span class="pre">iceberg.jdbc-catalog.catalog-name</span></code> must be configured.
When using any database besides PostgreSQL, a JDBC driver jar file must be placed in the plugin directory.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
iceberg.catalog.type=jdbc
iceberg.jdbc-catalog.catalog-name=test
iceberg.jdbc-catalog.connection-url=jdbc:postgresql://example.net:5432/database
iceberg.jdbc-catalog.connection-user=admin
iceberg.jdbc-catalog.connection-password=test
iceberg.jdbc-catalog.default-warehouse-dir=s3://bucket
</pre></div>
</div>
<p>JDBC catalog does not support <a class="reference internal" href="../sql/create-view.html"><span class="doc">views</span></a> or
<a class="reference internal" href="../sql/create-materialized-view.html"><span class="doc">materialized views</span></a>.</p>
</section>
<section id="general-configuration">
<h3 id="general-configuration">General configuration<a class="headerlink" href="#general-configuration" title="Permalink to this heading">#</a></h3>
<p>These configuration properties are independent of which catalog implementation
is used.</p>
<table id="id4">
<caption><span class="caption-text">Iceberg general configuration properties</span><a class="headerlink" href="#id4" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 58%"/>
<col style="width: 12%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.file-format</span></code></p></td>
<td><p>Define the data storage file format for Iceberg tables.
Possible values are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PARQUET</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AVRO</span></code></p></li>
</ul>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">ORC</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.compression-codec</span></code></p></td>
<td><p>The compression codec to be used when writing files.
Possible values are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SNAPPY</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LZ4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ZSTD</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GZIP</span></code></p></li>
</ul>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">ZSTD</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.use-file-size-from-metadata</span></code></p></td>
<td><p>Read file sizes from metadata instead of file system.
This property should only be set as a workaround for
<a class="reference external" href="https://github.com/apache/iceberg/issues/1980">this issue</a>.
The problem was fixed in Iceberg version 0.11.0.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.max-partitions-per-writer</span></code></p></td>
<td><p>Maximum number of partitions handled per writer.</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.target-max-file-size</span></code></p></td>
<td><p>Target maximum size of written files; the actual size may be larger.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1GB</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.unique-table-location</span></code></p></td>
<td><p>Use randomized, unique table locations.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.dynamic-filtering.wait-timeout</span></code></p></td>
<td><p>Maximum duration to wait for completion of dynamic filters during split generation.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0s</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.delete-schema-locations-fallback</span></code></p></td>
<td><p>Whether schema locations should be deleted when Trino can’t determine whether they contain external files.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.minimum-assigned-split-weight</span></code></p></td>
<td><p>A decimal value in the range (0, 1] used as a minimum for weights assigned to each split. A low value may improve performance
on tables with small files. A higher value may improve performance for queries with highly skewed aggregations or joins.</p></td>
<td><p>0.05</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.table-statistics-enabled</span></code></p></td>
<td><p>Enables <a class="reference internal" href="../optimizer/statistics.html"><span class="doc">Table statistics</span></a>. The equivalent
<a class="reference internal" href="../sql/set-session.html"><span class="doc">catalog session property</span></a>
is <code class="docutils literal notranslate"><span class="pre">statistics_enabled</span></code> for session specific use.
Set to <code class="docutils literal notranslate"><span class="pre">false</span></code> to disable statistics. Disabling statistics
means that <a class="reference internal" href="../optimizer/cost-based-optimizations.html"><span class="doc">Cost-based optimizations</span></a> can
not make smart decisions about the query plan.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.projection-pushdown-enabled</span></code></p></td>
<td><p>Enable <a class="reference internal" href="../optimizer/pushdown.html"><span class="doc">projection pushdown</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.hive-catalog-name</span></code></p></td>
<td><p>Catalog to redirect to when a Hive table is referenced.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.materialized-views.storage-schema</span></code></p></td>
<td><p>Schema for creating materialized views storage tables. When this property
is not configured, storage tables are created in the same schema as the
materialized view definition. When the <code class="docutils literal notranslate"><span class="pre">storage_schema</span></code> materialized
view property is specified, it takes precedence over this catalog property.</p></td>
<td><p>Empty</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.register-table-procedure.enabled</span></code></p></td>
<td><p>Enable to allow user to call <code class="docutils literal notranslate"><span class="pre">register_table</span></code> procedure</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="orc-format-configuration">
<h3 id="orc-format-configuration">ORC format configuration<a class="headerlink" href="#orc-format-configuration" title="Permalink to this heading">#</a></h3>
<p>The following properties are used to configure the read and write operations
with ORC files performed by the Iceberg connector.</p>
<table id="id5">
<caption><span class="caption-text">ORC format configuration properties</span><a class="headerlink" href="#id5" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 58%"/>
<col style="width: 12%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hive.orc.bloom-filters.enabled</span></code></p></td>
<td><p>Enable bloom filters for predicate pushdown.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="parquet-format-configuration">
<h3 id="parquet-format-configuration">Parquet format configuration<a class="headerlink" href="#parquet-format-configuration" title="Permalink to this heading">#</a></h3>
<p>The following properties are used to configure the read and write operations
with Parquet files performed by the Iceberg connector.</p>
<table id="id6">
<caption><span class="caption-text">Parquet format configuration properties</span><a class="headerlink" href="#id6" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 50%"/>
<col style="width: 20%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">parquet.max-read-block-row-count</span></code></p></td>
<td><p>Sets the maximum number of rows read in a batch.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8192</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">parquet.optimized-reader.enabled</span></code></p></td>
<td><p>Whether batched column readers should be used when reading Parquet files
for improved performance. Set this property to <code class="docutils literal notranslate"><span class="pre">false</span></code> to disable the
optimized parquet reader by default. The equivalent catalog session
property is <code class="docutils literal notranslate"><span class="pre">parquet_optimized_reader_enabled</span></code>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="authorization-checks">
<span id="iceberg-authorization"></span><h3 id="authorization-checks">Authorization checks<a class="headerlink" href="#authorization-checks" title="Permalink to this heading">#</a></h3>
<p>You can enable authorization checks for the connector by setting
the <code class="docutils literal notranslate"><span class="pre">iceberg.security</span></code> property in the catalog properties file. This
property must be one of the following values:</p>
<table id="id7">
<caption><span class="caption-text">Iceberg security values</span><a class="headerlink" href="#id7" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 33%"/>
<col style="width: 67%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ALLOW_ALL</span></code></p></td>
<td><p>No authorization checks are enforced.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SYSTEM</span></code></p></td>
<td><p>The connector relies on system-level access control.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">READ_ONLY</span></code></p></td>
<td><p>Operations that read data or metadata, such as <a class="reference internal" href="../sql/select.html"><span class="doc">SELECT</span></a> are
permitted. No operations that write data or metadata, such as
<a class="reference internal" href="../sql/create-table.html"><span class="doc">CREATE TABLE</span></a>, <a class="reference internal" href="../sql/insert.html"><span class="doc">INSERT</span></a>, or <a class="reference internal" href="../sql/delete.html"><span class="doc">DELETE</span></a> are
allowed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">FILE</span></code></p></td>
<td><p>Authorization checks are enforced using a catalog-level access control
configuration file whose path is specified in the <code class="docutils literal notranslate"><span class="pre">security.config-file</span></code>
catalog configuration property. See
<a class="reference internal" href="../security/file-system-access-control.html#catalog-file-based-access-control"><span class="std std-ref">Catalog-level access control files</span></a> for information on the
authorization configuration file.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="table-redirection">
<span id="iceberg-table-redirection"></span><h2 id="table-redirection">Table redirection<a class="headerlink" href="#table-redirection" title="Permalink to this heading">#</a></h2>
<p>Trino offers the possibility to transparently redirect operations on an existing
table to the appropriate catalog based on the format of the table and catalog configuration.</p>
<p>In the context of connectors which depend on a metastore service
(for example, <a class="reference internal" href="hive.html"><span class="doc">Hive connector</span></a>, <a class="reference internal" href="#"><span class="doc">Iceberg connector</span></a> and <a class="reference internal" href="delta-lake.html"><span class="doc">Delta Lake connector</span></a>),
the metastore (Hive metastore service, <a class="reference external" href="https://aws.amazon.com/glue/">AWS Glue Data Catalog</a>)
can be used to accustom tables with different table formats.
Therefore, a metastore database can hold a variety of tables with different table formats.</p>
<p>As a concrete example, let’s use the following
simple scenario which makes use of table redirection:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">example</span><span class="p">.</span><span class="n">example_schema</span><span class="p">;</span>

<span class="k">EXPLAIN</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">example_table</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                               Query Plan
-------------------------------------------------------------------------
Fragment 0 [SOURCE]
     ...
     Output[columnNames = [...]]
     │   ...
     └─ TableScan[table = another_catalog:example_schema:example_table]
            ...
</pre></div>
</div>
<p>The output of the <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span></code> statement points out the actual
catalog which is handling the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> query over the table <code class="docutils literal notranslate"><span class="pre">example_table</span></code>.</p>
<p>The table redirection functionality works also when using
fully qualified names for the tables:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">EXPLAIN</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">example_schema</span><span class="p">.</span><span class="n">example_table</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                               Query Plan
-------------------------------------------------------------------------
Fragment 0 [SOURCE]
     ...
     Output[columnNames = [...]]
     │   ...
     └─ TableScan[table = another_catalog:example_schema:example_table]
            ...
</pre></div>
</div>
<p>Trino offers table redirection support for the following operations:</p>
<ul class="simple">
<li><p>Table read operations</p>
<ul>
<li><p><a class="reference internal" href="../sql/select.html"><span class="doc">SELECT</span></a></p></li>
<li><p><a class="reference internal" href="../sql/describe.html"><span class="doc">DESCRIBE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/show-stats.html"><span class="doc">SHOW STATS</span></a></p></li>
<li><p><a class="reference internal" href="../sql/show-create-table.html"><span class="doc">SHOW CREATE TABLE</span></a></p></li>
</ul>
</li>
<li><p>Table write operations</p>
<ul>
<li><p><a class="reference internal" href="../sql/insert.html"><span class="doc">INSERT</span></a></p></li>
<li><p><a class="reference internal" href="../sql/update.html"><span class="doc">UPDATE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/merge.html"><span class="doc">MERGE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/delete.html"><span class="doc">DELETE</span></a></p></li>
</ul>
</li>
<li><p>Table management operations</p>
<ul>
<li><p><a class="reference internal" href="../sql/alter-table.html"><span class="doc">ALTER TABLE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/drop-table.html"><span class="doc">DROP TABLE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/comment.html"><span class="doc">COMMENT</span></a></p></li>
</ul>
</li>
</ul>
<p>Trino does not offer view redirection support.</p>
<p>The connector supports redirection from Iceberg tables to Hive tables
with the <code class="docutils literal notranslate"><span class="pre">iceberg.hive-catalog-name</span></code> catalog configuration property.</p>
</section>
<section id="sql-support">
<span id="iceberg-sql-support"></span><h2 id="sql-support">SQL support<a class="headerlink" href="#sql-support" title="Permalink to this heading">#</a></h2>
<p>This connector provides read access and write access to data and metadata in
Iceberg. In addition to the <a class="reference internal" href="../language/sql-support.html#sql-globally-available"><span class="std std-ref">globally available</span></a>
and <a class="reference internal" href="../language/sql-support.html#sql-read-operations"><span class="std std-ref">read operation</span></a> statements, the connector
supports the following features:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../language/sql-support.html#sql-write-operations"><span class="std std-ref">Write operations</span></a>:</p>
<ul>
<li><p><a class="reference internal" href="#iceberg-schema-table-management"><span class="std std-ref">Schema and table management</span></a> and <a class="reference internal" href="#iceberg-tables"><span class="std std-ref">Partitioned tables</span></a></p></li>
<li><p><a class="reference internal" href="#iceberg-data-management"><span class="std std-ref">Data management</span></a></p></li>
<li><p><a class="reference internal" href="../language/sql-support.html#sql-view-management"><span class="std std-ref">View management</span></a></p></li>
<li><p><a class="reference internal" href="../language/sql-support.html#sql-materialized-view-management"><span class="std std-ref">Materialized view management</span></a>, see also <a class="reference internal" href="#iceberg-materialized-views"><span class="std std-ref">Materialized views</span></a></p></li>
</ul>
</li>
</ul>
<section id="schema-and-table-management">
<span id="iceberg-schema-table-management"></span><h3 id="schema-and-table-management">Schema and table management<a class="headerlink" href="#schema-and-table-management" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../language/sql-support.html#sql-schema-table-management"><span class="std std-ref">Schema and table management</span></a> functionality includes support for:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../sql/create-schema.html"><span class="doc">CREATE SCHEMA</span></a></p></li>
<li><p><a class="reference internal" href="../sql/drop-schema.html"><span class="doc">DROP SCHEMA</span></a></p></li>
<li><p><a class="reference internal" href="../sql/alter-schema.html"><span class="doc">ALTER SCHEMA</span></a></p></li>
<li><p><a class="reference internal" href="../sql/create-table.html"><span class="doc">CREATE TABLE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/create-table-as.html"><span class="doc">CREATE TABLE AS</span></a></p></li>
<li><p><a class="reference internal" href="../sql/drop-table.html"><span class="doc">DROP TABLE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/alter-table.html"><span class="doc">ALTER TABLE</span></a></p></li>
<li><p><a class="reference internal" href="../sql/comment.html"><span class="doc">COMMENT</span></a></p></li>
</ul>
<section id="create-schema">
<span id="iceberg-create-schema"></span><h4 id="create-schema">CREATE SCHEMA<a class="headerlink" href="#create-schema" title="Permalink to this heading">#</a></h4>
<p>The connector supports creating schemas. You can create a schema with or without
a specified location.</p>
<p>You can create a schema with the <a class="reference internal" href="../sql/create-schema.html"><span class="doc">CREATE SCHEMA</span></a> statement and the
<code class="docutils literal notranslate"><span class="pre">location</span></code> schema property. The tables in this schema, which have no explicit
<code class="docutils literal notranslate"><span class="pre">location</span></code> set in <a class="reference internal" href="../sql/create-table.html"><span class="doc">CREATE TABLE</span></a> statement, are located in a
subdirectory under the directory corresponding to the schema location.</p>
<p>Create a schema on S3:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">example</span><span class="p">.</span><span class="n">example_s3_schema</span>
<span class="k">WITH</span> <span class="p">(</span><span class="k">location</span> <span class="o">=</span> <span class="s1">'s3://my-bucket/a/path/'</span><span class="p">);</span>
</pre></div>
</div>
<p>Create a schema on a S3 compatible object storage such as MinIO:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">example</span><span class="p">.</span><span class="n">example_s3a_schema</span>
<span class="k">WITH</span> <span class="p">(</span><span class="k">location</span> <span class="o">=</span> <span class="s1">'s3a://my-bucket/a/path/'</span><span class="p">);</span>
</pre></div>
</div>
<p>Create a schema on HDFS:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">example</span><span class="p">.</span><span class="n">example_hdfs_schema</span>
<span class="k">WITH</span> <span class="p">(</span><span class="k">location</span><span class="o">=</span><span class="s1">'hdfs://hadoop-master:9000/user/hive/warehouse/a/path/'</span><span class="p">);</span>
</pre></div>
</div>
<p>Optionally, on HDFS, the location can be omitted:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">example</span><span class="p">.</span><span class="n">example_hdfs_schema</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="creating-tables">
<span id="iceberg-create-table"></span><h4 id="creating-tables">Creating tables<a class="headerlink" href="#creating-tables" title="Permalink to this heading">#</a></h4>
<p>The Iceberg connector supports creating tables using the <a class="reference internal" href="../sql/create-table.html"><span class="doc">CREATE
TABLE</span></a> syntax. Optionally specify the
<a class="reference internal" href="#iceberg-table-properties"><span class="std std-ref">table properties</span></a> supported by this connector:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example_table</span> <span class="p">(</span>
    <span class="n">c1</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">c2</span> <span class="nb">date</span><span class="p">,</span>
    <span class="n">c3</span> <span class="n">double</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">'PARQUET'</span><span class="p">,</span>
    <span class="n">partitioning</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'c1'</span><span class="p">,</span> <span class="s1">'c2'</span><span class="p">],</span>
    <span class="k">location</span> <span class="o">=</span> <span class="s1">'s3://my-bucket/a/path/'</span>
<span class="p">);</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">location</span></code> table property is omitted, the content of the table
is stored in a subdirectory under the directory corresponding to the
schema location.</p>
<p>The Iceberg connector supports creating tables using the <a class="reference internal" href="../sql/create-table-as.html"><span class="doc">CREATE
TABLE AS</span></a> with <a class="reference internal" href="../sql/select.html"><span class="doc">SELECT</span></a> syntax:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tiny_nation</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">'PARQUET'</span>
<span class="p">)</span>
<span class="k">AS</span>
    <span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="n">nation</span>
    <span class="k">WHERE</span> <span class="n">nationkey</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>Another flavor of creating tables with <a class="reference internal" href="../sql/create-table-as.html"><span class="doc">CREATE TABLE AS</span></a>
is with <a class="reference internal" href="../sql/values.html"><span class="doc">VALUES</span></a> syntax:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">yearly_clicks</span> <span class="p">(</span>
    <span class="k">year</span><span class="p">,</span>
    <span class="n">clicks</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="n">partitioning</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span>
<span class="p">)</span>
<span class="k">AS</span> <span class="k">VALUES</span>
    <span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">20000</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="not-null-column-constraint">
<h4 id="not-null-column-constraint"><code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> column constraint<a class="headerlink" href="#not-null-column-constraint" title="Permalink to this heading">#</a></h4>
<p>The Iceberg connector supports setting <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> constraints on the table columns.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> constraint can be set on the columns, while creating tables by
using the <a class="reference internal" href="../sql/create-table.html"><span class="doc">CREATE TABLE</span></a> syntax:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example_table</span> <span class="p">(</span>
    <span class="k">year</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">age</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">address</span> <span class="nb">VARCHAR</span>
<span class="p">);</span>
</pre></div>
</div>
<p>When trying to insert/update data in the table, the query fails if trying
to set <code class="docutils literal notranslate"><span class="pre">NULL</span></code> value on a column having the <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> constraint.</p>
</section>
<section id="drop-table">
<h4 id="drop-table">DROP TABLE<a class="headerlink" href="#drop-table" title="Permalink to this heading">#</a></h4>
<p>The Iceberg connector supports dropping a table by using the <a class="reference internal" href="../sql/drop-table.html"><span class="doc">DROP TABLE</span></a>
syntax. When the command succeeds, both the data of the Iceberg table and also the
information related to the table in the metastore service are removed.
Dropping tables which have their data/metadata stored in a different location than
the table’s corresponding base directory on the object store is not supported.</p>
</section>
<section id="alter-table-execute">
<span id="iceberg-alter-table-execute"></span><span id="iceberg-comment"></span><h4 id="alter-table-execute">ALTER TABLE EXECUTE<a class="headerlink" href="#alter-table-execute" title="Permalink to this heading">#</a></h4>
<p>The connector supports the following commands for use with
<a class="reference internal" href="../sql/alter-table.html#alter-table-execute"><span class="std std-ref">ALTER TABLE EXECUTE</span></a>.</p>
<section id="optimize">
<h5 id="optimize">optimize<a class="headerlink" href="#optimize" title="Permalink to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">optimize</span></code> command is used for rewriting the active content
of the specified table so that it is merged into fewer but
larger files.
In case that the table is partitioned, the data compaction
acts separately on each partition selected for optimization.
This operation improves read performance.</p>
<p>All files with a size below the optional <code class="docutils literal notranslate"><span class="pre">file_size_threshold</span></code>
parameter (default value for the threshold is <code class="docutils literal notranslate"><span class="pre">100MB</span></code>) are
merged:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="k">EXECUTE</span> <span class="n">optimize</span>
</pre></div>
</div>
<p>The following statement merges the files in a table that
are under 10 megabytes in size:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="k">EXECUTE</span> <span class="n">optimize</span><span class="p">(</span><span class="n">file_size_threshold</span> <span class="o">=&gt;</span> <span class="s1">'10MB'</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause with the columns used to partition
the table, to apply <code class="docutils literal notranslate"><span class="pre">optimize</span></code> only on the partition(s) corresponding
to the filter:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">test_partitioned_table</span> <span class="k">EXECUTE</span> <span class="n">optimize</span>
<span class="k">WHERE</span> <span class="n">partition_key</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="expire-snapshots">
<h5 id="expire-snapshots">expire_snapshots<a class="headerlink" href="#expire-snapshots" title="Permalink to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">expire_snapshots</span></code> command removes all snapshots and all related metadata and data files.
Regularly expiring snapshots is recommended to delete data files that are no longer needed,
and to keep the size of table metadata small.
The procedure affects all snapshots that are older than the time period configured with the <code class="docutils literal notranslate"><span class="pre">retention_threshold</span></code> parameter.</p>
<p><code class="docutils literal notranslate"><span class="pre">expire_snapshots</span></code> can be run as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="k">EXECUTE</span> <span class="n">expire_snapshots</span><span class="p">(</span><span class="n">retention_threshold</span> <span class="o">=&gt;</span> <span class="s1">'7d'</span><span class="p">)</span>
</pre></div>
</div>
<p>The value for <code class="docutils literal notranslate"><span class="pre">retention_threshold</span></code> must be higher than or equal to <code class="docutils literal notranslate"><span class="pre">iceberg.expire_snapshots.min-retention</span></code> in the catalog
otherwise the procedure will fail with similar message:
<code class="docutils literal notranslate"><span class="pre">Retention</span> <span class="pre">specified</span> <span class="pre">(1.00d)</span> <span class="pre">is</span> <span class="pre">shorter</span> <span class="pre">than</span> <span class="pre">the</span> <span class="pre">minimum</span> <span class="pre">retention</span> <span class="pre">configured</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">system</span> <span class="pre">(7.00d)</span></code>.
The default value for this property is <code class="docutils literal notranslate"><span class="pre">7d</span></code>.</p>
</section>
<section id="remove-orphan-files">
<h5 id="remove-orphan-files">remove_orphan_files<a class="headerlink" href="#remove-orphan-files" title="Permalink to this heading">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">remove_orphan_files</span></code> command removes all files from table’s data directory which are
not linked from metadata files and that are older than the value of <code class="docutils literal notranslate"><span class="pre">retention_threshold</span></code> parameter.
Deleting orphan files from time to time is recommended to keep size of table’s data directory under control.</p>
<p><code class="docutils literal notranslate"><span class="pre">remove_orphan_files</span></code> can be run as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="k">EXECUTE</span> <span class="n">remove_orphan_files</span><span class="p">(</span><span class="n">retention_threshold</span> <span class="o">=&gt;</span> <span class="s1">'7d'</span><span class="p">)</span>
</pre></div>
</div>
<p>The value for <code class="docutils literal notranslate"><span class="pre">retention_threshold</span></code> must be higher than or equal to <code class="docutils literal notranslate"><span class="pre">iceberg.remove_orphan_files.min-retention</span></code> in the catalog
otherwise the procedure will fail with similar message:
<code class="docutils literal notranslate"><span class="pre">Retention</span> <span class="pre">specified</span> <span class="pre">(1.00d)</span> <span class="pre">is</span> <span class="pre">shorter</span> <span class="pre">than</span> <span class="pre">the</span> <span class="pre">minimum</span> <span class="pre">retention</span> <span class="pre">configured</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">system</span> <span class="pre">(7.00d)</span></code>.
The default value for this property is <code class="docutils literal notranslate"><span class="pre">7d</span></code>.</p>
</section>
</section>
<section id="drop-extended-stats">
<span id="id1"></span><h4 id="drop-extended-stats">drop_extended_stats<a class="headerlink" href="#drop-extended-stats" title="Permalink to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">drop_extended_stats</span></code> command removes all extended statistics information from
the table.</p>
<p><code class="docutils literal notranslate"><span class="pre">drop_extended_stats</span></code> can be run as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="k">EXECUTE</span> <span class="n">drop_extended_stats</span>
</pre></div>
</div>
</section>
<section id="alter-table-set-properties">
<span id="iceberg-alter-table-set-properties"></span><h4 id="alter-table-set-properties">ALTER TABLE SET PROPERTIES<a class="headerlink" href="#alter-table-set-properties" title="Permalink to this heading">#</a></h4>
<p>The connector supports modifying the properties on existing tables using
<a class="reference internal" href="../sql/alter-table.html#alter-table-set-properties"><span class="std std-ref">ALTER TABLE SET PROPERTIES</span></a>.</p>
<p>The following table properties can be updated after a table is created:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format_version</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">partitioning</span></code></p></li>
</ul>
<p>For example, to update a table from v1 of the Iceberg specification to v2:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">PROPERTIES</span> <span class="n">format_version</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>Or to set the column <code class="docutils literal notranslate"><span class="pre">my_new_partition_column</span></code> as a partition column on a table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">PROPERTIES</span> <span class="n">partitioning</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="o">&lt;</span><span class="k">existing</span> <span class="n">partition</span> <span class="n">columns</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">'my_new_partition_column'</span><span class="p">];</span>
</pre></div>
</div>
<p>The current values of a table’s properties can be shown using <a class="reference internal" href="../sql/show-create-table.html"><span class="doc">SHOW CREATE TABLE</span></a>.</p>
</section>
<section id="comment">
<h4 id="comment">COMMENT<a class="headerlink" href="#comment" title="Permalink to this heading">#</a></h4>
<p>The Iceberg connector supports setting comments on the following objects:</p>
<ul class="simple">
<li><p>tables</p></li>
<li><p>views</p></li>
<li><p>table columns</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">COMMENT</span></code> option is supported on both the table and
the table columns for the <a class="reference internal" href="../sql/create-table.html"><span class="doc">CREATE TABLE</span></a> operation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">COMMENT</span></code> option is supported for adding table columns
through the <a class="reference internal" href="../sql/alter-table.html"><span class="doc">ALTER TABLE</span></a> operations.</p>
<p>The connector supports the command <a class="reference internal" href="../sql/comment.html"><span class="doc">COMMENT</span></a> for setting
comments on existing entities.</p>
</section>
</section>
<section id="data-management">
<span id="iceberg-data-management"></span><h3 id="data-management">Data management<a class="headerlink" href="#data-management" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="../language/sql-support.html#sql-data-management"><span class="std std-ref">Data management</span></a> functionality includes support for <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>,
<code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, and <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> statements.</p>
<section id="deletion-by-partition">
<span id="iceberg-delete"></span><h4 id="deletion-by-partition">Deletion by partition<a class="headerlink" href="#deletion-by-partition" title="Permalink to this heading">#</a></h4>
<p>For partitioned tables, the Iceberg connector supports the deletion of entire
partitions if the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause specifies filters only on the identity-transformed
partitioning columns, that can match entire partitions. Given the table definition
from <a class="reference internal" href="#iceberg-tables"><span class="std std-ref">Partitioned Tables</span></a> section,
the following SQL statement deletes all partitions for which <code class="docutils literal notranslate"><span class="pre">country</span></code> is <code class="docutils literal notranslate"><span class="pre">US</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">testdb</span><span class="p">.</span><span class="n">customer_orders</span>
<span class="k">WHERE</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'US'</span>
</pre></div>
</div>
<p>A partition delete is performed if the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause meets these conditions.</p>
</section>
<section id="row-level-deletion">
<h4 id="row-level-deletion">Row level deletion<a class="headerlink" href="#row-level-deletion" title="Permalink to this heading">#</a></h4>
<p>Tables using v2 of the Iceberg specification support deletion of individual rows
by writing position delete files.</p>
</section>
</section>
</section>
<section id="type-mapping">
<h2 id="type-mapping">Type mapping<a class="headerlink" href="#type-mapping" title="Permalink to this heading">#</a></h2>
<p>The connector reads and writes data into the supported data file formats Avro,
ORC, and Parquet, following the Iceberg specification.</p>
<p>Because Trino and Iceberg each support types that the other does not, this
connector <a class="reference internal" href="../language/types.html#type-mapping-overview"><span class="std std-ref">modifies some types</span></a> when reading or
writing data. Data types may not map the same way in both directions between
Trino and the data source. Refer to the following sections for type mapping in
each direction.</p>
<p>The Iceberg specification includes supported data types and the mapping to the
formating in the Avro, ORC, or Parquet files:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://iceberg.apache.org/spec/#avro">Iceberg to Avro</a></p></li>
<li><p><a class="reference external" href="https://iceberg.apache.org/spec/#orc">Iceberg to ORC</a></p></li>
<li><p><a class="reference external" href="https://iceberg.apache.org/spec/#parquet">Iceberg to Parquet</a></p></li>
</ul>
<section id="iceberg-to-trino-type-mapping">
<h3 id="iceberg-to-trino-type-mapping">Iceberg to Trino type mapping<a class="headerlink" href="#iceberg-to-trino-type-mapping" title="Permalink to this heading">#</a></h3>
<p>The connector maps Iceberg types to the corresponding Trino types following this
table:</p>
<table id="id8">
<caption><span class="caption-text">Iceberg to Trino type mapping</span><a class="headerlink" href="#id8" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 40%"/>
<col style="width: 60%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Iceberg type</p></th>
<th class="head"><p>Trino type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">INT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INTEGER</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LONG</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">REAL</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DECIMAL(p,s)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DECIMAL(p,s)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DATE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DATE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TIME</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIME(6)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP(6)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMPTZ</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP(6)</span> <span class="pre">WITH</span> <span class="pre">TIME</span> <span class="pre">ZONE</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">STRING</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UUID</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UUID</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BINARY</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VARBINARY</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">FIXED</span> <span class="pre">(L)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VARBINARY</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">STRUCT(...)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ROW(...)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LIST(e)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ARRAY(e)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MAP(k,v)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MAP(k,v)</span></code></p></td>
</tr>
</tbody>
</table>
<p>No other types are supported.</p>
</section>
<section id="trino-to-iceberg-type-mapping">
<h3 id="trino-to-iceberg-type-mapping">Trino to Iceberg type mapping<a class="headerlink" href="#trino-to-iceberg-type-mapping" title="Permalink to this heading">#</a></h3>
<p>The connector maps Trino types to the corresponding Iceberg types following
this table:</p>
<table id="id9">
<caption><span class="caption-text">Trino to Iceberg type mapping</span><a class="headerlink" href="#id9" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 40%"/>
<col style="width: 60%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Trino type</p></th>
<th class="head"><p>Iceberg type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">INTEGER</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INT</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LONG</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">REAL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DECIMAL(p,s)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DECIMAL(p,s)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DATE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DATE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TIME(6)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIME</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP(6)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP(6)</span> <span class="pre">WITH</span> <span class="pre">TIME</span> <span class="pre">ZONE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMPTZ</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">STRING</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UUID</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UUID</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VARBINARY</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BINARY</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ROW(...)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">STRUCT(...)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ARRAY(e)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LIST(e)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MAP(k,v)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MAP(k,v)</span></code></p></td>
</tr>
</tbody>
</table>
<p>No other types are supported.</p>
</section>
</section>
<section id="partitioned-tables">
<span id="iceberg-tables"></span><h2 id="partitioned-tables">Partitioned tables<a class="headerlink" href="#partitioned-tables" title="Permalink to this heading">#</a></h2>
<p>Iceberg supports partitioning by specifying transforms over the table columns.
A partition is created for each unique tuple value produced by the transforms.
Identity transforms are simply the column name. Other transforms are:</p>
<table>
<colgroup>
<col style="width: 35%"/>
<col style="width: 65%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Transform</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">year(ts)</span></code></p></td>
<td><p>A partition is created for each year.  The partition value is the
integer difference in years between <code class="docutils literal notranslate"><span class="pre">ts</span></code> and January 1 1970.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">month(ts)</span></code></p></td>
<td><p>A partition is created for each month of each year.  The partition
value is the integer difference in months between <code class="docutils literal notranslate"><span class="pre">ts</span></code> and
January 1 1970.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">day(ts)</span></code></p></td>
<td><p>A partition is created for each day of each year.  The partition
value is the integer difference in days between <code class="docutils literal notranslate"><span class="pre">ts</span></code> and
January 1 1970.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hour(ts)</span></code></p></td>
<td><p>A partition is created hour of each day.  The partition value
is a timestamp with the minutes and seconds set to zero.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bucket(x,</span> <span class="pre">nbuckets)</span></code></p></td>
<td><p>The data is hashed into the specified number of buckets.  The
partition value is an integer hash of <code class="docutils literal notranslate"><span class="pre">x</span></code>, with a value between
0 and <code class="docutils literal notranslate"><span class="pre">nbuckets</span> <span class="pre">-</span> <span class="pre">1</span></code> inclusive.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">truncate(s,</span> <span class="pre">nchars)</span></code></p></td>
<td><p>The partition value is the first <code class="docutils literal notranslate"><span class="pre">nchars</span></code> characters of <code class="docutils literal notranslate"><span class="pre">s</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>In this example, the table is partitioned by the month of <code class="docutils literal notranslate"><span class="pre">order_date</span></code>, a hash of
<code class="docutils literal notranslate"><span class="pre">account_number</span></code> (with 10 buckets), and <code class="docutils literal notranslate"><span class="pre">country</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example</span><span class="p">.</span><span class="n">testdb</span><span class="p">.</span><span class="n">customer_orders</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">order_date</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">account_number</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">customer</span> <span class="nb">VARCHAR</span><span class="p">,</span>
    <span class="n">country</span> <span class="nb">VARCHAR</span><span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span><span class="n">partitioning</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'month(order_date)'</span><span class="p">,</span> <span class="s1">'bucket(account_number, 10)'</span><span class="p">,</span> <span class="s1">'country'</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="rolling-back-to-a-previous-snapshot">
<h2 id="rolling-back-to-a-previous-snapshot">Rolling back to a previous snapshot<a class="headerlink" href="#rolling-back-to-a-previous-snapshot" title="Permalink to this heading">#</a></h2>
<p>Iceberg supports a “snapshot” model of data, where table snapshots are
identified by a snapshot ID.</p>
<p>The connector provides a system table exposing snapshot information for every
Iceberg table. Snapshots are identified by <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code> snapshot IDs.
For example, you could find the snapshot IDs for the <code class="docutils literal notranslate"><span class="pre">customer_orders</span></code> table
by running the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">snapshot_id</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">testdb</span><span class="p">.</span><span class="ss">"customer_orders$snapshots"</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">committed_at</span> <span class="k">DESC</span>
</pre></div>
</div>
<section id="time-travel-queries">
<span id="iceberg-time-travel"></span><h3 id="time-travel-queries">Time travel queries<a class="headerlink" href="#time-travel-queries" title="Permalink to this heading">#</a></h3>
<p>The connector offers the ability to query historical data.
This allows you to query the table as it was when a previous snapshot
of the table was taken, even if the data has since been modified or deleted.</p>
<p>The historical data of the table can be retrieved by specifying the
snapshot identifier corresponding to the version of the table that
needs to be retrieved:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">testdb</span><span class="p">.</span><span class="n">customer_orders</span> <span class="k">FOR</span> <span class="k">VERSION</span> <span class="k">AS</span> <span class="k">OF</span> <span class="mi">8954597067493422955</span>
</pre></div>
</div>
<p>A different approach of retrieving historical data is to specify
a point in time in the past, such as a day or week ago. The latest snapshot
of the table taken before or at the specified timestamp in the query is
internally used for providing the previous state of the table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">testdb</span><span class="p">.</span><span class="n">customer_orders</span> <span class="k">FOR</span> <span class="k">TIMESTAMP</span> <span class="k">AS</span> <span class="k">OF</span> <span class="k">TIMESTAMP</span> <span class="s1">'2022-03-23 09:59:29.803 Europe/Vienna'</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3 id="id2">Rolling back to a previous snapshot<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> metadata table to determine the latest snapshot ID of the table like in the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">snapshot_id</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">testdb</span><span class="p">.</span><span class="ss">"customer_orders$snapshots"</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">committed_at</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The procedure <code class="docutils literal notranslate"><span class="pre">system.rollback_to_snapshot</span></code> allows the caller to roll back
the state of the table to a previous snapshot id:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">example</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">rollback_to_snapshot</span><span class="p">(</span><span class="s1">'testdb'</span><span class="p">,</span> <span class="s1">'customer_orders'</span><span class="p">,</span> <span class="mi">8954597067493422955</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="schema-evolution">
<h2 id="schema-evolution">Schema evolution<a class="headerlink" href="#schema-evolution" title="Permalink to this heading">#</a></h2>
<p>Iceberg supports schema evolution, with safe column add, drop, reorder
and rename operations, including in nested structures.
Table partitioning can also be changed and the connector can still
query data created before the partitioning change.</p>
</section>
<section id="register-table">
<span id="iceberg-register-table"></span><h2 id="register-table">Register table<a class="headerlink" href="#register-table" title="Permalink to this heading">#</a></h2>
<p>The connector can register existing Iceberg tables with the catalog.</p>
<p>The procedure <code class="docutils literal notranslate"><span class="pre">system.register_table</span></code> allows the caller to register an
existing Iceberg table in the metastore, using its existing metadata and data
files:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">example</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">register_table</span><span class="p">(</span><span class="k">schema_name</span> <span class="o">=&gt;</span> <span class="s1">'testdb'</span><span class="p">,</span> <span class="k">table_name</span> <span class="o">=&gt;</span> <span class="s1">'customer_orders'</span><span class="p">,</span> <span class="n">table_location</span> <span class="o">=&gt;</span> <span class="s1">'hdfs://hadoop-master:9000/user/hive/warehouse/customer_orders-581fad8517934af6be1857a903559d44'</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition, you can provide a file name to register a table
with specific metadata. This may be used to register the table with
some specific table state, or may be necessary if the connector cannot
automatically figure out the metadata version to use:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">example</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">register_table</span><span class="p">(</span><span class="k">schema_name</span> <span class="o">=&gt;</span> <span class="s1">'testdb'</span><span class="p">,</span> <span class="k">table_name</span> <span class="o">=&gt;</span> <span class="s1">'customer_orders'</span><span class="p">,</span> <span class="n">table_location</span> <span class="o">=&gt;</span> <span class="s1">'hdfs://hadoop-master:9000/user/hive/warehouse/customer_orders-581fad8517934af6be1857a903559d44'</span><span class="p">,</span> <span class="n">metadata_file_name</span> <span class="o">=&gt;</span> <span class="s1">'00003-409702ba-4735-4645-8f14-09537cc0b2c8.metadata.json'</span><span class="p">)</span>
</pre></div>
</div>
<p>To prevent unauthorized users from accessing data, this procedure is disabled by default.
The procedure is enabled only when <code class="docutils literal notranslate"><span class="pre">iceberg.register-table-procedure.enabled</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</section>
<section id="unregister-table">
<span id="iceberg-unregister-table"></span><h2 id="unregister-table">Unregister table<a class="headerlink" href="#unregister-table" title="Permalink to this heading">#</a></h2>
<p>The connector can unregister existing Iceberg tables from the catalog.</p>
<p>The procedure <code class="docutils literal notranslate"><span class="pre">system.unregister_table</span></code> allows the caller to unregister an
existing Iceberg table from the metastores without deleting the data:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">example</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">unregister_table</span><span class="p">(</span><span class="k">schema_name</span> <span class="o">=&gt;</span> <span class="s1">'testdb'</span><span class="p">,</span> <span class="k">table_name</span> <span class="o">=&gt;</span> <span class="s1">'customer_orders'</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="migrating-existing-tables">
<h2 id="migrating-existing-tables">Migrating existing tables<a class="headerlink" href="#migrating-existing-tables" title="Permalink to this heading">#</a></h2>
<p>The connector can read from or write to Hive tables that have been migrated to Iceberg.
There is no Trino support for migrating Hive tables to Iceberg, so you need to either use
the Iceberg API or Apache Spark.</p>
</section>
<section id="iceberg-table-properties">
<span id="id3"></span><h2 id="iceberg-table-properties">Iceberg table properties<a class="headerlink" href="#iceberg-table-properties" title="Permalink to this heading">#</a></h2>
<table>
<colgroup>
<col style="width: 41%"/>
<col style="width: 59%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">format</span></code></p></td>
<td><p>Optionally specifies the format of table data files;
either <code class="docutils literal notranslate"><span class="pre">PARQUET</span></code>, <code class="docutils literal notranslate"><span class="pre">ORC</span></code> or <code class="docutils literal notranslate"><span class="pre">AVRO</span></code>.  Defaults to <code class="docutils literal notranslate"><span class="pre">ORC</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">partitioning</span></code></p></td>
<td><p>Optionally specifies table partitioning.
If a table is partitioned by columns <code class="docutils literal notranslate"><span class="pre">c1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code>, the
partitioning property would be
<code class="docutils literal notranslate"><span class="pre">partitioning</span> <span class="pre">=</span> <span class="pre">ARRAY['c1',</span> <span class="pre">'c2']</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">location</span></code></p></td>
<td><p>Optionally specifies the file system location URI for
the table.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">format_version</span></code></p></td>
<td><p>Optionally specifies the format version of the Iceberg
specification to use for new tables; either <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">2</span></code>. Version <code class="docutils literal notranslate"><span class="pre">2</span></code> is required for row level deletes.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">orc_bloom_filter_columns</span></code></p></td>
<td><p>Comma separated list of columns to use for ORC bloom filter.
It improves the performance of queries using Equality and IN predicates
when reading ORC file.
Requires ORC format.
Defaults to <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">orc_bloom_filter_fpp</span></code></p></td>
<td><p>The ORC bloom filters false positive probability.
Requires ORC format.
Defaults to <code class="docutils literal notranslate"><span class="pre">0.05</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>The table definition below specifies format Parquet, partitioning by columns <code class="docutils literal notranslate"><span class="pre">c1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code>,
and a file system location of <code class="docutils literal notranslate"><span class="pre">/var/example_tables/test_table</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="p">(</span>
    <span class="n">c1</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">c2</span> <span class="nb">date</span><span class="p">,</span>
    <span class="n">c3</span> <span class="n">double</span><span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">'PARQUET'</span><span class="p">,</span>
    <span class="n">partitioning</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'c1'</span><span class="p">,</span> <span class="s1">'c2'</span><span class="p">],</span>
    <span class="k">location</span> <span class="o">=</span> <span class="s1">'/var/example_tables/test_table'</span><span class="p">)</span>
</pre></div>
</div>
<p>The table definition below specifies format ORC, bloom filter index by columns <code class="docutils literal notranslate"><span class="pre">c1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code>,
fpp is 0.05, and a file system location of <code class="docutils literal notranslate"><span class="pre">/var/example_tables/test_table</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">test_table</span> <span class="p">(</span>
    <span class="n">c1</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">c2</span> <span class="nb">date</span><span class="p">,</span>
    <span class="n">c3</span> <span class="n">double</span><span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s1">'ORC'</span><span class="p">,</span>
    <span class="k">location</span> <span class="o">=</span> <span class="s1">'/var/example_tables/test_table'</span><span class="p">,</span>
    <span class="n">orc_bloom_filter_columns</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'c1'</span><span class="p">,</span> <span class="s1">'c2'</span><span class="p">],</span>
    <span class="n">orc_bloom_filter_fpp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">05</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="metadata-columns">
<span id="iceberg-metadata-columns"></span><h2 id="metadata-columns">Metadata columns<a class="headerlink" href="#metadata-columns" title="Permalink to this heading">#</a></h2>
<p>In addition to the defined columns, the Iceberg connector automatically exposes
path metadata as a hidden column in each table:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$path</span></code>: Full file system path name of the file for this row</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$file_modified_time</span></code>: Timestamp of the last modification of the file for this row</p></li>
</ul>
<p>You can use these columns in your SQL statements like any other column. This
can be selected directly, or used in conditional statements. For example, you
can inspect the file path for each record:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="ss">"$path"</span><span class="p">,</span> <span class="ss">"$file_modified_time"</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="p">;</span>
</pre></div>
</div>
<p>Retrieve all records that belong to a specific file using <code class="docutils literal notranslate"><span class="pre">"$path"</span></code> filter:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span>
<span class="k">WHERE</span> <span class="ss">"$path"</span> <span class="o">=</span> <span class="s1">'/usr/iceberg/table/web.page_views/data/file_01.parquet'</span>
</pre></div>
</div>
<p>Retrieve all records that belong to a specific file using <code class="docutils literal notranslate"><span class="pre">"$file_modified_time"</span></code> filter:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">example</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span>
<span class="k">WHERE</span> <span class="ss">"$file_modified_time"</span> <span class="o">=</span> <span class="k">CAST</span><span class="p">(</span><span class="s1">'2022-07-01 01:02:03.456 UTC'</span> <span class="k">AS</span> <span class="k">timestamp</span> <span class="k">with</span> <span class="n">time</span> <span class="k">zone</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="metadata-tables">
<span id="iceberg-metadata-tables"></span><h2 id="metadata-tables">Metadata tables<a class="headerlink" href="#metadata-tables" title="Permalink to this heading">#</a></h2>
<p>The connector exposes several metadata tables for each Iceberg table.
These metadata tables contain information about the internal structure
of the Iceberg table. You can query each metadata table by appending the
metadata table name to the table name:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$data"</span>
</pre></div>
</div>
<section id="data-table">
<h3 id="data-table"><code class="docutils literal notranslate"><span class="pre">$data</span></code> table<a class="headerlink" href="#data-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$data</span></code> table is an alias for the Iceberg table itself.</p>
<p>The statement:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$data"</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">test_table</span>
</pre></div>
</div>
</section>
<section id="properties-table">
<h3 id="properties-table"><code class="docutils literal notranslate"><span class="pre">$properties</span></code> table<a class="headerlink" href="#properties-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$properties</span></code> table provides access to general information about Iceberg
table configuration and any additional metadata key/value pairs that the table
is tagged with.</p>
<p>You can retrieve the properties of the current snapshot of the Iceberg
table <code class="docutils literal notranslate"><span class="pre">test_table</span></code> by using the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$properties"</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> key                   | value    |
-----------------------+----------+
write.format.default   | PARQUET  |
</pre></div>
</div>
</section>
<section id="history-table">
<h3 id="history-table"><code class="docutils literal notranslate"><span class="pre">$history</span></code> table<a class="headerlink" href="#history-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$history</span></code> table provides a log of the metadata changes performed on
the Iceberg table.</p>
<p>You can retrieve the changelog of the Iceberg table <code class="docutils literal notranslate"><span class="pre">test_table</span></code>
by using the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$history"</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> made_current_at                  | snapshot_id          | parent_id            | is_current_ancestor
----------------------------------+----------------------+----------------------+--------------------
2022-01-10 08:11:20 Europe/Vienna | 8667764846443717831  |  &lt;null&gt;              |  true
2022-01-10 08:11:34 Europe/Vienna | 7860805980949777961  | 8667764846443717831  |  true
</pre></div>
</div>
<p>The output of the query has the following columns:</p>
<table id="id10">
<caption><span class="caption-text">History columns</span><a class="headerlink" href="#id10" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 30%"/>
<col style="width: 40%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">made_current_at</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">timestamp(3)</span> <span class="pre">with</span> <span class="pre">time</span> <span class="pre">zone</span></code></p></td>
<td><p>The time when the snapshot became active</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">snapshot_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The identifier of the snapshot</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">parent_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The identifier of the parent snapshot</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">is_current_ancestor</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">boolean</span></code></p></td>
<td><p>Whether or not this snapshot is an ancestor of the current snapshot</p></td>
</tr>
</tbody>
</table>
</section>
<section id="snapshots-table">
<h3 id="snapshots-table"><code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> table<a class="headerlink" href="#snapshots-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> table provides a detailed view of snapshots of the
Iceberg table. A snapshot consists of one or more file manifests,
and the complete table contents is represented by the union
of all the data files in those manifests.</p>
<p>You can retrieve the information about the snapshots of the Iceberg table
<code class="docutils literal notranslate"><span class="pre">test_table</span></code> by using the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$snapshots"</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> committed_at                      | snapshot_id          | parent_id            | operation          |  manifest_list                                                                                                                           |   summary
----------------------------------+----------------------+----------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2022-01-10 08:11:20 Europe/Vienna | 8667764846443717831  |  &lt;null&gt;              |  append            |   hdfs://hadoop-master:9000/user/hive/warehouse/test_table/metadata/snap-8667764846443717831-1-100cf97e-6d56-446e-8961-afdaded63bc4.avro | {changed-partition-count=0, total-equality-deletes=0, total-position-deletes=0, total-delete-files=0, total-files-size=0, total-records=0, total-data-files=0}
2022-01-10 08:11:34 Europe/Vienna | 7860805980949777961  | 8667764846443717831  |  append            |   hdfs://hadoop-master:9000/user/hive/warehouse/test_table/metadata/snap-7860805980949777961-1-faa19903-1455-4bb8-855a-61a1bbafbaa7.avro | {changed-partition-count=1, added-data-files=1, total-equality-deletes=0, added-records=1, total-position-deletes=0, added-files-size=442, total-delete-files=0, total-files-size=442, total-records=1, total-data-files=1}
</pre></div>
</div>
<p>The output of the query has the following columns:</p>
<table id="id11">
<caption><span class="caption-text">Snapshots columns</span><a class="headerlink" href="#id11" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%"/>
<col style="width: 30%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">committed_at</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">timestamp(3)</span> <span class="pre">with</span> <span class="pre">time</span> <span class="pre">zone</span></code></p></td>
<td><p>The time when the snapshot became active</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">snapshot_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The identifier for the snapshot</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">parent_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The identifier for the parent snapshot</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar</span></code></p></td>
<td><p>The type of operation performed on the Iceberg table.
The supported operation types in Iceberg are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">append</span></code> when new data is appended</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replace</span></code> when files are removed and replaced without changing the data in the table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">overwrite</span></code> when new data is added to overwrite existing data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete</span></code> when data is deleted from the table  and no new data is added</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">manifest_list</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar</span></code></p></td>
<td><p>The list of avro manifest files containing the detailed information about the snapshot changes.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">summary</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(varchar,</span> <span class="pre">varchar)</span></code></p></td>
<td><p>A summary of the changes made from the previous snapshot to the current snapshot</p></td>
</tr>
</tbody>
</table>
</section>
<section id="manifests-table">
<h3 id="manifests-table"><code class="docutils literal notranslate"><span class="pre">$manifests</span></code> table<a class="headerlink" href="#manifests-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$manifests</span></code> table provides a detailed overview of the manifests
corresponding to the snapshots performed in the log of the Iceberg table.</p>
<p>You can retrieve the information about the manifests of the Iceberg table
<code class="docutils literal notranslate"><span class="pre">test_table</span></code> by using the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$manifests"</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> path                                                                                                           | length          | partition_spec_id    | added_snapshot_id     | added_data_files_count  | added_rows_count | existing_data_files_count   | existing_rows_count | deleted_data_files_count    | deleted_rows_count | partitions
----------------------------------------------------------------------------------------------------------------+-----------------+----------------------+-----------------------+-------------------------+------------------+-----------------------------+---------------------+-----------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 hdfs://hadoop-master:9000/user/hive/warehouse/test_table/metadata/faa19903-1455-4bb8-855a-61a1bbafbaa7-m0.avro |  6277           |   0                  | 7860805980949777961   | 1                       | 100              | 0                           | 0                   | 0                           | 0                  | {{contains_null=false, contains_nan= false, lower_bound=1, upper_bound=1},{contains_null=false, contains_nan= false, lower_bound=2021-01-12, upper_bound=2021-01-12}}
</pre></div>
</div>
<p>The output of the query has the following columns:</p>
<table id="id12">
<caption><span class="caption-text">Manifests columns</span><a class="headerlink" href="#id12" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30%"/>
<col style="width: 30%"/>
<col style="width: 40%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">path</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar</span></code></p></td>
<td><p>The manifest file location</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The manifest file length</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">partition_spec_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
<td><p>The identifier for the partition specification used to write the manifest file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">added_snapshot_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The identifier of the snapshot during which this manifest entry has been added</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">added_data_files_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
<td><p>The number of data files with status <code class="docutils literal notranslate"><span class="pre">ADDED</span></code> in the manifest file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">added_rows_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The total number of rows in all data files with status <code class="docutils literal notranslate"><span class="pre">ADDED</span></code> in the manifest file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">existing_data_files_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
<td><p>The number of data files with status <code class="docutils literal notranslate"><span class="pre">EXISTING</span></code> in the manifest file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">existing_rows_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The total number of rows in all data files with status <code class="docutils literal notranslate"><span class="pre">EXISTING</span></code> in the manifest file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">deleted_data_files_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
<td><p>The number of data files with status <code class="docutils literal notranslate"><span class="pre">DELETED</span></code> in the manifest file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">deleted_rows_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The total number of rows in all data files with status <code class="docutils literal notranslate"><span class="pre">DELETED</span></code> in the manifest file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">partitions</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">array(row(contains_null</span> <span class="pre">boolean,</span> <span class="pre">contains_nan</span> <span class="pre">boolean,</span> <span class="pre">lower_bound</span> <span class="pre">varchar,</span> <span class="pre">upper_bound</span> <span class="pre">varchar))</span></code></p></td>
<td><p>Partition range metadata</p></td>
</tr>
</tbody>
</table>
</section>
<section id="partitions-table">
<h3 id="partitions-table"><code class="docutils literal notranslate"><span class="pre">$partitions</span></code> table<a class="headerlink" href="#partitions-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$partitions</span></code> table provides a detailed overview of the partitions
of the  Iceberg table.</p>
<p>You can retrieve the information about the partitions of the Iceberg table
<code class="docutils literal notranslate"><span class="pre">test_table</span></code> by using the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$partitions"</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> partition             | record_count  | file_count    | total_size    |  data
-----------------------+---------------+---------------+---------------+------------------------------------------------------
{c1=1, c2=2021-01-12}  |  2            | 2             |  884          | {c3={min=1.0, max=2.0, null_count=0, nan_count=NULL}}
{c1=1, c2=2021-01-13}  |  1            | 1             |  442          | {c3={min=1.0, max=1.0, null_count=0, nan_count=NULL}}
</pre></div>
</div>
<p>The output of the query has the following columns:</p>
<table id="id13">
<caption><span class="caption-text">Partitions columns</span><a class="headerlink" href="#id13" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%"/>
<col style="width: 30%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">partition</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">row(...)</span></code></p></td>
<td><p>A row which contains the mapping of the partition column name(s) to the partition column value(s)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">record_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The number of records in the partition</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">file_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The number of files mapped in the partition</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">total_size</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The size of all the files in the partition</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">row(...</span> <span class="pre">row</span> <span class="pre">(min</span> <span class="pre">...,</span> <span class="pre">max</span> <span class="pre">...</span> <span class="pre">,</span> <span class="pre">null_count</span> <span class="pre">bigint,</span> <span class="pre">nan_count</span> <span class="pre">bigint))</span></code></p></td>
<td><p>Partition range metadata</p></td>
</tr>
</tbody>
</table>
</section>
<section id="files-table">
<h3 id="files-table"><code class="docutils literal notranslate"><span class="pre">$files</span></code> table<a class="headerlink" href="#files-table" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">$files</span></code> table provides a detailed overview of the data files in current snapshot of the  Iceberg table.</p>
<p>To retrieve the information about the data files of the Iceberg table <code class="docutils literal notranslate"><span class="pre">test_table</span></code> use the following query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="ss">"test_table$files"</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> content  | file_path                                                                                                                     | record_count    | file_format   | file_size_in_bytes   |  column_sizes        |  value_counts     |  null_value_counts | nan_value_counts  | lower_bounds                |  upper_bounds               |  key_metadata  | split_offsets  |  equality_ids
----------+-------------------------------------------------------------------------------------------------------------------------------+-----------------+---------------+----------------------+----------------------+-------------------+--------------------+-------------------+-----------------------------+-----------------------------+----------------+----------------+---------------
 0        | hdfs://hadoop-master:9000/user/hive/warehouse/test_table/data/c1=3/c2=2021-01-14/af9872b2-40f3-428f-9c87-186d2750d84e.parquet |  1              |  PARQUET      |  442                 | {1=40, 2=40, 3=44}   |  {1=1, 2=1, 3=1}  |  {1=0, 2=0, 3=0}   | &lt;null&gt;            |  {1=3, 2=2021-01-14, 3=1.3} |  {1=3, 2=2021-01-14, 3=1.3} |  &lt;null&gt;        | &lt;null&gt;         |   &lt;null&gt;
</pre></div>
</div>
<p>The output of the query has the following columns:</p>
<table id="id14">
<caption><span class="caption-text">Files columns</span><a class="headerlink" href="#id14" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 25%"/>
<col style="width: 30%"/>
<col style="width: 45%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">content</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
<td><p>Type of content stored in the file.
The supported content types in Iceberg are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DATA(0)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSITION_DELETES(1)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EQUALITY_DELETES(2)</span></code></p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">file_path</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar</span></code></p></td>
<td><p>The data file location</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">file_format</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar</span></code></p></td>
<td><p>The format of the data file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">record_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The number of entries contained in the data file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">file_size_in_bytes</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code></p></td>
<td><p>The data file size</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">column_sizes</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(integer,</span> <span class="pre">bigint)</span></code></p></td>
<td><p>Mapping between the Iceberg column ID and its corresponding size in the file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">value_counts</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(integer,</span> <span class="pre">bigint)</span></code></p></td>
<td><p>Mapping between the Iceberg column ID and its corresponding count of entries in the file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">null_value_counts</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(integer,</span> <span class="pre">bigint)</span></code></p></td>
<td><p>Mapping between the Iceberg column ID and its corresponding count of <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values in the file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nan_value_counts</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(integer,</span> <span class="pre">bigint)</span></code></p></td>
<td><p>Mapping between the Iceberg column ID and its corresponding count of non numerical values in the file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">lower_bounds</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(integer,</span> <span class="pre">bigint)</span></code></p></td>
<td><p>Mapping between the Iceberg column ID and its corresponding lower bound in the file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upper_bounds</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map(integer,</span> <span class="pre">bigint)</span></code></p></td>
<td><p>Mapping between the Iceberg column ID and its corresponding upper bound in the file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">key_metadata</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varbinary</span></code></p></td>
<td><p>Metadata about the encryption key used to encrypt this file, if applicable</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">split_offsets</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">array(bigint)</span></code></p></td>
<td><p>List of recommended split locations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">equality_ids</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">array(integer)</span></code></p></td>
<td><p>The set of field IDs used for equality comparison in equality delete files</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="materialized-views">
<span id="iceberg-materialized-views"></span><h2 id="materialized-views">Materialized views<a class="headerlink" href="#materialized-views" title="Permalink to this heading">#</a></h2>
<p>The Iceberg connector supports <a class="reference internal" href="../language/sql-support.html#sql-materialized-view-management"><span class="std std-ref">Materialized view management</span></a>. In the
underlying system each materialized view consists of a view definition and an
Iceberg storage table. The storage table name is stored as a materialized view
property. The data is stored in that storage table.</p>
<p>You can use the <a class="reference internal" href="#iceberg-table-properties"><span class="std std-ref">Iceberg table properties</span></a> to control the created storage
table and therefore the layout and performance. For example, you can use the
following clause with <a class="reference internal" href="../sql/create-materialized-view.html"><span class="doc">CREATE MATERIALIZED VIEW</span></a> to use the ORC format
for the data files and partition the storage per day using the column
<code class="docutils literal notranslate"><span class="pre">_date</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span> <span class="p">(</span> <span class="n">format</span> <span class="o">=</span> <span class="s1">'ORC'</span><span class="p">,</span> <span class="n">partitioning</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'event_date'</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>By default, the storage table is created in the same schema as the materialized
view definition. The <code class="docutils literal notranslate"><span class="pre">iceberg.materialized-views.storage-schema</span></code> catalog
configuration property or <code class="docutils literal notranslate"><span class="pre">storage_schema</span></code> materialized view property can be
used to specify the schema where the storage table will be created.</p>
<p>Updating the data in the materialized view with
<a class="reference internal" href="../sql/refresh-materialized-view.html"><span class="doc">REFRESH MATERIALIZED VIEW</span></a> deletes the data from the storage table,
and inserts the data that is the result of executing the materialized view
query into the existing table. Data is replaced atomically, so users can
continue to query the materialized view while it is being refreshed.
Refreshing a materialized view also stores
the snapshot-ids of all Iceberg tables that are part of the materialized
view’s query in the materialized view metadata. When the materialized
view is queried, the snapshot-ids are used to check if the data in the storage
table is up to date. If the data is outdated, the materialized view behaves
like a normal view, and the data is queried directly from the base tables.
Detecting outdated data is possible only when the materialized view uses
Iceberg tables only, or when it uses mix of Iceberg and non-Iceberg tables
but some Iceberg tables are outdated. When the materialized view is based
on non-Iceberg tables, querying it can return outdated data, since the connector
has no information whether the underlying non-Iceberg tables have changed.</p>
<p>Dropping a materialized view with <a class="reference internal" href="../sql/drop-materialized-view.html"><span class="doc">DROP MATERIALIZED VIEW</span></a> removes
the definition and the storage table.</p>
</section>
<section id="table-statistics">
<h2 id="table-statistics">Table statistics<a class="headerlink" href="#table-statistics" title="Permalink to this heading">#</a></h2>
<p>The Iceberg connector can collect column statistics using <a class="reference internal" href="../sql/analyze.html"><span class="doc">ANALYZE</span></a>
statement. This can be disabled using <code class="docutils literal notranslate"><span class="pre">iceberg.extended-statistics.enabled</span></code>
catalog configuration property, or the corresponding
<code class="docutils literal notranslate"><span class="pre">extended_statistics_enabled</span></code> session property.</p>
<section id="updating-table-statistics">
<span id="iceberg-analyze"></span><h3 id="updating-table-statistics">Updating table statistics<a class="headerlink" href="#updating-table-statistics" title="Permalink to this heading">#</a></h3>
<p>If your queries are complex and include joining large data sets,
running <a class="reference internal" href="../sql/analyze.html"><span class="doc">ANALYZE</span></a> on tables may improve query performance
by collecting statistical information about the data:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ANALYZE</span> <span class="k">table_name</span>
</pre></div>
</div>
<p>This query collects statistics for all columns.</p>
<p>On wide tables, collecting statistics for all columns can be expensive.
It is also typically unnecessary - statistics are
only useful on specific columns, like join keys, predicates, or grouping keys. You can
specify a subset of columns to analyzed with the optional <code class="docutils literal notranslate"><span class="pre">columns</span></code> property:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ANALYZE</span> <span class="k">table_name</span> <span class="k">WITH</span> <span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'col_1'</span><span class="p">,</span> <span class="s1">'col_2'</span><span class="p">])</span>
</pre></div>
</div>
<p>This query collects statistics for columns <code class="docutils literal notranslate"><span class="pre">col_1</span></code> and <code class="docutils literal notranslate"><span class="pre">col_2</span></code>.</p>
<p>Note that if statistics were previously collected for all columns, they need to be dropped
using <a class="reference internal" href="#drop-extended-stats"><span class="std std-ref">drop_extended_stats</span></a> command before re-analyzing.</p>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-grid md-main__inner" style="height: auto;">
  <div class="md-content">
    <div class="feedback-container md-content__inner md-typeset">
      <div class="feedback-thumbs">
        <p>Is the information on this page helpful?</p>
        <p class="feedback-option" title="yes">Yes</p>
        <p class="feedback-option" title="no">No</p>
      </div>
      <div class="feedback-message">
        <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
        <button type="button" onclick="sendMessage()" class="feedback-button">Submit</button>
        <a onclick="skip()" class="feedback-skip">Skip</a>
      </div>
    </div>
  </div>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '');
</script>
<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hive-alluxio.html" title="Hive connector with Alluxio"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Hive connector with Alluxio </span>
              </div>
            </a>
          
          
            <a href="kafka.html" title="Kafka connector"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Kafka connector </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
<!-- custom footer should go here in time -->
<div class="page-footer">
  <div class="container md-grid">
    <div class="row">
      <div class="col-md-3">
        <p style="font-weight:900">Resources</p>
        <ul>
          <li class="footer-item"><a href="https://docs.starburst.io/latest/index.html">Starburst Enterprise reference documentation</a></li>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/starburst-intro-and-demo/" target="_blank">Join our weekly demos</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#!" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">

        <a href="https://www.starburst.io/" target="_blank">
          
            <img src="../_static/starburst_KO-T.png" height="26"
                  alt="Starburst Enterprise 407-e.13 LTS logo">
        
        </a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright © 2017-2023<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
  </div>
</div>
<script src="https://docs.starburst.io/407-e/_static/algolia.js"></script>
<script src="https://docs.starburst.io/407-e/_static/searchbox.js" data-versions="{'Latest LTS (423-e)': '/423-e/', '413-e LTS': '/413-e/', '407-e LTS': '/407-e/', '402-e LTS': '/402-e/', 'Latest STS (427-e)': '/427-e/', '426-e STS': '/426-e/'}"></script>
<script src="https://docs.starburst.io/407-e/_static/searchresults.js" data-versions="{'Latest LTS (423-e)': '/423-e/', '413-e LTS': '/413-e/', '407-e LTS': '/407-e/', '402-e LTS': '/402-e/', 'Latest STS (427-e)': '/427-e/', '426-e STS': '/426-e/'}"></script>
  </body>
</html>