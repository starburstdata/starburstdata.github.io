<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Starburst | Starburst Admin playbook reference</title>
    <meta name="viewport" content="width=device-width">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Starburst - Starburst Admin playbook reference">
    <meta property="og:description" content="Your hub to all knowledge about Starburst products.">
    <meta property="og:image" content="/assets/img/starburst-og-image.png">

    <link rel="stylesheet" href="/assets/fontawesome/css/all.css">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/mdb.min.css">
    <link rel="stylesheet" href="/assets/css/highlight.css">
    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/style.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114610397-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114610397-1');
</script>

<script>
  var ALGOLIA_INSIGHTS_SRC = "https://cdn.jsdelivr.net/npm/search-insights@2.2.1";

  !function(e,a,t,n,s,i,c){e.AlgoliaAnalyticsObject=s,e[s]=e[s]||function(){
  (e[s].queue=e[s].queue||[]).push(arguments)},i=a.createElement(t),c=a.getElementsByTagName(t)[0],
  i.async=1,i.src=n,c.parentNode.insertBefore(i,c)
  }(window,document,"script",ALGOLIA_INSIGHTS_SRC,"aa");
</script>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Starburst Admin playbook reference | Starburst</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Starburst Admin playbook reference" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Your hub to all knowledge about Starburst products." />
<meta property="og:description" content="Your hub to all knowledge about Starburst products." />
<link rel="canonical" href="https://docs.starburst.io/starburst-enterprise/starburst-admin/playbook-reference.html" />
<meta property="og:url" content="https://docs.starburst.io/starburst-enterprise/starburst-admin/playbook-reference.html" />
<meta property="og:site_name" content="Starburst" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Starburst Admin playbook reference" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Your hub to all knowledge about Starburst products.","headline":"Starburst Admin playbook reference","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://docs.starburst.io/assets/img/logo/starburst-reverse.png"}},"url":"https://docs.starburst.io/starburst-enterprise/starburst-admin/playbook-reference.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>


<div class="wrap">
  

<header class="main-header">
  <div class="navbar fixed-top navbar-dark">
    <div class="navbar-left-container">
      <a class="navbar-brand" href="https://www.starburst.io/">
        <img src="/assets/img/logo/starburst-reverse.png" height="40" alt=" Starburst">
      </a>
      <span class="navbar-divider"></span>
      <a href="/" class="header-text">Documentation</a>
    </div>
    
    <div class="nav-item dropdown" id="site-search">
  <div id="dropdownSearchDisplay" aria-labelledby="dropdownSearch">
    <div id="algolia-search">
      <div id="searchbox"></div>
      <div id="refinement-list">
        <h6>Filter:</h6>
      </div>
      <div id="hits"></div>
      <div id="stats"></div>
    </div>
  </div>
</div>

    
  </div>
  <nav class="primary-nav">
    <ul class="navbar-layout ml-auto">
      <li class="nav-item dropdown">
        <a id="get-started"
           class="nav-link dropdown-toggle" 
          aria-haspopup="true" aria-label="Get started" data-is-click="false"
          href="/get-started/index.html">Get started</a>
        <div class="dropdown-menu dropdown-docs">
          <a class="dropdown-item" href="/get-started/concepts.html">Concepts</a>
          <a class="dropdown-item" href="/get-started/data-sources-catalogs.html">Data sources and catalogs</a>
          <a class="dropdown-item" href="/get-started/choose-your-starburst-product.html">Choose your Starburst product</a>
          <a class="dropdown-item" href="/data-consumer/index.html">Data consumer</a>
          <a class="dropdown-item" href="/data-engineer/index.html">Data engineer</a>
          <a class="dropdown-item" href="/platform-administrator/index.html">Platform administrator</a>
        </div>
      </li>
       <li class="nav-item dropdown">
        <a id="starburst-galaxy"
           class="nav-link dropdown-toggle" 
          aria-haspopup="true" aria-label="Starburst Galaxy" data-is-click="false"
          href="/starburst-galaxy/index.html">Starburst Galaxy</a>
        <div class="dropdown-menu dropdown-docs">
          <a class="dropdown-item" href="/starburst-galaxy/query/index.html">Query</a>
          <a class="dropdown-item" href="/starburst-galaxy/catalogs/index.html">Catalogs</a>
          <a class="dropdown-item" href="/starburst-galaxy/clusters/index.html">Clusters</a>
          <a class="dropdown-item" href="/starburst-galaxy/sql/index.html">SQL</a>
          <a class="dropdown-item" href="/starburst-galaxy/account/index.html">Account</a>
          <a class="dropdown-item" href="/starburst-galaxy/security/index.html">Security</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a id="starburst-enterprise"
           class="nav-link dropdown-toggle active"
          
          aria-haspopup="true" aria-label="Get started" data-is-click="false"
          href="/starburst-enterprise/index.html">Starburst Enterprise</a>
        <div class="dropdown-menu dropdown-docs">
          <a class="dropdown-item" href="/starburst-enterprise/try/index.html">Try Starburst Enterprise</a>
          <a class="dropdown-item" href="/starburst-enterprise/web-ui/index.html">Web UI</a>
          <a class="dropdown-item" href="/starburst-enterprise/sql.html">SQL</a>
          <a class="dropdown-item" href="/starburst-enterprise/admin-topics/index.html">Administration</a>
          <a class="dropdown-item" href="/starburst-enterprise/k8s/index.html">Kubernetes deployments</a>
          <a class="dropdown-item" href="/starburst-enterprise/starburst-admin/index.html">Starburst Admin</a>
          <a class="dropdown-item" href="/latest/index.html">Reference documentation</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a id="ecosystems"
           class="nav-link dropdown-toggle" 
          aria-haspopup="true" aria-label="Get started" data-is-click="false"
          href="/ecosystems/index.html">Ecosystems</a>
        <div class="dropdown-menu dropdown-docs">
          <a class="dropdown-item" href="/ecosystems/amazon/index.html">Amazon AWS</a>
          <a class="dropdown-item" href="/ecosystems/google/index.html">Google Cloud</a>
          <a class="dropdown-item" href="/ecosystems/microsoft/index.html">Microsoft Azure</a>
          <a class="dropdown-item" href="/ecosystems/redhat/index.html">Red Hat OpenShift</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a id="resources"
           class="nav-link dropdown-toggle" 
          aria-haspopup="true" aria-label="resources" data-is-click="false"
          href="/resources.html">Resources</a>
        <div class="dropdown-menu dropdown-docs">
          <a class="dropdown-item" href="/support.html">Support</a>
          <a class="dropdown-item" href="/security/index.html">Security</a>
          <a class="dropdown-item" href="/blog/index.html">Developer blog</a>
          <a class="dropdown-item" href="/videos/index.html">Video library</a>
          <a class="dropdown-item" href="/glossary.html">Glossary</a>
          <a class="dropdown-item" href="https://www.trinoforum.org/">Trino forum</a>
        </div>
      </li>
    </ul>
  </nav>
</header>

  
  <div class="content">
    <div class="row">
      <div class="col-md-3 side-navigation">
        <div class="spacer-60 toc-sticky left-nav">
          
          <div>
    <h6 class="overline product-nav-title">Starburst Enterprise</h6>
</div>
<hr />

 
  
    
    
<li >
  <a href="/starburst-enterprise/index.html" >Starburst Enterprise overview</a>
</li>
  



 





<li 
    onclick="toggle_navigation_visibility('try');">
  <a style="box-sizing: border-box;padding-right: 10px;">
    Try Starburst Enterprise&nbsp;
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="try" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/k8s.html" >Kubernetes</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/docker.html" >Docker</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/tarball.html" >Tarball</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/rpm.html" >RPM</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/verify.html" >Verify server</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/try/catalog.html" >Create a catalog</a>
  </li>
  
  
</ul>



 





<li 
    onclick="toggle_navigation_visibility('sepwebui');">
  <a style="box-sizing: border-box;padding-right: 10px;">
    Web UI&nbsp;
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="sepwebui" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/web-ui/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/web-ui/query-editor.html" >Query editor</a>
  </li>
  
  
</ul>



 
  
    
    
<li >
  <a href="/starburst-enterprise/sql.html" >SQL</a>
</li>
  



 





<li 
    onclick="toggle_navigation_visibility('admintasks');">
  <a style="box-sizing: border-box;padding-right: 10px;">
    Administration topics&nbsp;
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="admintasks" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/admin-topics/index.html" >Overview</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/admin-topics/catalogs.html" >Define catalogs</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/admin-topics/autoscaling.html" >Autoscaling</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/admin-topics/security.html" >Secure your cluster</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/admin-topics/performance-tuning.html" >Tune your cluster</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/admin-topics/cache-service.html" >Enable the cache service</a>
  </li>
  
  
</ul>



 





<li 
    onclick="toggle_navigation_visibility('k8s');">
  <a style="box-sizing: border-box;padding-right: 10px;">
    Kubernetes&nbsp;
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="k8s" class="doc-subnav hidden">
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/k8s/index.html" >Starburst Enterprise and Kubernetes</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/k8s/k8s-operation.html" >Cluster operation</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/k8s/deploy-sep.html" >Deploy Starburst Enterprise</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/k8s/deploy-hms.html" >Deploy Hive metastore</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/k8s/deploy-cache-service.html" >Deploy the cache service</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/k8s/deploy-ranger.html" >Deploy Ranger</a>
  </li>
  
  
</ul>



 





<li  class="active" 
    onclick="toggle_navigation_visibility('starburst-admin');">
  <a style="box-sizing: border-box;padding-right: 10px;">
    Starburst Admin&nbsp;
    <i class="fa fa-angle-left nav-icon"></i>
  </a>
</li>

<ul id="starburst-admin" class="doc-subnav ">
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/starburst-admin/index.html" >Get started</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/starburst-admin/installation-guide.html" >Installation guide</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/starburst-admin/operation-guides.html" >Operation guides</a>
  </li>
  
  
  
    
    
    
  <li class="active"
      
    >
    <a href="/starburst-enterprise/starburst-admin/playbook-reference.html" >Playbook reference</a>
  </li>
  
  
  
    
    
    
  <li 
      
    >
    <a href="/starburst-enterprise/starburst-admin/release-notes.html" >Release notes</a>
  </li>
  
  
</ul>



<div style="padding-top: 3em;">
    <h6 class="overline product-nav-title">Resources</h6>
  </div>
  <hr />
  
   
  
    
    
<li >
  <a href="/support.html" >Support</a>
</li>
  


  
   
  
    
    
<li >
  <a href="/security/index.html" >Security</a>
</li>
  


  
   
  
    
    
<li >
  <a href="/blog/index.html" >Developer blog</a>
</li>
  


  
   
  
    
    
<li >
  <a href="/videos/index.html" >Video library</a>
</li>
  


  
   
  
    
    
<li >
  <a href="/glossary.html" >Glossary</a>
</li>
  


  
   
  
    
    
<li >
  <a href="https://www.trinoforum.org/" >Trino Forum</a>
</li>
  


  
          
        </div>
      </div>
      <div class="col-md-9 col-lg-6 spacer-30 docs-content">
        



<div class="breadcrumbs">
  <p>
  
  
    
      <a href="/starburst-enterprise/"
        style="text-transform: uppercase"
      > starburst enterprise</a> >
    
  
    
      <a href="/starburst-enterprise/starburst-admin/"
        style="text-transform: uppercase"
      > starburst admin</a> >
    
  
    
      Starburst Admin playbook reference
    
  </p>
</div>

        <h1 id="starburst-admin-playbook-reference">
        
        
          Starburst Admin playbook reference <a href="#starburst-admin-playbook-reference" class="titleAnchor">#</a>
        
        
      </h1>
    

<p>Starburst Admin includes numerous playbooks to perform specific actions.
You can use them individually or in sequence to satisfy the needs of your
specific use case for <a href="./installation-guide.html">installing</a> and
<a href="./operation-guides.html">operating</a>.</p>

<p>The following playbooks are available:
<!-- no toc --></p>
<ul>
  <li><a href="#install">Install cluster</a></li>
  <li><a href="#push-configs">Push configurations</a></li>
  <li><a href="#start">Start cluster</a></li>
  <li><a href="#stop">Stop cluster</a></li>
  <li><a href="#restart">Restart cluster</a></li>
  <li><a href="#check-status">Check service status</a></li>
  <li><a href="#graceful-shutdown">Graceful worker shutdown</a></li>
  <li><a href="#rolling-restart-workers">Rolling worker restart</a></li>
  <li><a href="#collect-logs">Collect logs</a></li>
  <li><a href="#collect-jstacks">Collect a Java thread dump</a></li>
  <li><a href="#uninstall">Uninstall cluster</a></li>
</ul>

<p><a name="install"></a></p>
      <h2 id="install-cluster">
        
        
          Install cluster <a href="#install-cluster" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">install</code> playbook installs the RPM or tarball package on all defined hosts.
You are required to place the <code class="language-plaintext highlighter-rouge">tar.gz</code> or <code class="language-plaintext highlighter-rouge">rpm</code> file in the <code class="language-plaintext highlighter-rouge">files</code> directory
and specify the <code class="language-plaintext highlighter-rouge">version</code> in <code class="language-plaintext highlighter-rouge">vars.yml</code> to run the playbook:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/install.yml
</code></pre></div></div>

<p>Errors occurs if RPM and tarball are found or if version values mismatch.</p>

<p>Alternatively to the archive in the <code class="language-plaintext highlighter-rouge">files</code> directory on the control machine,
you can set the <code class="language-plaintext highlighter-rouge">installer_url</code> in <code class="language-plaintext highlighter-rouge">vars.yml</code> to point to HTTP or HTTPS URL of
the  <code class="language-plaintext highlighter-rouge">tar.gz</code> or <code class="language-plaintext highlighter-rouge">rpm</code>. Comment out the <code class="language-plaintext highlighter-rouge">installer_file</code> in <code class="language-plaintext highlighter-rouge">vars.yml</code>. Ansible
then downloads the binary from the URL directly on the hosts. This approach is
more complex to set up, but scales better since all hosts can download from the
URL in parallel. The hosts need to be able to contact the specified URL.</p>

<p>The playbook verifies the availability of the required Java runtime on the host,
starting first at the value of <code class="language-plaintext highlighter-rouge">JAVA_HOME</code> and then looking at common
installation paths. It uses the script <code class="language-plaintext highlighter-rouge">files/find_java.sh</code> and fails if no
runtime is found.</p>

<p>The playbook installs the RPM or unpack the tarball and create the necessary
directories specified via <code class="language-plaintext highlighter-rouge">vars.yml</code>.</p>

<p>Optionally, all playbooks read a custom <code class="language-plaintext highlighter-rouge">vars.yml</code> file by passing a <code class="language-plaintext highlighter-rouge">vars_yml</code>
parameter as an extra variable (-e), as in this example:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/install.yml <span class="nt">-e</span> <span class="s2">"vars_yml=/mypath/my-vars.yml"</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">local_files</code> variable in the <code class="language-plaintext highlighter-rouge">vars.yml</code> file defines where the playbooks
reads the configuration files from before copying them to the target. A relative
path is assumed to be relative to the playbooks directory, or an absolute
path can be used to source the files from any directory.</p>

<p>Ansible can operate as a non-root user, but for some operations, it requires
root privileges. By default, <code class="language-plaintext highlighter-rouge">sudo</code> commands are used to elevate privileges.
Since <code class="language-plaintext highlighter-rouge">sudo</code> prompts for the user password, run every <code class="language-plaintext highlighter-rouge">ansible-playbook</code> command
with the <code class="language-plaintext highlighter-rouge">--ask-become-pass</code> parameter as detailed in the <a href="https://docs.ansible.com/ansible/latest/user_guide/become.html#become-command-line-options">become command
documentation</a>.</p>

<p>The RPM installation automatically adds a dedicated system user to run
SEP as a service. This user owns all configuration files, which
should not be readable by other users on the hosts. The tarball installation
uses the <code class="language-plaintext highlighter-rouge">installation_owner</code> and <code class="language-plaintext highlighter-rouge">installation_group</code> defined in <code class="language-plaintext highlighter-rouge">vars.yml</code>.
The install playbook create the user and group.</p>

<p><a name="push-configs"></a></p>
      <h2 id="push-configurations">
        
        
          Push configurations <a href="#push-configurations" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">push-configs</code> playbook generates the configuration files for the
coordinator and workers and distributes them to all hosts.</p>

<p>The following resources are used to create the set of configuration files:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">files/vars.yml</code> - variable definitions to use in the configuration files that
are templatized with Jinja2. These files use the extension <code class="language-plaintext highlighter-rouge">.j2</code>. Ansible uses
the set values and replaces the variable placeholders. For example, the
placeholder `` is replaced with the value <code class="language-plaintext highlighter-rouge">production</code>
from  <code class="language-plaintext highlighter-rouge">node_environment: production</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">files/coordinator</code> - the configuration files for the coordinator.</li>
  <li><code class="language-plaintext highlighter-rouge">files/worker</code> - the configuration files for all the workers.</li>
  <li><code class="language-plaintext highlighter-rouge">files/catalog</code> - the <a href="../../data-engineer/catalogs.html">catalog properties files to define the connection to
any data sources</a>, required on the coordinator
and all workers.</li>
  <li><code class="language-plaintext highlighter-rouge">files/extra/etc</code> - additional files that are placed in the directory
specified by the <code class="language-plaintext highlighter-rouge">etc_directory</code> variable on all hosts, including the <a href="../../latest/installation/license-requirements.html">license
file</a> as well as other
configuration files.</li>
  <li><code class="language-plaintext highlighter-rouge">files/extra/lib</code> - additional files that are placed in the <code class="language-plaintext highlighter-rouge">lib</code> directory
all hosts, typically binary files or configuration files that are added to the
servers classpath such as custom user-defined function implementations.</li>
  <li><code class="language-plaintext highlighter-rouge">files/extra/plugin</code> - additional files that are placed in the <code class="language-plaintext highlighter-rouge">plugin</code>
directory all hosts, typically complete directories with binaries used for a
custom-developed plugin such as a security extension or another connector.</li>
</ul>

<p>Any changes, including deletion of catalog files is synchronized to the hosts.</p>

<p>Starburst Admin automatically uses the folder name <code class="language-plaintext highlighter-rouge">starburst</code> for
SEP deployments and uses <code class="language-plaintext highlighter-rouge">trino</code> for Trino
deployments.</p>

<p>Other file deletions are not synchronized but can be performed with the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html">Ansible
file
module</a>.
For example, if you made a file <code class="language-plaintext highlighter-rouge">files/extra/etc/foo.sh</code>, the file is copied
into <code class="language-plaintext highlighter-rouge">/etc/starburst/foo.sh</code> on the hosts. You can use the following
command to delete it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible all -m file -a "path=/etc/starburst/foo.sh state=absent"
</code></pre></div></div>

<p>The supported files and configuration methods are <a href="../../latest/index.html">identical to the general
configuration files and properties from SEP</a> for the
identical version you deploy with Starburst Admin.</p>

<p>After you created or updated all the configuration as desired, you can run the
playbook with the following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/push-configs.yml
</code></pre></div></div>

<p>Keep in mind that most of the configuration files need to be distributed to all
nodes in the cluster and that they need to be identical for all workers.</p>

<p>The best approach to apply any new configuration involves the following steps:</p>

<ul>
  <li>Ensure no users are active and <a href="#stop">stop</a> the cluster.</li>
  <li>Alternatively <a href="#graceful-shutdown">shut it down gracefully</a>.</li>
  <li>Update the configuration files.</li>
  <li>Push the configuration.</li>
  <li><a href="#start">Start</a> the cluster.</li>
  <li>Verify the changes work.</li>
</ul>

<p><a name="start"></a></p>
      <h2 id="start-cluster">
        
        
          Start cluster <a href="#start-cluster" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">start</code> playbook start the coordinator and all worker processes on the
hosts. It starts SEP the <code class="language-plaintext highlighter-rouge">service</code> command for RPM-based
installations or with the <code class="language-plaintext highlighter-rouge">launcher</code> script for tarball installation.</p>

<p>You need to <a href="#install">install the cluster</a> and <a href="#push-configs">push the
configuration</a> before starting the cluster the first time.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/start.yml
</code></pre></div></div>

<p>The playbook relies on the hosts to be up and running and available to Ansible.
When restarting the hosts on the operating system or hardware level, the
RPM-based installation automatically starts the SEP processes.
The tarball installation does not start automatically. You can however configure
it to perform the start by using the <code class="language-plaintext highlighter-rouge">launcher</code> script as daemon script. Refer
to the documentation of your used Linux distribution for details.</p>

<p><a name="stop"></a></p>
      <h2 id="stop-cluster">
        
        
          Stop cluster <a href="#stop-cluster" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">stop</code> playbook stops the coordinator and all worker processes on the hosts.
It does not take into account if SEP actively processes any
workload, and simply terminates.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/stop.yml
</code></pre></div></div>

<p>You can use the <a href="#graceful-shutdown">graceful shutdown</a> as an alternative.</p>

<p><a name="restart"></a></p>
      <h2 id="restart-cluster">
        
        
          Restart cluster <a href="#restart-cluster" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">restart</code> playbook stops and then starts the coordinator and all worker
processes on the hosts.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/restart.yml
</code></pre></div></div>

<p>It is equivalent to running the <code class="language-plaintext highlighter-rouge">stop</code> and the <code class="language-plaintext highlighter-rouge">start</code> playbook sequentially.</p>

<p><a name="check-status"></a></p>
      <h2 id="check-service-status">
        
        
          Check service status <a href="#check-service-status" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">check-status</code> playbook checks the status of the the coordinator and all
worker processes and displays the results.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/check-status.yml
</code></pre></div></div>

<p>The playbook uses the <code class="language-plaintext highlighter-rouge">init.d</code> script for the RPM-based installation or the
<code class="language-plaintext highlighter-rouge">launcher</code> script for a tarball installation to get the status of each service.
If the service is running, you see a log for each address in your inventory file
stating <code class="language-plaintext highlighter-rouge">Running as &lt;pid&gt;</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TASK [Print status] ********
ok: [172.28.0.2] =&gt; {
    "msg": "Running as 1965"
}
ok: [172.28.0.3] =&gt; {
    "msg": "Running as 1901"
}
ok: [172.28.0.4] =&gt; {
    "msg": "Running as 1976"
}
</code></pre></div></div>

<p>If a service is not active, you see <code class="language-plaintext highlighter-rouge">Not running</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TASK [Print status] ****
ok: [172.28.0.2] =&gt; {
    "msg": "Not running"
}
ok: [172.28.0.3] =&gt; {
    "msg": "Not running"
}
ok: [172.28.0.4] =&gt; {
    "msg": "Not running"
}
</code></pre></div></div>

<p><a name="graceful-shutdown"></a></p>
      <h2 id="graceful-worker-shutdown">
        
        
          Graceful worker shutdown <a href="#graceful-worker-shutdown" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">graceful-shutdown</code> playbook stops the worker processes after all tasks are
completed.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/graceful-shutdown.yml
</code></pre></div></div>

<p>Using <a href="../../latest/admin/graceful-shutdown.html">graceful shutdown</a> takes
longer than using the <code class="language-plaintext highlighter-rouge">stop</code> playbook, because it allows workers to complete any
assigned work. If all workers are shut down, no further query processing is
performed by the cluster. The coordinator remains running at all times, until
manually shut down.</p>

<p><a name="rolling-restart-workers"></a></p>
      <h2 id="rolling-worker-restart">
        
        
          Rolling worker restart <a href="#rolling-worker-restart" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">rolling-restart-workers</code> playbook stops and starts all worker processes
sequentially one after the other using a <a href="#graceful-shutdown">graceful shutdown</a>
and a new start.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/rolling-restart-workers.yml
</code></pre></div></div>

<p>You can configure the following variables in <code class="language-plaintext highlighter-rouge">files/vars.yml</code> to manage
graceful shutdowns:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">graceful_shutdown_user</code> - user name to pass to the <code class="language-plaintext highlighter-rouge">X-Presto-User</code> or
<code class="language-plaintext highlighter-rouge">X-Trino-User</code> header when issuing the graceful shutdown request via the HTTP
API</li>
  <li><code class="language-plaintext highlighter-rouge">graceful_shutdown_retries</code> -  number of times to check for successful
shutdown before failing</li>
  <li><code class="language-plaintext highlighter-rouge">graceful_shutdown_delay</code>- inactive duration between shutdown status checks</li>
  <li><code class="language-plaintext highlighter-rouge">rolling_restart_concurrency</code> - number of workers to restart at the same time</li>
</ul>

<p>By default, the playbook waits up to 10 minutes for any individual worker to
stop and start. Each operation has a 10 minute timeout. If this timeout is
reached, then the playbook execution fails. If you have a longer shutdown
grace period configured, you may want to extend this timeout.</p>

<p>Keep in mind that this playbook does not change any configuration of the
workers. If you push configuration changes to the cluster before a rolling
restart, the cluster can be in an inconsistent state until the restart is
completed. This can lead to query failures and other issues. A simple addition
of a catalog file is possible. The new catalog only becomes usable after all
workers are restarted. Updates to catalog and other configuration files
typically result in problems.</p>

<p><a name="collect-logs"></a></p>
      <h2 id="collect-logs">
        
        
          Collect logs <a href="#collect-logs" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">collect-logs</code> playbook downloads the log files from all hosts to the
control machine.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/collect-logs.yml
</code></pre></div></div>

<p>The server, HTTP request, and launcher logs files from each host are copied into
<code class="language-plaintext highlighter-rouge">logs/coordinator-&lt;hostname&gt;</code> for the coordinator or <code class="language-plaintext highlighter-rouge">logs/worker-&lt;hostname&gt;</code>
for the workers in the current directory.</p>

<p><a name="collect-jstacks"></a></p>
      <h2 id="collect-jstack-dump">
        
        
          Collect Jstack Dump <a href="#collect-jstack-dump" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">collect-jstacks</code> playbook runs the
<a href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html"><code class="language-plaintext highlighter-rouge">jstack</code></a> command
to capture the Java thread dump of the <code class="language-plaintext highlighter-rouge">StarburstTrinoServer</code> process on all
hosts, and download each dump to a local file on the control machine. The
playbook displays the local file name at the end of the play.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/collect-jstacks.yml
</code></pre></div></div>

<p><a name="uninstall"></a></p>
      <h2 id="uninstall-cluster">
        
        
          Uninstall cluster <a href="#uninstall-cluster" class="titleAnchor">#</a>
        
        
      </h2>
    

<p>The <code class="language-plaintext highlighter-rouge">uninstall</code> playbook removes all modifications made on the hosts by other
playbooks. <a href="#stop">Stop the cluster</a> before running the playbook.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/uninstall.yml
</code></pre></div></div>

<p>The playbook deletes all data, configuration and log files. It also removes the
deployed binary packages and the created user accounts and groups.</p>

        <div class="d-lg-none">
          <div class="feedback-container">
  <div class="feedback-thumbs">
    <p>Is the information on this page helpful?</p>
    <div class="thumb-wrapper">
      <p class="feedback-option" title="yes"><i class="fa fa-thumbs-up"></i>Yes</p>
      <p class="feedback-option" title="no"><i class="fa fa-thumbs-down"></i>No</p>
    </div>
  </div>
  <div class="feedback-message">
    <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
    <button type="button" onclick="sendMessage()" class="btn btn-sm btn-primary">Submit</button>
    <a onclick="skip()" class="feedback-skip">Skip</a>
  </div>
</div>

<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

        </div>
      </div>
      <div class="col-lg-3 toc-styles d-none d-lg-block">
        <div class="spacer-60 toc-sticky">
          <ul><li><a href="#starburst-admin-playbook-reference">Starburst Admin playbook reference</a><ul><li><a href="#install-cluster">Install cluster</a></li><li><a href="#push-configurations">Push configurations</a></li><li><a href="#start-cluster">Start cluster</a></li><li><a href="#stop-cluster">Stop cluster</a></li><li><a href="#restart-cluster">Restart cluster</a></li><li><a href="#check-service-status">Check service status</a></li><li><a href="#graceful-worker-shutdown">Graceful worker shutdown</a></li><li><a href="#rolling-worker-restart">Rolling worker restart</a></li><li><a href="#collect-logs">Collect logs</a></li><li><a href="#collect-jstack-dump">Collect Jstack Dump</a></li><li><a href="#uninstall-cluster">Uninstall cluster</a></li></ul></li></ul>

          <div class="feedback-container">
  <div class="feedback-thumbs">
    <p>Is the information on this page helpful?</p>
    <div class="thumb-wrapper">
      <p class="feedback-option" title="yes"><i class="fa fa-thumbs-up"></i>Yes</p>
      <p class="feedback-option" title="no"><i class="fa fa-thumbs-down"></i>No</p>
    </div>
  </div>
  <div class="feedback-message">
    <textarea class="feedback-body" placeholder="Additional feedback"></textarea>
    <button type="button" onclick="sendMessage()" class="btn btn-sm btn-primary">Submit</button>
    <a onclick="skip()" class="feedback-skip">Skip</a>
  </div>
</div>

<script>
function feedback() {
  var feedbackValue = "";
  var feedbackThumbs = document.querySelector(".feedback-thumbs");
  var feedbackMessage = document.querySelector(".feedback-message");
  var initialFeedbackMessageContents = feedbackMessage.innerHTML;
  var feedbackAnswer = localStorage.getItem('feedback-answer-' + window.location.pathname);
  var options = Array.from(document.querySelectorAll(".feedback-option"));

  if (feedbackAnswer) {
    Object.keys(options).map(i => options[i].getAttribute('title') == JSON.parse(feedbackAnswer)
      ? options[i].classList.add('active')
      : null
    );
  }

  var clickFunction = function(event){
    var page = window.location.pathname;
    var value = event.currentTarget.getAttribute('title');
    var eventValue = value == 'yes' ? 1 : 0;

    if(!event.currentTarget.classList.contains('active')) {
      localStorage.setItem('feedback-answer-' + page, JSON.stringify(value == 'yes' ? 'yes' : 'no'));
      feedbackValue = value;

      gtag('event', 'feedback', {
        'event_category': 'Docs Feedback',
        'event_label': page,
        'event_value': eventValue,
      });

      Object.keys(options).map(i => options[i].classList.remove('active'));
      event.currentTarget.classList.add('active');

      feedbackThumbs.style.display = "none";
      feedbackMessage.style.display = "flex";
    };
  };

  skip = function() {
    feedbackMessage.style.display = "none";
    feedbackThumbs.style.display = "flex";
    feedbackMessage.innerHTML = initialFeedbackMessageContents;
  }

  sendMessage = function(){
    var feedbackBody = document.querySelector(".feedback-body").value;

    if (feedbackBody) {
      var message = "Page url: " + window.location.pathname + "\n\n"
        + "Feedback positive?: " + feedbackValue + "\n\n" +  "Feedback Message: " + feedbackBody;
      var link = "mailto:docs-feedback@starburst.io?subject=" + encodeURIComponent("Feedback")+"&body="
        + encodeURIComponent(message);

      window.location.href = link;
      feedbackMessage.innerHTML = "<p>Thank you!</p>";

      setTimeout(function(){
          skip();
      }, 5000);
    } else {
      if(!document.querySelector("#feedback-skip")) {
        var alertMessage = document.createElement("p");
        alertMessage.id = "feedback-skip";
        alertMessage.style.color = "red";
        alertMessage.style.position = "absolute";
        alertMessage.style.bottom = "-0.5rem";
        alertMessage.innerHTML = "Please provide a message.";
        feedbackMessage.appendChild(alertMessage);

        setTimeout(function(){
          alertMessage.remove();
        }, 3000);
      }
    }
  }

  Object.keys(options).map(i => options[i].addEventListener('click', clickFunction , false));
}

feedback();
</script>

        </div>
      </div>
  </div>
  
</div>
<footer class="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <p style="font-weight:900">Resources</b></p>
        <ul>
          <li class="footer-item"><a href="/videos/index.html">Video library</a></li>
          <li class="footer-item"><a href="/glossary.html">Glossary</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/info/oreilly-trino-guide/" target="_blank">Free O'Reilly book - Trino: The Definitive Guide</a></li>
          <li class="footer-item"><a href="https://trino.io/broadcast/" target="_blank">Trino Community Broadcast</a></li>
          <li class="footer-item"><a href="https://trinoforum.org" target="_blank">Trino Forum</a></li>
          <li class="footer-item"><a href="https://blog.starburstdata.com/" target="_blank">Starburst blog</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <p style="font-weight:900">Contact and more</p>
        <ul>
          <li class="footer-item"><a href="https://www.starburst.io" target="_blank">Starburst</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/#download" target="_blank">Start a trial</a></li>
          <li class="footer-item"><a href="/support.html" target="_blank">Get support</a></li>
          <li class="footer-item"><a href="https://www.starburst.io/contact/" target="_blank">Contact us</a></li>
        </ul>
      </div>
      <div class="col-md-3" style="text-align:right;">
        <a href="https://www.starburst.io/" target="_blank"><img src="/assets/img/logo/starburst-reverse.png" height="60" alt=" Starburst" style="margin-bottom:20px;"></a>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#copyright">Copyright Â© 2017-2022<br> Starburst Data</a>
        </li>
        <li class="footer-item" style="padding-right:10px;">
          <a href="/disclaimers.html#trademarks">Trademark information</a>
        </li>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 center spacer-30">
          <a href="https://twitter.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-twitter"></i></a>
          <a href="https://linkedin.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-linkedin"></i></a>
          <a href="https://www.youtube.com/channel/UCXjkuWSO9CV_cSI3Mvo4a4w" target="_blank" class="footer-icon"><i class="fab fa-youtube"></i></a>
          <a href="https://github.com/starburstdata" target="_blank" class="footer-icon"><i class="fab fa-github"></i></a>
      </div>
    </div>
  </div>
</footer>

  <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/js/popper.min.js"></script>
  <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/assets/js/mdb.min.js"></script>
  <script type="text/javascript" src="/assets/js/custom.js"></script>
  <script type="text/javascript" src="/assets/js/algolia.js"></script>
  <script type="text/javascript" src="/assets/js/search-box.js"></script>
  <script type="text/javascript" src="/assets/js/search-results.js"></script>
</body>
</html>

